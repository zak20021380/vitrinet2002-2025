<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>شهر رو بگرد | ویترینت</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;800&family=Montserrat:wght@700&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Vazirmatn', 'Montserrat', sans-serif;
      background: #f8fafc;
      letter-spacing: -0.01em;
    }
    .main-logo {
      font-size: 2.25rem;
      color: #10b981;
      font-family: 'Vazirmatn','Montserrat',sans-serif;
      letter-spacing:-1px;
      filter: drop-shadow(0 0 9px #e0fdfa88);
      font-weight: 900;
      user-select: none;
      line-height: 2.6rem;
    }
    @media (max-width: 640px) {
      .main-logo {font-size: 1.3rem; line-height:2rem;}
    }
    .area-btn {
      background: linear-gradient(90deg,#e0fdfa 0%,#d2fbf1 100%);
      color: #10b981;
      font-weight: 800;
      border-radius: 1rem;
      font-size: 1rem;
      min-width: 90px;
      padding: 10px 0 11px 0;
      margin-inline-end: 6px;
      margin-bottom: 3px;
      transition: all 0.16s;
      box-shadow: 0 1.5px 8px #bbf7d0a1;
      outline: none;
      border: none;
      cursor: pointer;
      font-family: 'Vazirmatn', 'Montserrat', sans-serif;
    }
    .area-btn.active, .area-btn:hover {
      background: linear-gradient(90deg,#10b981,#0ea5e9);
      color: #fff;
      box-shadow: 0 8px 36px #10b98122;
      transform: scale(1.055);
    }
    /* دکمه مراکز خرید */
    .center-btn {
      background: #fff;
      border: 2px solid #10b98133;
      color: #13bfa4;
      font-weight: 900;
      border-radius: 1.3rem;
      font-size: 1.08rem;
      width: 350px;
      max-width: 95vw;
      padding: 13px 0;
      margin-bottom: 3px;
      box-shadow: 0 2px 16px #6ee7b78c;
      transition: all 0.18s;
      text-align: center;
      letter-spacing: -.5px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .center-btn:hover {
      background: linear-gradient(90deg,#0ea5e9,#10b981);
      color: #fff;
      border-color: #0ea5e9;
      box-shadow: 0 7px 26px #10b98136;
      transform: scale(1.045);
    }

    .more-centers-btn {
      background: linear-gradient(90deg,#10b981,#0ea5e9);
      color: #fff;
      font-weight: 800;
      border-radius: 9999px;
      font-size: 0.98rem;
      padding: 10px 22px;
      box-shadow: 0 5px 20px #0ea5e926;
      transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .more-centers-btn:hover {
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 12px 30px #0ea5e933;
      filter: brightness(1.05);
    }

    .more-centers-btn svg {
      width: 18px;
      height: 18px;
    }

    .centers-modal { 
      display: none; 
      padding: 1.5rem; 
      align-items: center; 
      justify-content: center; 
    }

    .centers-modal.active { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
    }

    .center-info-modal {
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1.25rem;
    }

    .center-info-modal.active {
      display: flex;
    }

    .center-info-card {
      width: min(100%, 420px);
      border-radius: 1.8rem;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(224, 253, 250, 0.95));
      box-shadow: 0 28px 55px -30px rgba(14, 165, 233, 0.55), 0 18px 40px -35px rgba(16, 185, 129, 0.55);
      border: 1.4px solid rgba(13, 148, 136, 0.18);
      overflow: hidden;
    }

    .center-info-header {
      display: flex;
      align-items: center;
      gap: 0.85rem;
      margin-bottom: 1.1rem;
    }

    .center-info-icon {
      width: 48px;
      height: 48px;
      border-radius: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.85), rgba(14, 165, 233, 0.85));
      color: #fff;
      box-shadow: 0 12px 28px -16px rgba(14, 165, 233, 0.6);
    }

    .center-info-title {
      font-size: 1.35rem;
      font-weight: 900;
      color: #0f9a8b;
    }

    .center-info-address {
      font-size: 1.05rem;
      font-weight: 700;
      line-height: 1.9rem;
      color: #0ea5e9;
      background: rgba(255, 255, 255, 0.75);
      border-radius: 1.2rem;
      padding: 1rem 1.2rem;
      border: 1.2px dashed rgba(14, 165, 233, 0.35);
    }

    .center-info-close {
      position: absolute;
      top: 18px;
      left: 18px;
      font-size: 1.7rem;
      color: #0f9a8b;
      transition: color 0.2s ease;
    }

    .center-info-close:hover {
      color: #0ea5e9;
    }

    .centers-modal-content { 
      max-height: 85vh; 
      overflow-y: auto; 
      width: min(100%, 680px); 
    }

    .centers-modal-list {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .centers-loading {
      width: 100%;
      text-align: center;
      color: #0f9a8b;
      font-weight: 700;
      padding: 12px 0;
    }

    @media (min-width: 768px) {
      .centers-modal-list {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .modal-area-item {
      display: flex;
      align-items: stretch;
      gap: 0.65rem;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 1.6rem;
      padding: 0.35rem;
      box-shadow: 0 4px 18px rgba(14, 165, 233, 0.14);
      border: 1px solid rgba(16, 185, 129, 0.14);
    }

    .modal-area-btn {
      background: #f0fffa;
      border: 1.5px solid #bbf7d0;
      color: #0f9a8b;
      font-weight: 800;
      border-radius: 1.4rem;
      padding: 10px 18px;
      font-size: 0.92rem;
      transition: all 0.18s ease;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      box-shadow: 0 3px 12px #0ea5e911;
      flex: 1 1 auto;
      min-width: 0;
    }

    .modal-area-btn span {
      font-weight: 900;
      font-size: 0.95rem;
    }

    .modal-center-name {
      display: inline-block;
      color: #0f9a8b;
    }

    .modal-area-btn small {
      display: block;
      margin-top: 0.25rem;
      font-weight: 700;
      color: #0ea5e9;
      font-size: 0.75rem;
    }

    .modal-area-btn small + small {
      color: #0f9a8b;
      opacity: 0.85;
    }

    .modal-area-btn:hover {
      background: linear-gradient(90deg,#10b981,#0ea5e9);
      color: #fff;
      border-color: transparent;
      box-shadow: 0 10px 26px #0ea5e92b;
      transform: translateY(-1px);
    }

    .modal-area-info-btn {
      background: linear-gradient(135deg, #10b981, #0ea5e9);
      border: none;
      color: #fff;
      font-weight: 800;
      border-radius: 1.25rem;
      padding: 0 18px;
      min-width: 92px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      box-shadow: 0 8px 22px rgba(14, 165, 233, 0.28);
      transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
      white-space: nowrap;
    }

    .modal-area-info-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 28px rgba(14, 165, 233, 0.32);
      filter: brightness(1.05);
    }

    .modal-area-btn:focus-visible,
    .modal-area-info-btn:focus-visible {
      outline: 3px solid rgba(14, 165, 233, 0.35);
      outline-offset: 3px;
    }
    .selected-center-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      background: rgba(255,255,255,0.9);
      border: 1.5px solid #10b98133;
      border-radius: 9999px;
      padding: 0.55rem 1.3rem;
      color: #0ea5e9;
      box-shadow: 0 4px 14px #0ea5e91a;
      font-weight: 800;
    }

    .selected-center-indicator .selected-center-name {
      color: #0f9a8b;
      font-size: 0.95rem;
    }
    /* سلکت‌باکس ریسپانسیو */
    .category-select {
      appearance: none;
      background: #f6fffd;
      border: 1.7px solid #d1fae5;
      color: #08918e;
      font-weight: 800;
      padding: 12px 2.5rem 12px 1rem;
      min-width: 160px;
      font-size: 1.1rem;
      border-radius: 1.1rem;
      box-shadow: 0 1.5px 7px #bef5e1a7;
      transition: all 0.17s;
      outline: none;
      font-family: 'Vazirmatn', 'Montserrat', sans-serif;
      position: relative;
      direction: rtl;
    }

    .category-select {
  text-align: center;
  text-align-last: center; /* واسه مرورگرهای مدرن */
}








    .category-select:focus, .category-select:hover {
      border-color: #10b981;
      background: #e2f8f1;
      color: #10b981;
    }
    .category-select option {
      font-size: 1rem;
      font-weight: 600;
      color: #098981;
      background: #f6fefc;
    }
    .select-arrow {
      position: absolute;
      right: 18px;
      top: 52%;
      transform: translateY(-50%);
      pointer-events: none;
      font-size: 22px;
      color: #13bfa4;
      z-index: 10;
    }
    /* مناطق */
    .areas-scroll {
      position: relative;
      overflow-x: auto;
      scrollbar-width: none;
      scroll-behavior: smooth;
      padding-bottom: 3px;
      justify-content: center;
      -ms-overflow-style: none;
      mask-image: linear-gradient(to left, transparent 0, black 20px, black 95%, transparent 100%);
      -webkit-mask-image: linear-gradient(to left, transparent 0, black 20px, black 95%, transparent 100%);
    }
    .areas-scroll::-webkit-scrollbar { display: none; }
    @media (max-width: 1024px) {
      .shop-card { min-height: 170px; }
      .area-btn { font-size: .93rem; min-width: 65px; padding: 7px 0; }
      .center-btn {font-size: .99rem; min-width: 120px;}
    }
    @media (max-width: 640px) {
      .area-btn { font-size: 12.1px; padding: 6px 0; min-width: 47px;}
      .center-btn { font-size: 13px; padding: 9px 0; min-width: 70vw;}
      .shop-card { border-radius: .6rem; min-height: 80px; }
      .category-select { min-width: 86px !important; font-size: .97rem;}
      .centers-modal { padding: 0.75rem; align-items: flex-end; }
      .centers-modal-content {
        max-height: 78vh;
        border-radius: 1.75rem;
        padding: 1.75rem 1.4rem 1.5rem 1.4rem !important;
      }
      .centers-modal-list {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
      .modal-area-item {
        flex-direction: column;
        align-items: stretch;
        padding: 0.55rem;
        gap: 0.5rem;
      }
      .modal-area-btn {
        width: 100%;
        font-size: 1rem;
        padding: 12px 18px;
      }
      .modal-area-info-btn {
        width: 100%;
        padding: 12px 18px;
        font-size: 0.95rem;
      }
      .center-info-card {
        border-radius: 1.55rem;
        padding: 1.6rem 1.35rem !important;
      }
      .center-info-title {
        font-size: 1.15rem;
      }
      .center-info-address {
        font-size: 0.95rem;
        line-height: 1.7rem;
      }
      .selected-center-indicator {
        font-size: 0.9rem;
        padding-inline: 1rem;
        gap: 0.5rem;
      }
      .selected-center-indicator .selected-center-name {
        font-size: 0.95rem;
      }
    }
    @media (max-width: 480px) {
      .centers-modal-content {
        border-radius: 1.5rem;
        padding: 1.6rem 1.2rem 1.4rem 1.2rem !important;
      }
      .modal-area-btn {
        font-size: 0.92rem;
        padding: 11px 16px;
      }
      .modal-area-info-btn {
        font-size: 0.9rem;
        padding: 11px 16px;
      }
      .center-info-card {
        border-radius: 1.45rem;
        padding: 1.4rem 1.15rem !important;
      }
      .center-info-title {
        font-size: 1.05rem;
      }
      .center-info-address {
        font-size: 0.9rem;
        line-height: 1.6rem;
      }
      .selected-center-indicator {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.35rem;
        text-align: right;
      }
    }

    .centers-modal-badge {
      display: none;
    }

    @media (min-width: 641px) {
      .centers-modal {
        padding: 3rem 2.5rem;
        backdrop-filter: blur(14px);
      }

      .centers-modal-content {
        border-radius: 2.4rem;
        padding: 2.75rem 3rem 2.5rem 3rem !important;
        border: 1.5px solid #bbf7d0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 8%, rgba(208, 251, 241, 0.9) 100%);
        box-shadow: 0 28px 60px -28px #0ea5e955, 0 18px 40px -35px #10b98188;
        position: relative;
        overflow: hidden;
      }

      .centers-modal-content::before {
        content: '';
        position: absolute;
        inset: -55% -10% auto;
        height: 72%;
        background: radial-gradient(circle at top left, rgba(14, 165, 233, 0.14), transparent 55%);
        pointer-events: none;
      }

      .centers-modal-header {
        flex-direction: row !important;
        text-align: right !important;
        align-items: center;
        gap: 1.8rem !important;
      }

      .centers-modal-badge {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 92px;
        height: 92px;
        border-radius: 50%;
        background: linear-gradient(135deg, #10b981, #0ea5e9);
        box-shadow: 0 18px 45px -24px #0ea5e9aa;
        color: #fff;
      }

      .centers-modal-title {
        font-size: 2.2rem !important;
        color: #0f9a8b !important;
      }

      .centers-modal-subtitle {
        font-size: 1.05rem !important;
        color: #0ea5e9 !important;
      }

      .centers-modal-list {
        margin-top: 2.75rem !important;
        grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
      }

      .modal-area-item {
        flex-direction: row;
        align-items: center;
        gap: 0.75rem;
        padding: 0.6rem;
      }

      .modal-area-btn {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: center;
        gap: 0.4rem;
        padding: 1.1rem 1.35rem;
        border-radius: 1.4rem;
        width: 100%;
        min-height: 108px;
        text-align: right;
        background: linear-gradient(135deg, rgba(240, 255, 250, 0.96), rgba(236, 254, 245, 0.96));
        border-color: #99f6e4;
        box-shadow: 0 20px 46px -32px rgba(14, 165, 233, 0.55);
        transition: transform 0.22s ease, box-shadow 0.22s ease, background 0.22s ease;
      }

      .modal-area-btn span {
        font-size: 1.05rem;
        color: #047857;
      }

      .modal-area-btn small {
        font-size: 0.82rem;
      }

      .modal-area-btn small + small {
        color: #0f9a8b;
      }

      .modal-area-btn:hover {
        transform: translateY(-4px) scale(1.015);
        box-shadow: 0 26px 52px -28px rgba(14, 165, 233, 0.65);
      }

      .modal-area-info-btn {
        min-height: 56px;
        padding: 0 22px;
        font-size: 0.92rem;
      }
    }
    /* هدر شیشه‌ای */
    .glass-bg {
      backdrop-filter: blur(12px);
      background: rgba(255,255,255,0.95) !important;
    }
    input:focus {border-color:#10b981 !important;}
    /* فروشگاه کارت */
    .shop-card {
      background: #fff;
      border-radius: 1.12rem;
      box-shadow: 0 5px 22px #10b98114, 0 2px 10px #0ea5e910;
      transition: transform .13s, box-shadow .15s;
      overflow: hidden;
      border: 1.3px solid #e0fdfa;
      min-height: 290px;
      font-family: 'Vazirmatn', 'Montserrat', sans-serif;
    }
    .shop-card:hover { 
      transform: scale(1.034);
      box-shadow: 0 10px 36px #0ea5e922;
      border-color: #10b98150;
    }
    @media (max-width: 640px) {
      .shop-card { padding: 0.8rem !important; min-height: 90px;}
    }
  </style>
</head>
<body class="min-h-screen flex flex-col bg-[#f8fafc]">

  <!-- هدر با لوگو اصلی -->
<header class="w-full sticky top-0 z-50 bg-white/90 backdrop-blur-[10px] shadow-md border-b border-[#e0fdfa]">
  <nav class="max-w-7xl mx-auto flex items-center justify-between px-2 sm:px-6 py-2 sm:py-3 gap-y-2">
    <!-- لوگوی Vitreenet -->
    <div class="flex items-center gap-4 flex-shrink-0">
      <a href="index.html" class="logo-vitreenet font-extrabold text-[1.7rem] sm:text-[2.2rem] text-[#11d6ad] tracking-wide drop-shadow hover:brightness-110 transition-all select-none">
        Vitreenet
      </a>
      <!-- بج شهر (سنندج) -->
      <div class="flex items-center gap-1 px-3 py-1 rounded-full shadow-lg"
        style="background:linear-gradient(90deg,#10b981E6 70%,#0ea5e9E6); border: 1.5px solid #fff6;">
        <svg width="18" height="18" fill="none" viewBox="0 0 22 22" class="ml-1 drop-shadow">
          <defs>
            <linearGradient id="city-icon" x1="0" y1="0" x2="22" y2="22" gradientUnits="userSpaceOnUse">
              <stop stop-color="#fff" />
              <stop offset="1" stop-color="#b2f2e9" />
            </linearGradient>
          </defs>
          <path d="M11 2.5C7.13 2.5 4 5.61 4 9.45c0 3.52 4.1 7.93 6.2 10.01.46.47 1.2.47 1.66 0 2.1-2.08 6.14-6.49 6.14-10.01C18 5.61 14.87 2.5 11 2.5Zm0 10.25a2.75 2.75 0 1 1 0-5.5 2.75 2.75 0 0 1 0 5.5Z"
            fill="url(#city-icon)"/>
        </svg>
        <span class="font-bold text-white text-[13px] sm:text-[14px] drop-shadow-sm" style="letter-spacing:.3px;">
          سنندج
        </span>
      </div>
    </div>
    <!-- منو -->
    <div class="flex items-center gap-2 sm:gap-4 ml-2">
      <a href="index.html" class="hidden sm:inline text-gray-700 hover:text-[#10b981] font-bold px-2 sm:px-3 transition">خانه</a>
      <a href="categories.html" class="hidden sm:inline text-gray-700 hover:text-[#0ea5e9] font-bold px-2 sm:px-3 transition">دسته‌بندی</a>
      <a href="login.html" class="hidden sm:inline text-gray-700 hover:text-[#0ea5e9] font-bold px-2 sm:px-3 transition">ورود</a>
      <!-- حساب کاربری واکنشی -->
      <a href="login.html"
        class="flex items-center gap-2 px-4 py-2 rounded-full bg-[#10b981]/10 hover:bg-[#0ea5e9]/15 text-[#10b981] hover:text-[#0ea5e9] font-bold shadow-sm transition-all duration-150 text-base"
        style="font-family: Vazirmatn, sans-serif;">
        <svg width="20" height="20" fill="none" viewBox="0 0 22 22">
          <circle cx="11" cy="7" r="4" stroke="currentColor" stroke-width="1.5" />
          <path d="M4 19c0-3.3 2.7-6 6-6s6 2.7 6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <span class="hidden xs:inline">حساب کاربری</span>
      </a>
      <!-- ثبت فروشگاه -->
      <a href="post.html"
        class="bg-gradient-to-l from-[#10b981] to-[#0ea5e9] hover:from-[#0ea5e9] hover:to-[#10b981] rounded-full px-5 py-2 text-white font-extrabold text-base shadow-sm transition-all duration-200 whitespace-nowrap"
        style="font-family: Vazirmatn, sans-serif;">
        ثبت فروشگاه
      </a>
    </div>
  </nav>
</header>

<!-- استایل لوگو Vitreenet (به بالای فایل <head> هم می‌تونی بذاری) -->
<style>
.logo-vitreenet {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(90deg,#10b981 5%,#0ea5e9 90%);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  letter-spacing: 2px;
  text-shadow: 0 2px 10px #0ea5e955;
}
@media (max-width: 640px) {
  .logo-vitreenet {font-size: 1.18rem !important;}
}
</style>


  <main class="flex-1 w-full max-w-6xl mx-auto px-3 sm:px-8 py-7 sm:py-12">
    <!-- تیتر و دکمه‌ها -->
    <div class="mb-5 flex items-center flex-col gap-3 sm:gap-4">
      <h1 class="main-title text-2xl sm:text-[2.18rem] font-extrabold text-center bg-gradient-to-l from-[#16c6b7] to-[#0ea5e9] text-transparent bg-clip-text tracking-tight leading-tight drop-shadow-lg" style="letter-spacing:-.6px">
        مغازه‌های شهر رو بگرد!
      </h1>
      <div class="flex flex-wrap gap-3 items-center justify-center">
        <button id="all-centers-btn" class="center-btn" type="button">
          همه مراکز خرید
        </button>
        <button id="more-centers-btn" class="more-centers-btn" type="button">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 5v14M5 12h14" />
          </svg>
          بیشتر
        </button>
      </div>
      <div id="selectedCenterIndicator" class="hidden selected-center-indicator mt-2">
        <span class="flex items-center gap-1 text-xs sm:text-sm text-[#0ea5e9]">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="text-[#10b981]">
            <circle cx="12" cy="12" r="9"></circle>
            <path d="m9.5 12.5 1.9 1.9 3.1-3.8"></path>
          </svg>
          مرکز خرید انتخاب شده:
        </span>
        <span id="selectedCenterName" class="selected-center-name text-sm sm:text-base"></span>
      </div>
    </div>
    <!-- مناطق معروف -->
    <div class="areas-scroll flex gap-2 mb-6 pb-1 justify-center" id="areasShort"></div>
    
    <!-- سرچ و سلکت -->
    <div class="relative flex flex-col md:flex-row gap-4 mb-9 items-center justify-between">
      <input id="searchInput" type="text" placeholder="جستجوی نام یا آدرس مغازه..." class="flex-1 py-3 px-5 border border-gray-200 rounded-full text-base shadow-sm focus:outline-none bg-white/80 w-full md:w-auto"/>
      <div class="relative w-full md:w-60">
        <select id="categorySelect" class="category-select w-full pr-9">
          <option value="">همه فروشگاه ها</option>
          <option>پوشاک</option>
          <option>خوراک</option>
          <option>خدمات</option>
          <option>دیجیتال</option>
          <option>زیبایی</option>
          <option>کتاب و تحریر</option>
          <option>لوازم خانگی</option>
          <option>ورزشی</option>
          <option>تالار و مجالس</option>
          <option>قنادی و شیرینی</option>
          <option>گل و گیاه</option>
          <option>خودرو</option>
        </select>
        <span class="select-arrow material-icons"></span>
      </div>
    </div>

    <!-- فروشگاه‌ها -->
    <div id="shopsList" class="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-5"></div>
    <div id="noResult" class="hidden text-center text-gray-400 text-lg p-12 font-bold">هیچ مغازه‌ای پیدا نشد!</div>
  </main>
  <div id="centersModal" class="centers-modal fixed inset-0 z-[999] items-center justify-center px-4">
    <div id="centersModalOverlay" class="absolute inset-0 bg-[#0f172a]/40 backdrop-blur-sm transition-opacity"></div>
    <div class="relative z-10 bg-white rounded-3xl shadow-2xl border border-[#e0fdfa] w-full max-w-3xl mx-auto p-6 sm:p-8 overflow-hidden centers-modal-content">
      <button id="closeCentersModal" class="absolute top-4 left-4 text-[#0f9a8b] hover:text-[#0ea5e9] transition-colors text-2xl font-bold" aria-label="بستن">
        &times;
      </button>
      <div class="centers-modal-header flex flex-col gap-4 text-center sm:text-right">
        <div class="centers-modal-badge mx-auto sm:mx-0">
          <svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 21h18" />
            <path d="M5 21V7.5a1.5 1.5 0 0 1 1.5-1.5H9" />
            <path d="M19 21V7.5A1.5 1.5 0 0 0 17.5 6H15" />
            <rect x="9" y="3" width="6" height="6" rx="1.2" />
            <path d="M9 12h6" />
            <path d="M9 16h6" />
          </svg>
        </div>
        <div class="flex flex-col gap-2">
          <h2 class="centers-modal-title text-2xl sm:text-3xl font-extrabold text-[#0ea5e9]">مراکز خرید سنندج</h2>
          <p class="centers-modal-subtitle text-sm sm:text-base text-[#0f9a8b] font-semibold">
            برای مشاهده فروشگاه‌های هر مرکز خرید روی نام آن کلیک کن.
          </p>
        </div>
      </div>
      <div id="centersList" class="centers-modal-list mt-6 grid gap-3 sm:gap-4 text-sm"></div>
    </div>
  </div>

  <div id="centerInfoModal" class="center-info-modal fixed inset-0 z-[1000] justify-center items-center">
    <div id="centerInfoOverlay" class="absolute inset-0 bg-[#0f172a]/45 backdrop-blur-sm"></div>
    <div class="relative z-10 center-info-card p-6 sm:p-8">
      <button id="closeCenterInfo" class="center-info-close" aria-label="بستن پاپ‌آپ">&times;</button>
      <div class="center-info-header">
        <div class="center-info-icon">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <path d="M9 22V12h6v10" />
          </svg>
        </div>
        <div>
          <h3 id="centerInfoTitle" class="center-info-title"></h3>
          <p class="text-sm font-semibold text-[#0ea5e9] opacity-80 mt-1">آدرس ثبت‌شده برای این مرکز خرید</p>
        </div>
      </div>
      <div class="center-info-address" id="centerInfoAddress"></div>
      <div id="centerInfoEmpty" class="hidden text-sm font-semibold text-[#64748b] bg-white/70 border border-[#e2e8f0] rounded-xl px-4 py-3 mt-4">
        آدرسی برای این مرکز خرید ثبت نشده است.
      </div>
    </div>
  </div>

  <footer class="w-full bg-gradient-to-tr from-[#f8fafc] via-[#e0fdfa] to-[#d4fbe8] border-t mt-16 px-2 pt-6 pb-3 text-center text-[15px] text-gray-500 rounded-t-[1.7rem] shadow-lg font-bold tracking-wide">
    © 2025 ویترینت | همه حقوق محفوظ است.
  </footer>
<script>
  const API_BASE = 'http://localhost:5000/api';
  const API_ORIGIN = 'http://localhost:5000';
  const numberFormatter = new Intl.NumberFormat('fa-IR');

  const FALLBACK_CENTERS = [
    { id: 'baneta', title: 'بانتا', order: 0 },
    { id: 'ferdowsi', title: 'فردوسی', order: 1 },
    { id: 'sanacenter', title: 'سنه سنتر', order: 2 },
    { id: 'tanakora', title: 'تاناکورا', order: 3 },
    { id: 'almas', title: 'الماس غرب', order: 4 },
    { id: 'abidar', title: 'آبیدر', order: 5 },
    { id: 'navid', title: 'نوید', order: 6 },
    { id: 'ghezel', title: 'قزل قایا', order: 7 },
    { id: 'shahrak', title: 'شهرک بهاران', order: 8 },
    { id: 'azadi', title: 'میدان آزادی', order: 9 },
    { id: 'masjed', title: 'خیابان مسجد جامع', order: 10 },
    { id: 'mellat', title: 'پارک ملت', order: 11 },
    { id: 'salar', title: 'سالار', order: 12 },
    { id: 'parastar', title: 'پرستار', order: 13 },
    { id: 'emam', title: 'بلوار امام', order: 14 },
    { id: 'ghadir', title: 'قدیر', order: 15 },
    { id: 'shohada', title: 'بلوار شهدا', order: 16 },
  ];

  let AREAS = [];
  let centersLoaded = false;
  let centersLoadingPromise = null;

  const normalizeForSearch = text => {
    if (!text) return '';
    return text
      .toString()
      .trim()
      .toLowerCase()
      .replace(/ي/g, 'ی')
      .replace(/ك/g, 'ک');
  };

  const formatNumber = value => {
    const num = Number(value);
    return numberFormatter.format(Number.isFinite(num) ? num : 0);
  };

  const slugifyCenter = (title, fallback = 'center') => {
    const base = normalizeForSearch(title || '').replace(/[^\p{L}\p{N}\s-]+/gu, '');
    if (!base) return fallback;
    return base.trim().replace(/\s+/g, '-');
  };

  const sortCenters = list => {
    return [...list].sort((a, b) => {
      const orderA = Number.isFinite(a?.order) ? a.order : 0;
      const orderB = Number.isFinite(b?.order) ? b.order : 0;
      if (orderA !== orderB) return orderA - orderB;
      return (a?.name || '').localeCompare(b?.name || '', 'fa');
    });
  };

  const buildCenterKeywords = center => {
    const keywords = new Set();
    const add = value => {
      const normalized = normalizeForSearch(value);
      if (normalized) keywords.add(normalized);
    };
    add(center.title);
    add(center.name);
    add(center.tag);
    add(center.location);
    if (center.slug) {
      add(center.slug.replace(/-/g, ' '));
      add(center.slug.replace(/-/g, ''));
    }
    return Array.from(keywords);
  };

  const normalizeCenterRecord = (center, index = 0) => {
    if (!center) return null;
    const rawId = center.centerId || center._id || center.id || center._id?.$oid || '';
    const title = center.title || center.name || center.label || '';
    const slug = slugifyCenter(title || rawId || `center-${index}`, `center-${index}`);
    const id = rawId ? String(rawId) : (center.id ? String(center.id) : slug);
    const order = Number.isFinite(Number(center.order)) ? Number(center.order) : (Number.isFinite(Number(center.rank)) ? Number(center.rank) : (Number.isFinite(Number(center.position)) ? Number(center.position) : (center.orderIndex ?? index)));
    const record = {
      id,
      name: title || slug,
      title: title || slug,
      slug,
      location: center.location || center.address || '',
      tag: center.tag || center.badge || '',
      stores: Number.isFinite(Number(center.stores)) ? Number(center.stores) : (Number(center.shopCount) || 0),
      order,
      raw: center
    };
    record.matchKeywords = buildCenterKeywords(record);
    return record;
  };

  async function loadCentersFromBackend(force = false) {
    if (force) {
      centersLoaded = false;
      centersLoadingPromise = null;
    }

    if (centersLoaded && !force) return AREAS;

    if (!centersLoadingPromise) {
      centersLoadingPromise = (async () => {
        try {
          const res = await fetch(`${API_BASE}/shopping-centers`);
          if (res.ok) {
            const data = await res.json();
            if (Array.isArray(data) && data.length) {
              const normalized = data.map((center, idx) => normalizeCenterRecord(center, idx)).filter(Boolean);
              if (normalized.length) {
                AREAS = sortCenters(normalized);
                centersLoaded = true;
                return AREAS;
              }
            }
          }
        } catch (err) {
          console.warn('loadCentersFromBackend error:', err);
        }

        AREAS = sortCenters(FALLBACK_CENTERS.map((center, idx) => normalizeCenterRecord(center, idx)).filter(Boolean));
        centersLoaded = true;
        return AREAS;
      })().finally(() => {
        centersLoadingPromise = null;
      });
    }

    return centersLoadingPromise;
  }

  const detectCenterForShop = shop => {
    if (!shop || !AREAS.length) return null;
    const haystack = normalizeForSearch([
      shop.address,
      shop.desc,
      shop.storename,
      shop.customAddress,
      shop.location
    ].filter(Boolean).join(' '));
    if (!haystack) return null;
    return AREAS.find(area => area.matchKeywords?.some(keyword => haystack.includes(keyword))) || null;
  };

  const escapeHtml = value => {
    if (value === null || value === undefined) return '';
    return String(value)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  };

  const resolveShopImage = src => {
    if (!src) return 'https://via.placeholder.com/640x360.png?text=Shop';
    const str = String(src);
    if (str.startsWith('http://') || str.startsWith('https://') || str.startsWith('data:')) {
      return str;
    }
    return `${API_ORIGIN}/${str.replace(/^\/+/, '')}`;
  };

  let current = { area: null, category: "", search: "" };

  const selectedCenterIndicator = document.getElementById('selectedCenterIndicator');
  const selectedCenterName = document.getElementById('selectedCenterName');

  function getAreaNameById(id) {
    if (!id) return '';
    const found = AREAS.find(area => area.id === id);
    return found ? found.name : id;
  }

  function updateSelectedCenterIndicator() {
    if (!selectedCenterIndicator || !selectedCenterName) return;
    if (current.area) {
      selectedCenterName.textContent = getAreaNameById(current.area);
      selectedCenterIndicator.classList.remove('hidden');
    } else {
      selectedCenterIndicator.classList.add('hidden');
      selectedCenterName.textContent = '';
    }
  }

  // ساخت دکمه مناطق معروف (بالا)
  function renderAreasShort(selected = null) {
    const container = document.getElementById('areasShort');
    container.innerHTML = '';
    const activeArea = selected ?? current.area;
    if (!AREAS.length) {
      const placeholder = document.createElement('div');
      placeholder.className = 'centers-loading';
      placeholder.textContent = 'در حال بارگذاری مراکز خرید...';
      container.appendChild(placeholder);
      updateSelectedCenterIndicator();
      return;
    }

    sortCenters(AREAS).slice(0, 6).forEach(area => {
      const btn = document.createElement('button');
      btn.className = 'area-btn' + (activeArea === area.id ? ' active' : '');
      btn.textContent = area.name;
      btn.onclick = () => {
        current.area = (current.area === area.id) ? null : area.id;
        renderAreasShort(current.area);
        loadAllShops();
      };
      container.appendChild(btn);
    });
    updateSelectedCenterIndicator();
  }

  document.getElementById('categorySelect').onchange = function () {
    current.category = this.value;
    loadAllShops();
  }
  document.getElementById('searchInput').oninput = function () {
    current.search = this.value;
    loadAllShops();
  }
  document.getElementById('all-centers-btn').onclick = () => {
    current.area = null;
    renderAreasShort();
    loadAllShops();
    window.scrollTo({ top: document.getElementById('areasShort').offsetTop - 60, behavior: 'smooth' });
  };

  const centersModal = document.getElementById('centersModal');
  const centersList = document.getElementById('centersList');
  const centersModalOverlay = document.getElementById('centersModalOverlay');
  const openCentersBtn = document.getElementById('more-centers-btn');
  const closeCentersBtn = document.getElementById('closeCentersModal');
  const centerInfoModal = document.getElementById('centerInfoModal');
  const centerInfoOverlay = document.getElementById('centerInfoOverlay');
  const closeCenterInfoBtn = document.getElementById('closeCenterInfo');
  const centerInfoTitle = document.getElementById('centerInfoTitle');
  const centerInfoAddress = document.getElementById('centerInfoAddress');
  const centerInfoEmpty = document.getElementById('centerInfoEmpty');

  function openCentersModal() {
    centersModal.classList.add('active');
    document.body.classList.add('overflow-hidden');
  }

  function closeCentersModal() {
    centersModal.classList.remove('active');
    if (centerInfoModal?.classList.contains('active')) {
      centerInfoModal.classList.remove('active');
    }
    document.body.classList.remove('overflow-hidden');
  }

  function openCenterInfoModal(area) {
    if (!centerInfoModal || !area) return;
    const location = (area.location || '').trim();
    if (centerInfoTitle) {
      centerInfoTitle.textContent = area.name || 'مرکز خرید';
    }
    if (centerInfoAddress && centerInfoEmpty) {
      if (location) {
        centerInfoAddress.textContent = location;
        centerInfoAddress.classList.remove('hidden');
        centerInfoEmpty.classList.add('hidden');
      } else {
        centerInfoAddress.textContent = '';
        centerInfoAddress.classList.add('hidden');
        centerInfoEmpty.classList.remove('hidden');
      }
    }
    centerInfoModal.classList.add('active');
    document.body.classList.add('overflow-hidden');
  }

  function closeCenterInfoModal() {
    if (!centerInfoModal) return;
    centerInfoModal.classList.remove('active');
    if (!centersModal?.classList.contains('active')) {
      document.body.classList.remove('overflow-hidden');
    }
  }

  function renderCentersModal() {
    if (!centersList) return;
    centersList.innerHTML = '';
    if (!AREAS.length) {
      const placeholder = document.createElement('div');
      placeholder.className = 'centers-loading';
      placeholder.textContent = 'در حال بارگذاری مراکز خرید...';
      centersList.appendChild(placeholder);
      return;
    }
    sortCenters(AREAS).forEach(area => {
      const item = document.createElement('div');
      item.className = 'modal-area-item';

      const selectBtn = document.createElement('button');
      selectBtn.type = 'button';
      selectBtn.className = 'modal-area-btn';
      const nameHtml = escapeHtml(area.name);
      const tagHtml = area.tag ? `<small>${escapeHtml(area.tag)}</small>` : '';
      selectBtn.innerHTML = `
        <span class="modal-center-name" data-center-id="${escapeHtml(area.id)}">${nameHtml}</span>
        ${area.stores ? `<small>${formatNumber(area.stores)} فروشگاه</small>` : ''}
        ${tagHtml}
      `;
      selectBtn.onclick = () => {
        current.area = area.id;
        renderAreasShort(area.id);
        loadAllShops();
        closeCentersModal();
        window.scrollTo({ top: document.getElementById('areasShort').offsetTop - 40, behavior: 'smooth' });
      };

      const infoBtn = document.createElement('button');
      infoBtn.type = 'button';
      infoBtn.className = 'modal-area-info-btn';
      infoBtn.textContent = 'آدرس';
      infoBtn.addEventListener('click', event => {
        event.stopPropagation();
        openCenterInfoModal(area);
      });

      item.appendChild(selectBtn);
      item.appendChild(infoBtn);
      centersList.appendChild(item);
    });
  }

  if (openCentersBtn) {
    openCentersBtn.addEventListener('click', async () => {
      await loadCentersFromBackend();
      renderCentersModal();
      openCentersModal();
    });
  }

  [centersModalOverlay, closeCentersBtn].forEach(el => {
    if (el) {
      el.addEventListener('click', closeCentersModal);
    }
  });

  [centerInfoOverlay, closeCenterInfoBtn].forEach(el => {
    if (el) {
      el.addEventListener('click', closeCenterInfoModal);
    }
  });

  document.addEventListener('keydown', event => {
    if (event.key === 'Escape') {
      if (centersModal.classList.contains('active')) {
        closeCentersModal();
      }
      if (centerInfoModal?.classList.contains('active')) {
        closeCenterInfoModal();
      }
    }
  });

  // دریافت و نمایش مغازه‌های واقعی از بک‌اند + فیلتر سمت کلاینت
  async function loadAllShops() {
    const list = document.getElementById('shopsList');
    const empty = document.getElementById('noResult');
    if (!list || !empty) return;

    list.innerHTML = '<div style="margin: 50px auto;">در حال بارگذاری...</div>';
    empty.classList.add('hidden');

    try {
      await loadCentersFromBackend();
      const res = await fetch(`${API_BASE}/shops`);
      if (!res.ok) throw new Error('خطا در دریافت فروشگاه‌ها');
      const data = await res.json();
      const shopsArray = Array.isArray(data)
        ? data
        : Array.isArray(data?.shops)
          ? data.shops
          : Array.isArray(data?.data)
            ? data.data
            : [];

      const enriched = shopsArray.map(shop => {
        const center = detectCenterForShop(shop);
        return {
          ...shop,
          centerId: center?.id || null,
          centerName: center?.name || '',
          centerLocation: center?.location || '',
          centerTag: center?.tag || ''
        };
      });

      const searchTerm = normalizeForSearch(current.search);
      const categoryFilter = normalizeForSearch(current.category);

      const filtered = enriched.filter(shop => {
        const matchesCenter = !current.area || shop.centerId === current.area;
        const matchesCategory = !categoryFilter || normalizeForSearch(shop.category) === categoryFilter;
        const matchesSearch = !searchTerm || [
          shop.storename,
          shop.address,
          shop.centerName,
          shop.category
        ].some(field => normalizeForSearch(field).includes(searchTerm));
        return matchesCenter && matchesCategory && matchesSearch;
      });

      list.innerHTML = '';

      if (!filtered.length) {
        empty.classList.remove('hidden');
        return;
      }

      filtered.forEach(shop => {
        const areaName = shop.centerName || '';
        const categoryLabel = shop.category || '';
        const storeName = shop.storename || 'بدون نام';
        const address = shop.address || '';
        const phone = shop.phone || '';
        const imageSrc = resolveShopImage(shop.boardImage || shop.banner);
        const centerBadgeTitle = shop.centerLocation ? `title="${escapeHtml(shop.centerLocation)}"` : '';

        const card = document.createElement('div');
        card.className = `
          shop-card flex flex-col justify-between items-stretch
          p-3 sm:p-4 group transition-all duration-200
          relative hover:-translate-y-1 hover:shadow-2xl
        `;

        card.innerHTML = `
          <div class="relative w-full aspect-[4/3] mb-4 rounded-xl overflow-hidden
                      flex items-center justify-center
                      bg-gradient-to-tr from-[#e0fdfa] to-[#e0f7fa]
                      border-2 border-[#10b98112] group-hover:border-[#10b98144] shadow">
            <img
              src="${imageSrc}"
              alt="${escapeHtml(storeName)}"
              loading="lazy"
              class="w-full h-full object-cover object-center transition-all duration-200 group-hover:scale-105"
              style="aspect-ratio:4/3;max-height:260px;"
            />
            <span class="absolute top-2 left-2 bg-[#10b981] text-white text-xs font-bold px-2 py-1 rounded-full shadow group-hover:bg-[#0ea5e9] transition-all duration-150">جدید</span>
          </div>
          <div class="w-full flex flex-row-reverse items-center justify-between mb-2 gap-1">
            <span class="inline-block bg-[#10b981]/10 text-[#10b981] text-[12px] font-extrabold px-2 py-1 rounded-full ml-1">${escapeHtml(categoryLabel)}</span>
            <span class="center-badge inline-block bg-[#0ea5e9]/10 text-[#0ea5e9] text-[12px] font-extrabold px-2 py-1 rounded-full" ${centerBadgeTitle}>${escapeHtml(areaName || 'سایر مراکز')}</span>
          </div>
          <h4 class="font-bold text-base sm:text-lg text-[#10b981] text-center mb-2 truncate w-full group-hover:text-[#0ea5e9] transition-all">${escapeHtml(storeName)}</h4>
          <div class="text-[#13bfa4] font-extrabold text-sm mb-1">${escapeHtml(address)}</div>
          ${phone ? `<div class="text-gray-400 text-xs font-bold mt-1 flex items-center gap-1 justify-center"><svg width="16" height="16" viewBox="0 0 24 24" fill="#10b981"><path d="M6.62 10.79a15.054 15.054 0 006.59 6.59l2.2-2.2a1.003 1.003 0 011.01-.24c1.12.37 2.33.57 3.58.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C10.07 21 3 13.93 3 5c0-.55.45-1 1-1h3.01c.55 0 1 .45 1 1 0 1.25.2 2.46.57 3.59a1 1 0 01-.24 1.01l-2.2 2.19z"/></svg> ${escapeHtml(phone)}</div>` : ''}
          <div class="flex-1"></div>
          <a href="shop.html?shopurl=${encodeURIComponent(shop.shopurl || '')}" class="w-full inline-block mt-4 bg-gradient-to-l from-[#10b981] to-[#0ea5e9] hover:from-[#0ea5e9] hover:to-[#10b981] rounded-full px-4 py-2 text-white font-extrabold text-sm shadow transition-all duration-200 text-center">
            مشاهده فروشگاه
          </a>
        `;

        list.appendChild(card);
      });

    } catch (e) {
      list.innerHTML = '<div class="text-red-500 text-center w-full p-8">مشکل در ارتباط با سرور!</div>';
    }
  }


  // اجرای اولیه
  (async () => {
    await loadCentersFromBackend();
    renderAreasShort();
    renderCentersModal();
    updateSelectedCenterIndicator();
    await loadAllShops();
  })();
</script>

</body>
</html>
