# مشخصات طراحی ماژول تبلیغ ویژه
# Featured Ad Module Specification

## خلاصه تغییرات
تبلیغات جستجو از یک پاپ‌آپ شناور به یک ماژول مستقل «پیشنهاد ویژه» تبدیل شده که:
- کاملاً جدا از نتایج جستجو است
- با برچسب «تبلیغ» مشخص شده
- قابلیت بستن (dismiss) دارد
- محدودیت فرکانس نمایش دارد

---

## ساختار UI

### موبایل (< 640px)
```
┌─────────────────────────────────────┐
│  🔍  جستجوی مغازه، محصول یا برند...  │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ [تبلیغ] پیشنهاد ویژه           [×] │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │                                 │ │
│ │         تصویر محصول             │ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 🏪 نام فروشگاه                      │
│ عنوان تبلیغ                         │
│ توضیحات کوتاه...                    │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │         مشاهده ←                │ │  (min-height: 48px)
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘

        ─── نتایج جستجو ───

┌─────────────────────────────────────┐
│ نتایج جستجو              [بستن ×]  │
├─────────────────────────────────────┤
│ کارت نتیجه ۱                        │
│ کارت نتیجه ۲                        │
│ ...                                 │
└─────────────────────────────────────┘
```

### دسکتاپ (≥ 640px)
```
┌───────────────────────────────────────────────┐
│  🔍  جستجوی مغازه، محصول یا برند...           │
└───────────────────────────────────────────────┘

┌───────────────────────────────────────────────┐
│ [تبلیغ] پیشنهاد ویژه                     [×] │
├───────────────────────────────────────────────┤
│ ┌────────┐  🏪 نام فروشگاه                    │
│ │        │  عنوان تبلیغ                       │
│ │  IMG   │  توضیحات کوتاه...                  │
│ │        │                                    │
│ └────────┘  [مشاهده ←]                        │
└───────────────────────────────────────────────┘

              ─── نتایج جستجو ───

┌───────────────────────────────────────────────┐
│ نتایج جستجو                        [بستن ×]  │
├───────────────────────────────────────────────┤
│ کارت نتیجه ۱                                  │
│ کارت نتیجه ۲                                  │
└───────────────────────────────────────────────┘
```

---

## متن‌های فارسی (Microcopy)

| عنصر | متن |
|------|-----|
| بج تبلیغ | `تبلیغ` |
| عنوان بخش | `پیشنهاد ویژه` |
| دکمه CTA | `مشاهده` |
| دکمه بستن | `×` (آیکون) |
| جداکننده | `نتایج جستجو` |

---

## ویژگی‌های کلیدی

### ۱. جداسازی کامل از نتایج
- تبلیغ در یک ماژول مستقل نمایش داده می‌شود
- جداکننده بصری بین تبلیغ و نتایج
- هیچ‌گاه به عنوان نتیجه جستجو نمایش داده نمی‌شود

### ۲. محدودیت فرکانس (Frequency Cap)
- حداکثر ۳ بار نمایش در هر session
- ذخیره در `sessionStorage`
- کلید: `vt_featured_ad_impressions`

### ۳. قابلیت بستن (Dismiss)
- دکمه × در گوشه بالا
- پس از بستن، تا پایان session نمایش داده نمی‌شود
- کلید: `vt_featured_ad_dismissed`

### ۴. چرخش تبلیغات (Rotation)
- اگر چند تبلیغ فعال باشد، هر ۳۰ ثانیه چرخش
- پشتیبانی از چند تبلیغ همزمان

### ۵. ردیابی (Tracking)
- Impression: هر بار نمایش تبلیغ
- Click: هر بار کلیک روی تبلیغ
- Session ID برای تحلیل

---

## API Endpoints

### دریافت تبلیغات
```
GET /api/adOrder/active?planSlug=ad_search
```

### ثبت Impression
```
POST /api/adOrder/impression
Body: { adId, sessionId, timestamp }
```

### ثبت Click
```
POST /api/adOrder/click
Body: { adId, sessionId, timestamp }
```

---

## فایل‌ها

| فایل | توضیح |
|------|-------|
| `public/css/featured-ad-module.css` | استایل‌های ماژول |
| `public/js/featured-ad-module.js` | منطق JavaScript |
| `public/index.html` | ساختار HTML |

---

## Accessibility

- `role="complementary"` برای ماژول
- `aria-label="تبلیغ ویژه"`
- دکمه‌ها با `aria-label`
- پشتیبانی از کیبورد
- `prefers-reduced-motion` برای انیمیشن‌ها

---

## رنگ‌ها

| عنصر | رنگ |
|------|-----|
| بج تبلیغ | `#047857` روی `#d1fae5` |
| عنوان | `#0f172a` |
| توضیحات | `#64748b` |
| CTA | سفید روی گرادیان سبز-آبی |
| بوردر | `rgba(16, 185, 129, 0.18)` |

---

## حالت‌های مختلف

### ۱. Loading
- اسکلتون با انیمیشن shimmer
- نمایش ساختار کارت بدون محتوا

### ۲. Visible
- کارت تبلیغ با تمام اطلاعات
- انیمیشن fade-in نرم

### ۳. Dismissed
- مخفی شدن با `display: none`
- ذخیره وضعیت در session

### ۴. Frequency Capped
- پس از ۳ بار نمایش، دیگر نمایش داده نمی‌شود

---

## JavaScript API

```javascript
// نمایش تبلیغ
window.FeaturedAdModule.show();

// مخفی کردن
window.FeaturedAdModule.hide();

// بستن (dismiss)
window.FeaturedAdModule.dismiss();

// بارگذاری مجدد
window.FeaturedAdModule.refresh();

// دریافت وضعیت
window.FeaturedAdModule.getState();
```
