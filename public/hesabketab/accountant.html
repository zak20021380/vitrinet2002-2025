<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>حسابداری حرفه‌ای فروشگاه</title>
    <meta name="description" content="سیستم حسابداری حرفه‌ای برای فروشگاه‌داران">
    <meta name="theme-color" content="#4F46E5">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #4F46E5;
            --primary-light: #818CF8;
            --primary-dark: #4338CA;
            --secondary: #6B7280;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
            --light: #F9FAFB;
            --dark: #111827;
            --white: #FFFFFF;
            --body-bg: #F3F4F6;
            --card-bg: #FFFFFF;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --border-color: #E5E7EB;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --fab-size: 56px;
            --bottom-nav-height: 70px;
            --safe-area-inset-top: env(safe-area-inset-top, 0px);
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
            color-scheme: light dark;
        }
        
        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            :root {
                --transition: none;
            }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Vazirmatn', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--body-bg);
            color: var(--text-primary);
            line-height: 1.6;
            direction: rtl;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: calc(var(--bottom-nav-height) + var(--safe-area-inset-bottom));
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
            -webkit-tap-highlight-color: transparent;
        }
        
        .app-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding: 0 16px;
        }
        
        /* Header */
        .app-header {
            background: var(--white);
            padding: 16px;
            margin-bottom: 16px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: var(--safe-area-inset-top);
            z-index: 50;
            transition: var(--transition);
        }
        
        .shop-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .shop-name i {
            color: var(--primary-light);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .date-display {
            font-size: 0.875rem;
            color: var(--text-secondary);
            background: var(--light);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        /* Views */
        .view-container {
            flex: 1;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .view-container.active {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Cards */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            transition: var(--transition);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card.highlight {
            border-right: 3px solid var(--primary);
        }

        .card-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .card-section-title {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-title i {
            color: var(--primary);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }

        .quick-action {
            background: var(--light);
            border: 1px dashed var(--border-color);
            border-radius: var(--radius);
            padding: 16px 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
        }

        .quick-action i {
            font-size: 1.5rem;
            color: var(--primary);
            transition: var(--transition);
        }

        .quick-action:hover,
        .quick-action:focus-visible {
            background: rgba(79, 70, 229, 0.08);
            border-color: var(--primary-light);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .quick-action:hover i,
        .quick-action:focus-visible i {
            transform: scale(1.05);
        }

        .quick-action-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.4;
            display: block;
        }

        .quick-action-title {
            font-size: 0.95rem;
        }

        .summary-grid {
            display: grid;
            gap: 16px;
        }

        .summary-item {
            background: var(--light);
            padding: 12px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        .summary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .summary-value {
            font-weight: 700;
            color: var(--text-primary);
        }

        .progress {
            background: rgba(79, 70, 229, 0.08);
            border-radius: 999px;
            overflow: hidden;
            height: 8px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: 999px;
            transition: width 0.4s ease;
        }

        .progress-label {
            margin-top: 8px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        .task-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .task-item {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            background: var(--white);
            transition: var(--transition);
        }

        .task-item:hover {
            border-color: var(--primary-light);
            box-shadow: var(--shadow-md);
        }

        .task-label {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            line-height: 1.5;
            color: var(--text-primary);
            font-weight: 500;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid var(--border-color);
            accent-color: var(--primary);
            margin-top: 2px;
        }

        .task-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: flex-end;
        }

        .task-progress {
            margin-bottom: 16px;
        }

        .task-progress-value {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 6px;
            text-align: left;
        }

        .timeline {
            display: flex;
            flex-direction: column;
            gap: 16px;
            position: relative;
        }

        .timeline::before {
            content: '';
            position: absolute;
            inset-inline-start: 12px;
            top: 4px;
            bottom: 4px;
            width: 2px;
            background: var(--border-color);
        }

        .timeline-item {
            display: flex;
            gap: 16px;
            padding-inline-start: 28px;
            position: relative;
        }

        .timeline-indicator {
            position: absolute;
            inset-inline-start: 4px;
            top: 0;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--white);
            border: 2px solid var(--primary);
        }

        .timeline-content {
            background: var(--light);
            border-radius: var(--radius);
            padding: 12px;
            border: 1px solid var(--border-color);
            flex: 1;
        }

        .timeline-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .timeline-meta {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 6px;
        }

        .supplier-list {
            width: 100%;
            border-collapse: collapse;
        }

        .supplier-list th,
        .supplier-list td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
            text-align: right;
            font-size: 0.875rem;
        }

        .supplier-list tbody tr:hover {
            background: rgba(79, 70, 229, 0.05);
        }

        .supplier-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .mini-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 999px;
            font-size: 0.75rem;
            background: rgba(59, 130, 246, 0.12);
            color: var(--info);
        }

        .card-divider {
            height: 1px;
            background: var(--border-color);
            margin: 16px 0;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 16px;
            border: none;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 0.75rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        
        .btn-outline:hover {
            background: var(--light);
            color: var(--text-primary);
            border-color: var(--primary);
        }
        
        .btn-success {
            background: var(--success);
            color: var(--white);
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }
        
        .btn-danger:hover {
            background: #DC2626;
        }
        
        .btn-block {
            display: flex;
            width: 100%;
        }

        .btn:focus-visible,
        .nav-item:focus-visible,
        .speed-dial-btn:focus-visible,
        .dark-mode-toggle:focus-visible,
        .modal-close:focus-visible,
        .toast-action:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        .btn,
        .nav-item,
        .speed-dial-btn,
        .dark-mode-toggle,
        .modal-close,
        .toast-action,
        .fab {
            touch-action: manipulation;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: var(--primary);
            border-radius: var(--radius) 0 0 var(--radius);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        /* Lists */
        .list-group {
            list-style: none;
        }
        
        .list-item {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .list-item:last-child {
            border-bottom: none;
        }
        
        .list-item:hover {
            background-color: rgba(79, 70, 229, 0.05);
        }
        
        .list-item-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .list-item-subtitle {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .badge-success {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .badge-danger {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }
        
        .badge-warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        /* Search */
        .search-box {
            position: relative;
            margin-bottom: 16px;
        }
        
        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .search-input {
            width: 100%;
            padding: 12px 40px 12px 12px;
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 0.875rem;
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        /* FAB */
        .fab {
            position: fixed;
            bottom: calc(var(--bottom-nav-height) + 20px + var(--safe-area-inset-bottom));
            left: 20px;
            inset-inline-start: 20px;
            width: var(--fab-size);
            height: var(--fab-size);
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            border: none;
            box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            z-index: 100;
            transition: var(--transition);
        }
        
        .fab:hover {
            transform: scale(1.05) rotate(90deg);
            box-shadow: 0 15px 30px -5px rgba(79, 70, 229, 0.6);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.96);
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            height: var(--bottom-nav-height);
            z-index: 100;
            padding-bottom: var(--safe-area-inset-bottom);
            padding-inline: 8px;
            align-items: stretch;
            gap: 4px;
            backdrop-filter: blur(12px);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            position: relative;
            background: transparent;
            border: none;
            font: inherit;
            height: 100%;
            width: 100%;
            gap: 4px;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
            border-radius: 0 0 3px 3px;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
            transition: var(--transition);
        }
        
        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }
        
        .nav-label {
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 16px;
            animation: fadeIn 0.3s ease;
            outline: none;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .modal-close:hover {
            background-color: var(--light);
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--text-primary);
        }
        
        .form-control {
            display: block;
            width: 100%;
            padding: 12px 16px;
            font-size: 0.875rem;
            color: var(--text-primary);
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .form-control.error {
            border-color: var(--danger);
        }
        
        .error-message {
            color: var(--danger);
            font-size: 0.75rem;
            margin-top: 4px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: calc(var(--bottom-nav-height) + 20px + var(--safe-area-inset-bottom));
            left: 20px;
            right: 20px;
            inset-inline-start: 20px;
            inset-inline-end: 20px;
            background: var(--dark);
            color: var(--white);
            padding: 16px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
            pointer-events: none;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }
        
        .toast-message {
            flex: 1;
            font-weight: 500;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .toast-icon {
            font-size: 1.25rem;
        }
        
        /* Chart Container */
        .chart-container {
            position: relative;
            height: 250px;
            margin-bottom: 20px;
        }
        
        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table th {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .data-table tr:hover {
            background-color: rgba(79, 70, 229, 0.05);
        }
        
        /* Product Card */
        .product-card {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            margin-bottom: 12px;
            transition: var(--transition);
        }
        
        .product-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }
        
        .product-image {
            width: 60px;
            height: 60px;
            border-radius: var(--radius);
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 16px;
        }
        
        .product-image i {
            font-size: 24px;
            color: var(--primary);
        }
        
        .product-info {
            flex: 1;
        }
        
        .product-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .product-code {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .product-price {
            font-weight: 700;
            color: var(--primary);
        }
        
        .product-stock {
            font-size: 0.75rem;
            margin-top: 4px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            color: var(--border-color);
        }
        
        .empty-state-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .empty-state-description {
            margin-bottom: 20px;
        }
        
        /* Steps for multi-step forms */
        .steps {
            display: flex;
            margin-bottom: 24px;
            position: relative;
        }
        
        .step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--border-color);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .step.active .step-number {
            background: var(--primary);
        }
        
        .step.completed .step-number {
            background: var(--success);
        }
        
        .step-title {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .step.active .step-title {
            color: var(--primary);
        }
        
        .step::before {
            content: '';
            position: absolute;
            top: 16px;
            right: 50%;
            width: 100%;
            height: 2px;
            background: var(--border-color);
            z-index: -1;
        }
        
        .step:last-child::before {
            display: none;
        }
        
        .step.completed::before {
            background: var(--success);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            :root {
                --bottom-nav-height: 68px;
                --fab-size: 52px;
            }

            .app-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .bottom-nav {
                padding-inline: 16px;
            }
        }

        @media (max-width: 480px) {
            .app-container {
                padding: 0 12px;
            }

            .card {
                padding: 16px;
            }

            .fab {
                inset-inline-start: 16px;
            }

            .toast {
                inset-inline-start: 16px;
                inset-inline-end: 16px;
            }
        }

        @media (min-width: 768px) {
            .app-container {
                padding: 0 24px;
            }

            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .app-container {
                padding: 0 32px;
            }
        }
        
        /* Dark Mode */
        .dark-mode {
            --body-bg: #111827;
            --card-bg: #1F2937;
            --text-primary: #F9FAFB;
            --text-secondary: #9CA3AF;
            --border-color: #374151;
            --light: #1F2937;
            --white: #1F2937;
        }

        .dark-mode .bottom-nav {
            background: rgba(17, 24, 39, 0.9);
            box-shadow: 0 -4px 12px -1px rgba(0, 0, 0, 0.6);
        }

        .dark-mode .toast {
            background: rgba(17, 24, 39, 0.92);
        }
        
        .dark-mode-toggle {
            background: var(--light);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            transition: var(--transition);
        }
        
        .dark-mode-toggle:hover {
            background: var(--border-color);
        }
        
        /* Animations */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(79, 70, 229, 0); }
            100% { box-shadow: 0 0 0 0 rgba(79, 70, 229, 0); }
        }
        
        /* Speed Dial */
        .speed-dial {
            position: fixed;
            bottom: calc(var(--bottom-nav-height) + 90px + var(--safe-area-inset-bottom));
            left: 20px;
            inset-inline-start: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: flex-end;
            opacity: 0;
            transform: translateY(20px);
            transition: var(--transition);
            z-index: 90;
            pointer-events: none;
        }

        .speed-dial.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .speed-dial-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--white);
            color: var(--text-primary);
            border: none;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .speed-dial-btn:hover {
            background: var(--primary);
            color: var(--white);
            transform: scale(1.1);
        }
        
        .speed-dial-label {
            background: var(--dark);
            color: var(--white);
            padding: 6px 12px;
            border-radius: var(--radius);
            font-size: 0.75rem;
            font-weight: 500;
            margin-left: 12px;
            opacity: 0;
            transform: translateX(10px);
            transition: var(--transition);
        }
        
        .speed-dial-item {
            display: flex;
            align-items: center;
            opacity: 0;
            transform: translateY(10px);
            transition: var(--transition);
        }
        
        .speed-dial.active .speed-dial-item {
            opacity: 1;
            transform: translateY(0);
        }
        
        .speed-dial.active .speed-dial-item:nth-child(1) {
            transition-delay: 0.1s;
        }
        
        .speed-dial.active .speed-dial-item:nth-child(2) {
            transition-delay: 0.2s;
        }
        
        .speed-dial.active .speed-dial-item:nth-child(3) {
            transition-delay: 0.3s;
        }
        
        .speed-dial.active .speed-dial-item:nth-child(4) {
            transition-delay: 0.4s;
        }
        
        .speed-dial.active .speed-dial-label {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
  <script src="/nav-active.js" defer></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="shop-name">
                <i class="fas fa-store" aria-hidden="true"></i>
                فروشگاه من
            </div>
            <div class="header-actions">
                <div class="date-display" id="currentDate">
                    <i class="far fa-calendar-alt" aria-hidden="true"></i>
                    <span id="currentDateText" class="date-text">در حال بارگذاری...</span>
                </div>
                <button type="button" class="dark-mode-toggle" id="darkModeToggle" aria-pressed="false" aria-label="فعال‌سازی حالت تاریک">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                </button>
            </div>
        </header>
        
        <!-- Sales View -->
        <div class="view-container active" id="salesView" role="tabpanel" aria-labelledby="navSales" aria-hidden="false" tabindex="0">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">۱۲,۳۴۵,۰۰۰</div>
                    <div class="stat-label">فروش امروز</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">۸</div>
                    <div class="stat-label">تعداد فاکتور</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">۵,۶۷۸,۰۰۰</div>
                    <div class="stat-label">نقدی</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">۶,۶۶۷,۰۰۰</div>
                    <div class="stat-label">اعتباری</div>
                </div>
            </div>

            <div class="card highlight">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-bolt"></i>
                        میانبرهای روزانه
                    </h2>
                </div>
                <p class="card-subtitle">کارهای تکراری فروشگاه را فقط با یک لمس انجام دهید.</p>
                <div class="quick-actions" role="group" aria-label="میانبرهای مدیریت فروشگاه">
                    <button type="button" class="quick-action" data-action="sale">
                        <i class="fas fa-cash-register" aria-hidden="true"></i>
                        <span class="quick-action-title">ثبت فروش سریع</span>
                        <span class="quick-action-description">محصولات محبوب را در لحظه ثبت کنید</span>
                    </button>
                    <button type="button" class="quick-action" data-action="expense">
                        <i class="fas fa-receipt" aria-hidden="true"></i>
                        <span class="quick-action-title">ثبت هزینه روزانه</span>
                        <span class="quick-action-description">مصرف صندوق و خریدهای فوری</span>
                    </button>
                    <button type="button" class="quick-action" data-action="inventory">
                        <i class="fas fa-boxes" aria-hidden="true"></i>
                        <span class="quick-action-title">بررسی انبار</span>
                        <span class="quick-action-description">وضعیت کالاهای پرفروش را ببینید</span>
                    </button>
                    <button type="button" class="quick-action" data-action="customer">
                        <i class="fas fa-user-check" aria-hidden="true"></i>
                        <span class="quick-action-title">بدهی مشتری</span>
                        <span class="quick-action-description">مشتری بدهکار را سریع تسویه کنید</span>
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-wallet"></i>
                        وضعیت صندوق و بدهی
                    </h2>
                </div>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-header">
                            <span>پیشرفت فروش روزانه</span>
                            <span class="summary-value">۶۱٪</span>
                        </div>
                        <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="61">
                            <div class="progress-bar" style="width: 61%;"></div>
                        </div>
                        <div class="progress-label">
                            <span>هدف: ۲۰,۰۰۰,۰۰۰ تومان</span>
                            <span>ثبت شده: ۱۲,۳۴۵,۰۰۰ تومان</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-header">
                            <span>موجودی صندوق نقدی</span>
                            <span class="summary-value">۵,۶۷۸,۰۰۰ تومان</span>
                        </div>
                        <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="72">
                            <div class="progress-bar" style="width: 72%;"></div>
                        </div>
                        <div class="progress-label">
                            <span>حد اطمینان: ۸,۰۰۰,۰۰۰ تومان</span>
                            <span>باقی‌مانده: ۲,۳۲۲,۰۰۰ تومان</span>
                        </div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-header">
                            <span>وضعیت مطالبات اعتباری</span>
                            <span class="summary-value">۳ سررسید نزدیک</span>
                        </div>
                        <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="40">
                            <div class="progress-bar" style="width: 40%; background: linear-gradient(90deg, var(--warning) 0%, var(--danger) 100%);"></div>
                        </div>
                        <div class="progress-label">
                            <span>بدهی فعال: ۱۸,۰۰۰,۰۰۰ تومان</span>
                            <span>قابل دریافت امروز: ۷,۲۰۰,۰۰۰ تومان</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-chart-bar"></i>
                        نمودار فروش هفتگی
                    </h2>
                </div>
                <div class="chart-container">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-clipboard-check"></i>
                        کارهای امروز فروشگاه
                    </h2>
                </div>
                <div class="task-progress">
                    <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                        <div class="progress-bar" id="taskProgressBar" style="width: 0%;"></div>
                    </div>
                    <div class="task-progress-value" id="taskProgressText">۰٪ تکمیل شده</div>
                </div>
                <ul class="task-list" id="taskList">
                    <li class="task-item">
                        <label class="task-label" for="task-cash">
                            <input type="checkbox" id="task-cash" class="task-checkbox" data-task-id="cash-check">
                            جمع‌آوری و شمارش موجودی صندوق پایان شیفت
                        </label>
                        <div class="task-meta">
                            <span class="badge badge-warning">تا ساعت ۲۱:۰۰</span>
                            <button type="button" class="btn btn-outline btn-sm" data-action="expense">ثبت هزینه</button>
                        </div>
                    </li>
                    <li class="task-item">
                        <label class="task-label" for="task-stock">
                            <input type="checkbox" id="task-stock" class="task-checkbox" data-task-id="stock-review">
                            بررسی کالاهای پرفروش و سفارش مجدد در صورت نیاز
                        </label>
                        <div class="task-meta">
                            <span class="badge badge-success">۵ قلم بررسی شد</span>
                            <button type="button" class="btn btn-outline btn-sm" data-action="inventory">لیست کالاها</button>
                        </div>
                    </li>
                    <li class="task-item">
                        <label class="task-label" for="task-credit">
                            <input type="checkbox" id="task-credit" class="task-checkbox" data-task-id="credit-reminder">
                            پیگیری تماس با مشتریان بدهکار سررسید امروز
                        </label>
                        <div class="task-meta">
                            <span class="badge badge-danger">۳ نفر منتظر تماس</span>
                            <button type="button" class="btn btn-outline btn-sm" data-action="customer">فهرست مشتریان</button>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-receipt"></i>
                        آخرین فروش‌ها
                    </h2>
                    <button type="button" class="btn btn-outline btn-sm" id="viewAllSalesBtn">مشاهده همه</button>
                </div>
                <ul class="list-group">
                    <li class="list-item">
                        <div>
                            <div class="list-item-title">فاکتور #۱۲۳۴</div>
                            <div class="list-item-subtitle">۱۴:۳۰ - ۳ کالا</div>
                        </div>
                        <div>
                            <div class="list-item-title">۱۲۵,۰۰۰ تومان</div>
                            <div class="list-item-subtitle">نقدی</div>
                        </div>
                    </li>
                    <li class="list-item">
                        <div>
                            <div class="list-item-title">فاکتور #۱۲۳۳</div>
                            <div class="list-item-subtitle">۱۲:۱۵ - ۵ کالا</div>
                        </div>
                        <div>
                            <div class="list-item-title">۲۸۰,۰۰۰ تومان</div>
                            <div class="list-item-subtitle">اعتباری</div>
                        </div>
                    </li>
                    <li class="list-item">
                        <div>
                            <div class="list-item-title">فاکتور #۱۲۳۲</div>
                            <div class="list-item-subtitle">۱۰:۴۵ - ۲ کالا</div>
                        </div>
                        <div>
                            <div class="list-item-title">۷۵,۰۰۰ تومان</div>
                            <div class="list-item-subtitle">کارت</div>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-truck-loading"></i>
                        یادآوری تامین‌کنندگان
                    </h2>
                </div>
                <table class="supplier-list">
                    <thead>
                        <tr>
                            <th>تامین‌کننده</th>
                            <th>کالاهای پیشنهادی</th>
                            <th>آخرین خرید</th>
                            <th>اقدام</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>شرکت لبنیات تندرست</td>
                            <td>
                                <div class="mini-badge"><i class="fas fa-bottle-water" aria-hidden="true"></i> شیر ۲۴ عدد</div>
                                <div class="mini-badge"><i class="fas fa-cheese" aria-hidden="true"></i> پنیر ۱۲ عدد</div>
                            </td>
                            <td>۱۰ روز پیش</td>
                            <td class="supplier-actions">
                                <button type="button" class="btn btn-outline btn-sm" data-action="supplier-call">تماس</button>
                                <button type="button" class="btn btn-primary btn-sm" data-action="supplier-order">ثبت سفارش</button>
                            </td>
                        </tr>
                        <tr>
                            <td>پخش مواد غذایی نوین</td>
                            <td>
                                <div class="mini-badge"><i class="fas fa-bread-slice" aria-hidden="true"></i> نان بسته‌ای ۳۰ عدد</div>
                            </td>
                            <td>۷ روز پیش</td>
                            <td class="supplier-actions">
                                <button type="button" class="btn btn-outline btn-sm" data-action="supplier-call">پیگیری</button>
                            </td>
                        </tr>
                        <tr>
                            <td>سوپر عمده خشکبار</td>
                            <td>
                                <div class="mini-badge"><i class="fas fa-seedling" aria-hidden="true"></i> پسته ۸ کیلو</div>
                                <div class="mini-badge"><i class="fas fa-cookie" aria-hidden="true"></i> خشکبار مخلوط ۵ کیلو</div>
                            </td>
                            <td>۲۰ روز پیش</td>
                            <td class="supplier-actions">
                                <button type="button" class="btn btn-outline btn-sm" data-action="supplier-order">پیشنهاد قیمت</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-calendar-check"></i>
                        تسویه‌های پیش‌رو
                    </h2>
                </div>
                <div class="timeline">
                    <div class="timeline-item">
                        <span class="timeline-indicator"></span>
                        <div class="timeline-content">
                            <div class="timeline-title">تسویه با صندوق قرض‌الحسنه</div>
                            <div class="timeline-meta">
                                <span>موعد: امروز ساعت ۱۸:۰۰</span>
                                <span>مبلغ: ۲,۰۰۰,۰۰۰ تومان</span>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <span class="timeline-indicator"></span>
                        <div class="timeline-content">
                            <div class="timeline-title">پرداخت اجاره فروشگاه</div>
                            <div class="timeline-meta">
                                <span>موعد: ۳ روز دیگر</span>
                                <span>مبلغ: ۷,۵۰۰,۰۰۰ تومان</span>
                            </div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <span class="timeline-indicator"></span>
                        <div class="timeline-content">
                            <div class="timeline-title">تسویه حساب با تامین‌کننده خشکبار</div>
                            <div class="timeline-meta">
                                <span>موعد: ۵ روز دیگر</span>
                                <span>مبلغ: ۳,۴۵۰,۰۰۰ تومان</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Inventory View -->
        <div class="view-container" id="inventoryView" role="tabpanel" aria-labelledby="navInventory" aria-hidden="true" tabindex="-1">
            <div class="search-box">
                <span class="search-icon"><i class="fas fa-search"></i></span>
                <input type="text" class="search-input" placeholder="جستجوی کالا..." id="inventorySearch">
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-box"></i>
                        کالاهای موجود
                    </h2>
                    <button type="button" class="btn btn-primary btn-sm" id="addProductBtn">افزودن کالا</button>
                </div>
                
                <div id="productList">
                    <div class="product-card">
                        <div class="product-image">
                            <i class="fas fa-wine-bottle"></i>
                        </div>
                        <div class="product-info">
                            <div class="product-name">شیر پاستوریزه</div>
                            <div class="product-code">کد: ۱۲۳۴۵۶۷۸۹</div>
                            <div class="product-price">۲۵,۰۰۰ تومان</div>
                            <div class="product-stock">موجودی: ۲۴ عدد</div>
                        </div>
                        <div class="product-actions">
                            <button type="button" class="btn btn-outline btn-sm"><i class="fas fa-edit"></i></button>
                            <button type="button" class="btn btn-outline btn-sm"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    
                    <div class="product-card">
                        <div class="product-image">
                            <i class="fas fa-bread-slice"></i>
                        </div>
                        <div class="product-info">
                            <div class="product-name">نان سنگک</div>
                            <div class="product-code">کد: ۹۸۷۶۵۴۳۲۱</div>
                            <div class="product-price">۵,۰۰۰ تومان</div>
                            <div class="product-stock">موجودی: ۱۲ عدد</div>
                        </div>
                        <div class="product-actions">
                            <button type="button" class="btn btn-outline btn-sm"><i class="fas fa-edit"></i></button>
                            <button type="button" class="btn btn-outline btn-sm"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    
                    <div class="product-card">
                        <div class="product-image">
                            <i class="fas fa-oil-can"></i>
                        </div>
                        <div class="product-info">
                            <div class="product-name">روغن مایع</div>
                            <div class="product-code">کد: ۵۶۷۸۹۱۲۳۴</div>
                            <div class="product-price">۸۵,۰۰۰ تومان</div>
                            <div class="product-stock badge badge-warning">موجودی: ۳ عدد</div>
                        </div>
                        <div class="product-actions">
                            <button type="button" class="btn btn-outline btn-sm"><i class="fas fa-edit"></i></button>
                            <button type="button" class="btn btn-outline btn-sm"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        کالاهای کم‌موجود
                    </h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>نام کالا</th>
                            <th>موجودی</th>
                            <th>حداقل موجودی</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>روغن مایع</td>
                            <td>۳ عدد</td>
                            <td>۵ عدد</td>
                            <td>
                                <button type="button" class="btn btn-primary btn-sm">سفارش</button>
                            </td>
                        </tr>
                        <tr>
                            <td>ماست</td>
                            <td>۷ عدد</td>
                            <td>۱۰ عدد</td>
                            <td>
                                <button type="button" class="btn btn-primary btn-sm">سفارش</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Credit View -->
        <div class="view-container" id="creditView" role="tabpanel" aria-labelledby="navCredit" aria-hidden="true" tabindex="-1">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">۴۵,۶۷۸,۰۰۰</div>
                    <div class="stat-label">کل مطالبات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">۱۲</div>
                    <div class="stat-label">مشتریان بدهکار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">۸</div>
                    <div class="stat-label">سررسید گذشته</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">۱۵,۴۳۲,۰۰۰</div>
                    <div class="stat-label">دریافت امروز</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-users"></i>
                        حساب‌های اعتباری
                    </h2>
                    <button type="button" class="btn btn-primary btn-sm" id="addCustomerBtn">افزودن مشتری</button>
                </div>
                <ul class="list-group">
                    <li class="list-item">
                        <div>
                            <div class="list-item-title">احمد محمدی</div>
                            <div class="list-item-subtitle">سررسید: ۱۴۰۲/۰۵/۲۰</div>
                        </div>
                        <div>
                            <div class="list-item-title">۲,۵۰۰,۰۰۰ تومان</div>
                            <div class="badge badge-danger">سررسید گذشته</div>
                        </div>
                    </li>
                    <li class="list-item">
                        <div>
                            <div class="list-item-title">رضا رضایی</div>
                            <div class="list-item-subtitle">سررسید: ۱۴۰۲/۰۵/۲۵</div>
                        </div>
                        <div>
                            <div class="list-item-title">۵,۰۰۰,۰۰۰ تومان</div>
                            <div class="badge badge-warning">۵ روز مانده</div>
                        </div>
                    </li>
                    <li class="list-item">
                        <div>
                            <div class="list-item-title">مریم احمدی</div>
                            <div class="list-item-subtitle">سررسید: ۱۴۰۲/۰۶/۱۰</div>
                        </div>
                        <div>
                            <div class="list-item-title">۱,۲۰۰,۰۰۰ تومان</div>
                            <div class="badge badge-success">منظم</div>
                        </div>
                    </li>
                </ul>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-money-bill-wave"></i>
                        پرداخت‌های امروز
                    </h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>مشتری</th>
                            <th>مبلغ</th>
                            <th>زمان</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>علی رضایی</td>
                            <td>۱,۲۰۰,۰۰۰ تومان</td>
                            <td>۱۰:۳۰</td>
                            <td>
                                <button type="button" class="btn btn-outline btn-sm">مشاهده</button>
                            </td>
                        </tr>
                        <tr>
                            <td>سارا محمدی</td>
                            <td>۸۵۰,۰۰۰ تومان</td>
                            <td>۰۹:۱۵</td>
                            <td>
                                <button type="button" class="btn btn-outline btn-sm">مشاهده</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Reports View -->
        <div class="view-container" id="reportsView" role="tabpanel" aria-labelledby="navReports" aria-hidden="true" tabindex="-1">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-chart-line"></i>
                        گزارش فروش
                    </h2>
                    <div style="display: flex; gap: 8px;">
                        <button type="button" class="btn btn-outline btn-sm active" data-period="day" aria-pressed="true">روز</button>
                        <button type="button" class="btn btn-outline btn-sm" data-period="week" aria-pressed="false">هفته</button>
                        <button type="button" class="btn btn-outline btn-sm" data-period="month" aria-pressed="false">ماه</button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">۱۲,۳۴۵,۰۰۰</div>
                        <div class="stat-label">کل فروش</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">۸,۷۶۵,۰۰۰</div>
                        <div class="stat-label">سود خالص</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">۳,۵۸۰,۰۰۰</div>
                        <div class="stat-label">هزینه‌ها</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">۴۵</div>
                        <div class="stat-label">فاکتورها</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="salesReportChart"></canvas>
                </div>
                
                <div class="card" style="background: var(--light);">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-star"></i>
                            پرفروش‌ترین کالاها
                        </h2>
                    </div>
                    <ul class="list-group">
                        <li class="list-item">
                            <div>
                                <div class="list-item-title">شیر پاستوریزه</div>
                                <div class="list-item-subtitle">۲۴ عدد فروخته شده</div>
                            </div>
                            <div>
                                <div class="list-item-title">۶۰۰,۰۰۰ تومان</div>
                            </div>
                        </li>
                        <li class="list-item">
                            <div>
                                <div class="list-item-title">نان سنگک</div>
                                <div class="list-item-subtitle">۴۰ عدد فروخته شده</div>
                            </div>
                            <div>
                                <div class="list-item-title">۲۰۰,۰۰۰ تومان</div>
                            </div>
                        </li>
                        <li class="list-item">
                            <div>
                                <div class="list-item-title">روغن مایع</div>
                                <div class="list-item-subtitle">۸ عدد فروخته شده</div>
                            </div>
                            <div>
                                <div class="list-item-title">۶۸۰,۰۰۰ تومان</div>
                            </div>
                        </li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <button type="button" class="btn btn-primary btn-block" id="exportBtn">
                        <i class="fas fa-file-excel"></i>
                        خروجی اکسل
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- FAB -->
    <button type="button" class="fab pulse" id="fabBtn" aria-label="نمایش میانبرهای سریع" aria-expanded="false">
        <i class="fas fa-plus" aria-hidden="true"></i>
    </button>
    
    <!-- Speed Dial -->
    <div class="speed-dial" id="speedDial">
        <div class="speed-dial-item">
            <span class="speed-dial-label">فروش جدید</span>
            <button type="button" class="speed-dial-btn" id="newSaleBtn">
                <i class="fas fa-shopping-cart"></i>
            </button>
        </div>
        <div class="speed-dial-item">
            <span class="speed-dial-label">افزودن کالا</span>
            <button type="button" class="speed-dial-btn" id="newProductBtn">
                <i class="fas fa-box"></i>
            </button>
        </div>
        <div class="speed-dial-item">
            <span class="speed-dial-label">ثبت هزینه</span>
            <button type="button" class="speed-dial-btn" id="newExpenseBtn">
                <i class="fas fa-receipt"></i>
            </button>
        </div>
        <div class="speed-dial-item">
            <span class="speed-dial-label">مشتری جدید</span>
            <button type="button" class="speed-dial-btn" id="newCustomerBtn">
                <i class="fas fa-user-plus"></i>
            </button>
        </div>
    </div>
    
    <!-- Bottom Navigation -->
    <nav class="bottom-nav" role="tablist" aria-label="نمایش صفحات حسابداری">
        <button type="button" class="nav-item active" id="navSales" role="tab" data-view="salesView" aria-controls="salesView" aria-pressed="true" aria-selected="true">
            <span class="nav-icon" aria-hidden="true"><i class="fas fa-shopping-cart"></i></span>
            <span class="nav-label">فروش</span>
        </button>
        <button type="button" class="nav-item" id="navInventory" role="tab" data-view="inventoryView" aria-controls="inventoryView" aria-pressed="false" aria-selected="false">
            <span class="nav-icon" aria-hidden="true"><i class="fas fa-boxes"></i></span>
            <span class="nav-label">انبار</span>
        </button>
        <button type="button" class="nav-item" id="navCredit" role="tab" data-view="creditView" aria-controls="creditView" aria-pressed="false" aria-selected="false">
            <span class="nav-icon" aria-hidden="true"><i class="fas fa-file-invoice"></i></span>
            <span class="nav-label">حساب‌ها</span>
        </button>
        <button type="button" class="nav-item" id="navReports" role="tab" data-view="reportsView" aria-controls="reportsView" aria-pressed="false" aria-selected="false">
            <span class="nav-icon" aria-hidden="true"><i class="fas fa-chart-line"></i></span>
            <span class="nav-label">گزارش‌ها</span>
        </button>
    </nav>
    
    <!-- New Sale Modal -->
    <div class="modal" id="newSaleModal" role="dialog" aria-modal="true" aria-labelledby="newSaleModalTitle" aria-hidden="true" tabindex="-1">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="newSaleModalTitle">فروش جدید</h3>
                <button type="button" class="modal-close" aria-label="بستن پنجره">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">جستجوی کالا یا اسکن بارکد</label>
                    <div class="search-box">
                        <span class="search-icon"><i class="fas fa-search"></i></span>
                        <input type="text" class="search-input" placeholder="نام کالا یا بارکد" id="productSearchInput">
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">کالاهای انتخاب شده</h3>
                    </div>
                    <ul class="list-group" id="selectedProducts">
                        <li class="list-item">
                            <div>
                                <div class="list-item-title">شیر پاستوریزه</div>
                                <div class="list-item-subtitle">۲ عدد × ۲۵,۰۰۰ تومان</div>
                            </div>
                            <div>
                                <div class="list-item-title">۵۰,۰۰۰ تومان</div>
                            </div>
                        </li>
                    </ul>
                    <div class="form-group">
                        <div class="list-item">
                            <div class="list-item-title">جمع کل:</div>
                            <div class="list-item-title">۵۰,۰۰۰ تومان</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">نوع پرداخت</label>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                        <button type="button" class="btn btn-primary payment-method" data-method="cash" aria-pressed="true">
                            <i class="fas fa-money-bill-wave"></i>
                            نقدی
                        </button>
                        <button type="button" class="btn btn-outline payment-method" data-method="card" aria-pressed="false">
                            <i class="fas fa-credit-card"></i>
                            کارت
                        </button>
                        <button type="button" class="btn btn-outline payment-method" data-method="credit" aria-pressed="false">
                            <i class="fas fa-user-clock"></i>
                            اعتباری
                        </button>
                        <button type="button" class="btn btn-outline payment-method" data-method="qr" aria-pressed="false">
                            <i class="fas fa-qrcode"></i>
                            QR
                        </button>
                    </div>
                </div>
                
                <div class="form-group" id="customerSelect" style="display: none;">
                    <label class="form-label">انتخاب مشتری</label>
                    <select class="form-control">
                        <option>احمد محمدی</option>
                        <option>رضا رضایی</option>
                        <option>مریم احمدی</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" id="cancelSaleBtn">انصراف</button>
                <button type="button" class="btn btn-primary" id="confirmSaleBtn">ثبت فروش</button>
            </div>
        </div>
    </div>
    
    <!-- Add Product Modal - Multi-step Form -->
    <div class="modal" id="addProductModal" role="dialog" aria-modal="true" aria-labelledby="addProductModalTitle" aria-hidden="true" tabindex="-1">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="addProductModalTitle">افزودن کالای جدید</h3>
                <button type="button" class="modal-close" aria-label="بستن پنجره">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Steps Indicator -->
                <div class="steps">
                    <div class="step active" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-title">اطلاعات پایه</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-title">موجودی و قیمت</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-title">تایید نهایی</div>
                    </div>
                </div>
                
                <!-- Step 1: Basic Information -->
                <div id="formStep1" class="form-step">
                    <div class="form-group">
                        <label class="form-label">نام کالا *</label>
                        <input type="text" class="form-control" id="productName" placeholder="نام کالا را وارد کنید">
                        <div class="error-message" id="productNameError">نام کالا را وارد کنید</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">کد کالا *</label>
                        <input type="text" class="form-control" id="productCode" placeholder="کد کالا را وارد کنید">
                        <div class="error-message" id="productCodeError">کد کالا را وارد کنید</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">دسته‌بندی *</label>
                        <select class="form-control" id="productCategory">
                            <option value="">انتخاب کنید</option>
                            <option>لبنیات</option>
                            <option>نانوایی</option>
                            <option>خشکبار</option>
                            <option>نوشیدنی</option>
                            <option>کنسرو</option>
                            <option>سایر</option>
                        </select>
                        <div class="error-message" id="productCategoryError">دسته‌بندی را انتخاب کنید</div>
                    </div>
                </div>
                
                <!-- Step 2: Inventory and Price -->
                <div id="formStep2" class="form-step" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">قیمت فروش (تومان) *</label>
                        <input type="number" class="form-control" id="productPrice" placeholder="قیمت فروش را وارد کنید">
                        <div class="error-message" id="productPriceError">قیمت فروش را وارد کنید</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">قیمت خرید (تومان) *</label>
                        <input type="number" class="form-control" id="productCost" placeholder="قیمت خرید را وارد کنید">
                        <div class="error-message" id="productCostError">قیمت خرید را وارد کنید</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">موجودی اولیه *</label>
                        <input type="number" class="form-control" id="productStock" placeholder="موجودی اولیه را وارد کنید">
                        <div class="error-message" id="productStockError">موجودی اولیه را وارد کنید</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">حداقل موجودی *</label>
                        <input type="number" class="form-control" id="productMinStock" placeholder="حداقل موجودی را وارد کنید">
                        <div class="error-message" id="productMinStockError">حداقل موجودی را وارد کنید</div>
                    </div>
                </div>
                
                <!-- Step 3: Confirmation -->
                <div id="formStep3" class="form-step" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">اطلاعات کالا</h3>
                        </div>
                        <ul class="list-group">
                            <li class="list-item">
                                <div class="list-item-title">نام کالا</div>
                                <div id="confirmName">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">کد کالا</div>
                                <div id="confirmCode">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">دسته‌بندی</div>
                                <div id="confirmCategory">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">قیمت فروش</div>
                                <div id="confirmPrice">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">قیمت خرید</div>
                                <div id="confirmCost">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">موجودی اولیه</div>
                                <div id="confirmStock">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">حداقل موجودی</div>
                                <div id="confirmMinStock">-</div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" id="prevStepBtn" style="display: none;">قبلی</button>
                <button type="button" class="btn btn-primary" id="nextStepBtn">بعدی</button>
                <button type="button" class="btn btn-success" id="saveProductBtn" style="display: none;">ذخیره کالا</button>
                <button type="button" class="btn btn-outline" id="cancelProductBtn">انصراف</button>
            </div>
        </div>
    </div>
    
    <!-- Add Customer Modal - Multi-step Form -->
    <div class="modal" id="addCustomerModal" role="dialog" aria-modal="true" aria-labelledby="addCustomerModalTitle" aria-hidden="true" tabindex="-1">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="addCustomerModalTitle">افزودن مشتری جدید</h3>
                <button type="button" class="modal-close" aria-label="بستن پنجره">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Steps Indicator -->
                <div class="steps">
                    <div class="step active" id="customerStep1">
                        <div class="step-number">1</div>
                        <div class="step-title">اطلاعات شخصی</div>
                    </div>
                    <div class="step" id="customerStep2">
                        <div class="step-number">2</div>
                        <div class="step-title">اطلاعات مالی</div>
                    </div>
                    <div class="step" id="customerStep3">
                        <div class="step-number">3</div>
                        <div class="step-title">تایید نهایی</div>
                    </div>
                </div>
                
                <!-- Step 1: Personal Information -->
                <div id="customerFormStep1" class="form-step">
                    <div class="form-group">
                        <label class="form-label">نام و نام خانوادگی *</label>
                        <input type="text" class="form-control" id="customerName" placeholder="نام و نام خانوادگی را وارد کنید">
                        <div class="error-message" id="customerNameError">نام و نام خانوادگی را وارد کنید</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">شماره تماس *</label>
                        <input type="tel" class="form-control" id="customerPhone" placeholder="شماره تماس را وارد کنید">
                        <div class="error-message" id="customerPhoneError">شماره تماس را وارد کنید</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">آدرس</label>
                        <textarea class="form-control" rows="3" id="customerAddress" placeholder="آدرس را وارد کنید"></textarea>
                    </div>
                </div>
                
                <!-- Step 2: Financial Information -->
                <div id="customerFormStep2" class="form-step" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">حد اعتباری (تومان) *</label>
                        <input type="number" class="form-control" id="customerCredit" placeholder="حد اعتباری را وارد کنید">
                        <div class="error-message" id="customerCreditError">حد اعتباری را وارد کنید</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">توضیحات</label>
                        <textarea class="form-control" rows="2" id="customerNotes" placeholder="توضیحات اختیاری"></textarea>
                    </div>
                </div>
                
                <!-- Step 3: Confirmation -->
                <div id="customerFormStep3" class="form-step" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">اطلاعات مشتری</h3>
                        </div>
                        <ul class="list-group">
                            <li class="list-item">
                                <div class="list-item-title">نام و نام خانوادگی</div>
                                <div id="confirmCustomerName">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">شماره تماس</div>
                                <div id="confirmCustomerPhone">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">آدرس</div>
                                <div id="confirmCustomerAddress">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">حد اعتباری</div>
                                <div id="confirmCustomerCredit">-</div>
                            </li>
                            <li class="list-item">
                                <div class="list-item-title">توضیحات</div>
                                <div id="confirmCustomerNotes">-</div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" id="customerPrevStepBtn" style="display: none;">قبلی</button>
                <button type="button" class="btn btn-primary" id="customerNextStepBtn">بعدی</button>
                <button type="button" class="btn btn-success" id="saveCustomerBtn" style="display: none;">ذخیره مشتری</button>
                <button type="button" class="btn btn-outline" id="cancelCustomerBtn">انصراف</button>
            </div>
        </div>
    </div>
    
    <!-- Empty State for Sales -->
    <div class="empty-state" id="salesEmptyState" style="display: none;">
        <div class="empty-state-icon">
            <i class="fas fa-shopping-cart"></i>
        </div>
        <h3 class="empty-state-title">هنوز فروشی ثبت نشده</h3>
        <p class="empty-state-description">
            برای شروع، روی دکمه + کلیک کرده و فروش جدیدی ثبت کنید
        </p>
        <button type="button" class="btn btn-primary" id="emptyStateNewSaleBtn">
            <i class="fas fa-plus"></i>
            فروش جدید
        </button>
    </div>
    
    <!-- Empty State for Inventory -->
    <div class="empty-state" id="inventoryEmptyState" style="display: none;">
        <div class="empty-state-icon">
            <i class="fas fa-boxes"></i>
        </div>
        <h3 class="empty-state-title">هیچ کالایی ثبت نشده</h3>
        <p class="empty-state-description">
            برای شروع، کالاهای خود را به سیستم اضافه کنید
        </p>
        <button type="button" class="btn btn-primary" id="emptyStateAddProductBtn">
            <i class="fas fa-plus"></i>
            افزودن کالا
        </button>
    </div>
    
    <!-- Empty State for Credit -->
    <div class="empty-state" id="creditEmptyState" style="display: none;">
        <div class="empty-state-icon">
            <i class="fas fa-users"></i>
        </div>
        <h3 class="empty-state-title">هیچ مشتری اعتباری ثبت نشده</h3>
        <p class="empty-state-description">
            برای شروع، مشتریان اعتباری خود را به سیستم اضافه کنید
        </p>
        <button type="button" class="btn btn-primary" id="emptyStateAddCustomerBtn">
            <i class="fas fa-plus"></i>
            افزودن مشتری
        </button>
    </div>
    
    <!-- Empty State for Reports -->
    <div class="empty-state" id="reportsEmptyState" style="display: none;">
        <div class="empty-state-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <h3 class="empty-state-title">هیچ داده‌ای برای گزارش وجود ندارد</h3>
        <p class="empty-state-description">
            برای مشاهده گزارش‌ها، ابتدا فروش‌ها و کالاهای خود را ثبت کنید
        </p>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true" aria-hidden="true">
        <div class="toast-message" id="toastMessage">
            <i class="fas fa-check-circle toast-icon" aria-hidden="true"></i>
            <span id="toastText">عملیات با موفقیت انجام شد</span>
        </div>
        <button type="button" class="toast-action" id="toastAction" hidden>بازگشت</button>
    </div>
    
    <script>
        // DOM Elements
        const navItems = Array.from(document.querySelectorAll('.nav-item'));
        const views = Array.from(document.querySelectorAll('.view-container'));
        const fabBtn = document.getElementById('fabBtn');
        const speedDial = document.getElementById('speedDial');
        const newSaleModal = document.getElementById('newSaleModal');
        const addProductModal = document.getElementById('addProductModal');
        const addCustomerModal = document.getElementById('addCustomerModal');
        const modalCloses = Array.from(document.querySelectorAll('.modal-close'));
        const modals = Array.from(document.querySelectorAll('.modal'));
        const toast = document.getElementById('toast');
        const toastText = document.getElementById('toastText');
        const toastActionButton = document.getElementById('toastAction');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = darkModeToggle ? darkModeToggle.querySelector('i') : null;
        const currentDateText = document.getElementById('currentDateText');
        const paymentMethods = Array.from(document.querySelectorAll('.payment-method'));
        const customerSelect = document.getElementById('customerSelect');
        const reportPeriodTabs = Array.from(document.querySelectorAll('[data-period]'));
        const quickActionButtons = Array.from(document.querySelectorAll('[data-action]'));
        const taskCheckboxes = Array.from(document.querySelectorAll('.task-checkbox'));
        const taskProgressBar = document.getElementById('taskProgressBar');
        const taskProgressText = document.getElementById('taskProgressText');
        const taskProgressContainer = taskProgressBar ? taskProgressBar.closest('.progress') : null;
        const isRTL = document.documentElement.dir === 'rtl';
        let toastTimeout;
        let salesChartInstance = null;
        let salesReportChartInstance = null;
        const TASK_STORAGE_KEY = 'accountantDailyTasks';

        function safeLocalStorageGet(key) {
            try {
                return window.localStorage.getItem(key);
            } catch (error) {
                return null;
            }
        }

        function safeLocalStorageSet(key, value) {
            try {
                window.localStorage.setItem(key, value);
            } catch (error) {
                // Storage might be unavailable (private mode, etc.)
            }
        }

        function closeSpeedDial() {
            if (!speedDial || !fabBtn) return;
            speedDial.classList.remove('active');
            fabBtn.classList.remove('active');
            fabBtn.setAttribute('aria-expanded', 'false');
        }

        function openModal(modal) {
            if (!modal) return;
            if (modal === newSaleModal) {
                resetSaleModal();
            }
            modal.classList.add('active');
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';

            const focusableElement = modal.querySelector('input, select, textarea, button, [tabindex]:not([tabindex="-1"])');
            if (focusableElement) {
                focusableElement.focus({ preventScroll: true });
            } else {
                modal.focus({ preventScroll: true });
            }
        }

        function closeModal(modal) {
            if (!modal) return;
            modal.classList.remove('active');
            modal.setAttribute('aria-hidden', 'true');

            if (modal === newSaleModal) {
                resetSaleModal();
            }

            if (!document.querySelector('.modal.active')) {
                document.body.style.overflow = '';
            }
        }

        function closeAllModals() {
            modals.forEach(closeModal);
        }

        function hideToast() {
            if (!toast) return;
            clearTimeout(toastTimeout);
            toastTimeout = null;
            toast.classList.remove('show');
            toast.setAttribute('aria-hidden', 'true');
            if (toastActionButton) {
                toastActionButton.hidden = true;
                toastActionButton.onclick = null;
            }
        }

        function resetSaleModal() {
            if (customerSelect) {
                customerSelect.style.display = 'none';
            }

            paymentMethods.forEach(method => {
                method.classList.remove('btn-primary');
                method.classList.add('btn-outline');
                method.setAttribute('aria-pressed', 'false');
            });

            const defaultMethod = paymentMethods.find(method => method.dataset.method === 'cash') || paymentMethods[0];
            if (defaultMethod) {
                defaultMethod.classList.add('btn-primary');
                defaultMethod.classList.remove('btn-outline');
                defaultMethod.setAttribute('aria-pressed', 'true');
            }
        }

        // Product form elements
        const productSteps = {
            step1: document.getElementById('step1'),
            step2: document.getElementById('step2'),
            step3: document.getElementById('step3')
        };
        
        const productFormSteps = {
            step1: document.getElementById('formStep1'),
            step2: document.getElementById('formStep2'),
            step3: document.getElementById('formStep3')
        };
        
        const productFormFields = {
            name: document.getElementById('productName'),
            code: document.getElementById('productCode'),
            category: document.getElementById('productCategory'),
            price: document.getElementById('productPrice'),
            cost: document.getElementById('productCost'),
            stock: document.getElementById('productStock'),
            minStock: document.getElementById('productMinStock')
        };
        
        const productFormErrors = {
            name: document.getElementById('productNameError'),
            code: document.getElementById('productCodeError'),
            category: document.getElementById('productCategoryError'),
            price: document.getElementById('productPriceError'),
            cost: document.getElementById('productCostError'),
            stock: document.getElementById('productStockError'),
            minStock: document.getElementById('productMinStockError')
        };
        
        const productFormButtons = {
            prev: document.getElementById('prevStepBtn'),
            next: document.getElementById('nextStepBtn'),
            save: document.getElementById('saveProductBtn'),
            cancel: document.getElementById('cancelProductBtn')
        };
        
        // Customer form elements
        const customerSteps = {
            step1: document.getElementById('customerStep1'),
            step2: document.getElementById('customerStep2'),
            step3: document.getElementById('customerStep3')
        };
        
        const customerFormSteps = {
            step1: document.getElementById('customerFormStep1'),
            step2: document.getElementById('customerFormStep2'),
            step3: document.getElementById('customerFormStep3')
        };
        
        const customerFormFields = {
            name: document.getElementById('customerName'),
            phone: document.getElementById('customerPhone'),
            address: document.getElementById('customerAddress'),
            credit: document.getElementById('customerCredit'),
            notes: document.getElementById('customerNotes')
        };
        
        const customerFormErrors = {
            name: document.getElementById('customerNameError'),
            phone: document.getElementById('customerPhoneError'),
            credit: document.getElementById('customerCreditError')
        };
        
        const customerFormButtons = {
            prev: document.getElementById('customerPrevStepBtn'),
            next: document.getElementById('customerNextStepBtn'),
            save: document.getElementById('saveCustomerBtn'),
            cancel: document.getElementById('cancelCustomerBtn')
        };
        
        // Empty state elements
        const emptyStates = {
            sales: document.getElementById('salesEmptyState'),
            inventory: document.getElementById('inventoryEmptyState'),
            credit: document.getElementById('creditEmptyState'),
            reports: document.getElementById('reportsEmptyState')
        };
        
        // Set current date (Shamsi)
        function setCurrentDate() {
            if (!currentDateText) return;

            try {
                const formatter = new Intl.DateTimeFormat('fa-IR-u-ca-persian', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
                currentDateText.textContent = formatter.format(new Date());
            } catch (error) {
                currentDateText.textContent = new Date().toLocaleDateString('fa-IR');
            }
        }
        setCurrentDate();
        
        // Navigation
        function setActiveView(viewId, { focus = false } = {}) {
            const targetView = document.getElementById(viewId);
            if (!targetView) return;

            navItems.forEach(nav => {
                const isActive = nav.dataset.view === viewId;
                nav.classList.toggle('active', isActive);
                nav.setAttribute('aria-pressed', isActive ? 'true' : 'false');
                nav.setAttribute('aria-selected', isActive ? 'true' : 'false');

                if (isActive && focus) {
                    nav.focus();
                }
            });

            views.forEach(view => {
                const isActive = view.id === viewId;
                view.classList.toggle('active', isActive);
                view.setAttribute('aria-hidden', isActive ? 'false' : 'true');
                view.setAttribute('tabindex', isActive ? '0' : '-1');

                if (isActive) {
                    view.scrollTop = 0;
                }
            });

            if (viewId === 'reportsView') {
                initSalesReportChart();
            }

            checkEmptyStates(viewId);
            closeSpeedDial();
        }

        function handleQuickAction(action) {
            switch (action) {
                case 'sale':
                    openModal(newSaleModal);
                    break;
                case 'expense':
                    showToast('هزینه روزانه را در پایان شیفت ثبت کنید.');
                    break;
                case 'inventory':
                    setActiveView('inventoryView');
                    showToast('وضعیت انبار به‌روز شد.');
                    break;
                case 'customer':
                    setActiveView('creditView');
                    showToast('فهرست بدهی مشتریان نمایش داده شد.');
                    break;
                case 'supplier-call':
                    showToast('یادآوری: با تامین‌کننده تماس بگیرید.');
                    break;
                case 'supplier-order':
                    showToast('پیش‌نویس سفارش برای تامین‌کننده آماده شد.');
                    break;
                default:
                    showToast('این بخش به زودی فعال می‌شود.');
            }
        }

        // Check for empty states
        function checkEmptyStates(viewId) {
            // Hide all empty states first
            Object.values(emptyStates).forEach(state => {
                if (state) {
                    state.style.display = 'none';
                }
            });
            
            // Show appropriate empty state if needed
            // In a real app, this would check actual data
            // For demo purposes, we'll simulate empty states
            if (viewId === 'salesView' && document.querySelectorAll('#salesView .list-item').length === 0) {
                emptyStates.sales && (emptyStates.sales.style.display = 'block');
            } else if (viewId === 'inventoryView' && document.querySelectorAll('#productList .product-card').length === 0) {
                emptyStates.inventory && (emptyStates.inventory.style.display = 'block');
            } else if (viewId === 'creditView' && document.querySelectorAll('#creditView .list-item').length === 0) {
                emptyStates.credit && (emptyStates.credit.style.display = 'block');
            } else if (viewId === 'reportsView' && document.querySelectorAll('#reportsView .list-item').length === 0) {
                emptyStates.reports && (emptyStates.reports.style.display = 'block');
            }
        }
        
        // Nav item click event
        navItems.forEach((item, index) => {
            item.addEventListener('click', () => {
                const targetView = item.dataset.view;
                if (targetView) {
                    setActiveView(targetView);
                }
            });

            item.addEventListener('keydown', (event) => {
                handleNavKeydown(event, index);
            });
        });

        quickActionButtons.forEach(button => {
            button.addEventListener('click', () => {
                const action = button.getAttribute('data-action');
                if (action) {
                    handleQuickAction(action);
                }
            });
        });

        function handleNavKeydown(event, index) {
            const { key } = event;

            if (key === 'ArrowLeft' || key === 'ArrowRight') {
                event.preventDefault();
                const direction = (key === 'ArrowLeft') ? (isRTL ? 1 : -1) : (isRTL ? -1 : 1);
                const nextIndex = (index + direction + navItems.length) % navItems.length;
                const nextNav = navItems[nextIndex];
                if (nextNav && nextNav.dataset.view) {
                    setActiveView(nextNav.dataset.view, { focus: true });
                }
            } else if (key === 'Home') {
                event.preventDefault();
                const firstNav = navItems[0];
                if (firstNav && firstNav.dataset.view) {
                    setActiveView(firstNav.dataset.view, { focus: true });
                }
            } else if (key === 'End') {
                event.preventDefault();
                const lastNav = navItems[navItems.length - 1];
                if (lastNav && lastNav.dataset.view) {
                    setActiveView(lastNav.dataset.view, { focus: true });
                }
            }
        }

        resetSaleModal();
        const defaultView = navItems[0]?.dataset.view || 'salesView';
        setActiveView(defaultView);
        
        // FAB click event
        if (fabBtn && speedDial) {
            fabBtn.addEventListener('click', () => {
                const isOpen = speedDial.classList.toggle('active');
                fabBtn.classList.toggle('active', isOpen);
                fabBtn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            });

            document.addEventListener('click', (event) => {
                if (!speedDial.contains(event.target) && event.target !== fabBtn && !fabBtn.contains(event.target)) {
                    closeSpeedDial();
                }
            });
        }
        
        // Speed dial buttons
        document.getElementById('newSaleBtn').addEventListener('click', () => {
            openModal(newSaleModal);
            closeSpeedDial();
        });

        document.getElementById('newProductBtn').addEventListener('click', () => {
            resetProductForm();
            openModal(addProductModal);
            closeSpeedDial();
        });

        document.getElementById('newCustomerBtn').addEventListener('click', () => {
            resetCustomerForm();
            openModal(addCustomerModal);
            closeSpeedDial();
        });

        document.getElementById('newExpenseBtn').addEventListener('click', () => {
            showToast('ثبت هزینه به زودی اضافه می‌شود');
            closeSpeedDial();
        });
        
        // Modal close
        modalCloses.forEach(closeBtn => {
            closeBtn.addEventListener('click', () => {
                const modal = closeBtn.closest('.modal');
                closeModal(modal);
            });
        });

        // Close modal when clicking outside
        modals.forEach(modal => {
            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    closeModal(modal);
                }
            });
        });
        
        const darkModeMedia = window.matchMedia('(prefers-color-scheme: dark)');
        let storedDarkModePreference = safeLocalStorageGet('darkMode');

        function applyDarkMode(isEnabled, { persist = false } = {}) {
            document.body.classList.toggle('dark-mode', Boolean(isEnabled));

            if (darkModeToggle) {
                darkModeToggle.setAttribute('aria-pressed', isEnabled ? 'true' : 'false');
                darkModeToggle.setAttribute('aria-label', isEnabled ? 'فعال‌سازی حالت روشن' : 'فعال‌سازی حالت تاریک');
            }

            if (darkModeIcon) {
                darkModeIcon.classList.toggle('fa-sun', Boolean(isEnabled));
                darkModeIcon.classList.toggle('fa-moon', !Boolean(isEnabled));
            }

            if (persist) {
                safeLocalStorageSet('darkMode', isEnabled ? 'enabled' : 'disabled');
                storedDarkModePreference = isEnabled ? 'enabled' : 'disabled';
            }
        }

        if (darkModeToggle) {
            darkModeToggle.addEventListener('click', () => {
                const shouldEnable = !document.body.classList.contains('dark-mode');
                applyDarkMode(shouldEnable, { persist: true });
            });
        }

        if (storedDarkModePreference === 'enabled') {
            applyDarkMode(true);
        } else if (storedDarkModePreference === 'disabled') {
            applyDarkMode(false);
        } else {
            applyDarkMode(darkModeMedia.matches);
        }

        const handleDarkModeChange = (event) => {
            if (!storedDarkModePreference) {
                applyDarkMode(event.matches);
            }
        };

        if (typeof darkModeMedia.addEventListener === 'function') {
            darkModeMedia.addEventListener('change', handleDarkModeChange);
        } else if (typeof darkModeMedia.addListener === 'function') {
            darkModeMedia.addListener(handleDarkModeChange);
        }
        
        // Payment method selection
        paymentMethods.forEach(method => {
            method.addEventListener('click', () => {
                paymentMethods.forEach(m => {
                    m.classList.remove('btn-primary');
                    m.classList.add('btn-outline');
                    m.setAttribute('aria-pressed', 'false');
                });

                method.classList.add('btn-primary');
                method.classList.remove('btn-outline');
                method.setAttribute('aria-pressed', 'true');

                const selectedMethod = method.getAttribute('data-method');
                if (customerSelect) {
                    customerSelect.style.display = selectedMethod === 'credit' ? 'block' : 'none';
                }
            });
        });
        
        // Show toast notification
        function showToast(message, actionText = null, actionCallback = null) {
            if (!toast || !toastText) return;

            toastText.textContent = message;
            toast.setAttribute('aria-hidden', 'false');
            toast.classList.add('show');

            if (toastActionButton) {
                if (actionText) {
                    toastActionButton.textContent = actionText;
                    toastActionButton.hidden = false;
                    toastActionButton.onclick = () => {
                        if (typeof actionCallback === 'function') {
                            actionCallback();
                        }
                        hideToast();
                    };
                } else {
                    toastActionButton.hidden = true;
                    toastActionButton.onclick = null;
                }
            }

            clearTimeout(toastTimeout);
            toastTimeout = window.setTimeout(() => {
                hideToast();
            }, 3200);
        }
        
        // Initialize Sales Chart
        function initSalesChart() {
            const ctx = document.getElementById('salesChart');
            if (!ctx) return;

            if (salesChartInstance) {
                salesChartInstance.destroy();
            }

            salesChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['شنبه', 'یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنج‌شنبه', 'جمعه'],
                    datasets: [{
                        label: 'فروش (تومان)',
                        data: [8500000, 9200000, 7800000, 12345000, 10500000, 11200000, 9500000],
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgba(79, 70, 229, 1)',
                        pointBorderColor: '#fff',
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('fa-IR');
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Initialize Sales Report Chart
        function initSalesReportChart() {
            const ctx = document.getElementById('salesReportChart');
            if (!ctx) return;

            if (salesReportChartInstance) {
                salesReportChartInstance.destroy();
            }

            salesReportChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور'],
                    datasets: [{
                        label: 'فروش (تومان)',
                        data: [185000000, 192000000, 178000000, 223450000, 205000000, 212000000],
                        backgroundColor: 'rgba(79, 70, 229, 0.7)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('fa-IR');
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Report period tabs
        reportPeriodTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                reportPeriodTabs.forEach(t => {
                    t.classList.remove('active');
                    t.setAttribute('aria-pressed', 'false');
                });
                tab.classList.add('active');
                tab.setAttribute('aria-pressed', 'true');

                // Update chart based on selected period
                const period = tab.getAttribute('data-period');
                showToast(`نمایش گزارش ${period === 'day' ? 'روزانه' : period === 'week' ? 'هفتگی' : 'ماهانه'}`);
            });
        });
        
        // Button event listeners
        document.getElementById('viewAllSalesBtn').addEventListener('click', () => {
            showToast('نمایش تمام فروش‌ها');
        });
        
        document.getElementById('addProductBtn').addEventListener('click', () => {
            resetProductForm();
            openModal(addProductModal);
        });

        document.getElementById('addCustomerBtn').addEventListener('click', () => {
            resetCustomerForm();
            openModal(addCustomerModal);
        });
        
        document.getElementById('exportBtn').addEventListener('click', () => {
            showToast('در حال آماده‌سازی فایل اکسل...');
            setTimeout(() => {
                showToast('فایل اکسل با موفقیت دانلود شد');
            }, 2000);
        });
        
        document.getElementById('cancelSaleBtn').addEventListener('click', () => {
            closeModal(newSaleModal);
        });

        document.getElementById('confirmSaleBtn').addEventListener('click', () => {
            closeModal(newSaleModal);
            showToast('فاکتور فروش با موفقیت ثبت شد');
        });

        function loadTaskStates() {
            try {
                const stored = safeLocalStorageGet(TASK_STORAGE_KEY);
                return stored ? JSON.parse(stored) : {};
            } catch (error) {
                return {};
            }
        }

        function saveTaskStates(states) {
            safeLocalStorageSet(TASK_STORAGE_KEY, JSON.stringify(states));
        }

        function updateTaskProgress() {
            if (!taskProgressBar || !taskProgressText) return;

            const total = taskCheckboxes.length;
            const completed = taskCheckboxes.filter(checkbox => checkbox.checked).length;
            const percent = total === 0 ? 0 : Math.round((completed / total) * 100);

            taskProgressBar.style.width = `${percent}%`;
            if (taskProgressContainer) {
                taskProgressContainer.setAttribute('aria-valuenow', percent);
                taskProgressContainer.setAttribute('aria-valuetext', `${percent.toLocaleString('fa-IR')} درصد`);
            }
            taskProgressText.textContent = `${percent.toLocaleString('fa-IR')}٪ تکمیل شده`;
        }

        const taskStates = loadTaskStates();

        taskCheckboxes.forEach(checkbox => {
            const taskId = checkbox.dataset.taskId;
            if (taskId && taskStates[taskId]) {
                checkbox.checked = true;
            }

            checkbox.addEventListener('change', () => {
                if (taskId) {
                    taskStates[taskId] = checkbox.checked;
                    saveTaskStates(taskStates);
                    updateTaskProgress();
                }
            });
        });

        updateTaskProgress();

        // Product form functions
        function resetProductForm() {
            // Reset form fields
            Object.values(productFormFields).forEach(field => field.value = '');
            
            // Reset errors
            Object.values(productFormErrors).forEach(error => error.classList.remove('show'));
            Object.values(productFormFields).forEach(field => field.classList.remove('error'));
            
            // Reset steps
            Object.values(productFormSteps).forEach(step => step.style.display = 'none');
            productFormSteps.step1.style.display = 'block';
            
            // Reset step indicators
            Object.values(productSteps).forEach(step => {
                step.classList.remove('active', 'completed');
            });
            productSteps.step1.classList.add('active');
            
            // Reset buttons
            productFormButtons.prev.style.display = 'none';
            productFormButtons.next.style.display = 'inline-flex';
            productFormButtons.save.style.display = 'none';
        }
        
        function validateProductStep(step) {
            let isValid = true;
            
            if (step === 1) {
                // Validate step 1 fields
                if (!productFormFields.name.value.trim()) {
                    productFormFields.name.classList.add('error');
                    productFormErrors.name.classList.add('show');
                    isValid = false;
                } else {
                    productFormFields.name.classList.remove('error');
                    productFormErrors.name.classList.remove('show');
                }
                
                if (!productFormFields.code.value.trim()) {
                    productFormFields.code.classList.add('error');
                    productFormErrors.code.classList.add('show');
                    isValid = false;
                } else {
                    productFormFields.code.classList.remove('error');
                    productFormErrors.code.classList.remove('show');
                }
                
                if (!productFormFields.category.value) {
                    productFormFields.category.classList.add('error');
                    productFormErrors.category.classList.add('show');
                    isValid = false;
                } else {
                    productFormFields.category.classList.remove('error');
                    productFormErrors.category.classList.remove('show');
                }
            } else if (step === 2) {
                // Validate step 2 fields
                if (!productFormFields.price.value || productFormFields.price.value <= 0) {
                    productFormFields.price.classList.add('error');
                    productFormErrors.price.classList.add('show');
                    isValid = false;
                } else {
                    productFormFields.price.classList.remove('error');
                    productFormErrors.price.classList.remove('show');
                }
                
                if (!productFormFields.cost.value || productFormFields.cost.value <= 0) {
                    productFormFields.cost.classList.add('error');
                    productFormErrors.cost.classList.add('show');
                    isValid = false;
                } else {
                    productFormFields.cost.classList.remove('error');
                    productFormErrors.cost.classList.remove('show');
                }
                
                if (!productFormFields.stock.value || productFormFields.stock.value < 0) {
                    productFormFields.stock.classList.add('error');
                    productFormErrors.stock.classList.add('show');
                    isValid = false;
                } else {
                    productFormFields.stock.classList.remove('error');
                    productFormErrors.stock.classList.remove('show');
                }
                
                if (!productFormFields.minStock.value || productFormFields.minStock.value < 0) {
                    productFormFields.minStock.classList.add('error');
                    productFormErrors.minStock.classList.add('show');
                    isValid = false;
                } else {
                    productFormFields.minStock.classList.remove('error');
                    productFormErrors.minStock.classList.remove('show');
                }
            }
            
            return isValid;
        }
        
        function showProductStep(step) {
            // Hide all steps
            Object.values(productFormSteps).forEach(s => s.style.display = 'none');
            
            // Show current step
            productFormSteps[`step${step}`].style.display = 'block';
            
            // Update step indicators
            Object.values(productSteps).forEach(s => {
                s.classList.remove('active');
            });
            productSteps[`step${step}`].classList.add('active');
            
            // Update buttons
            if (step === 1) {
                productFormButtons.prev.style.display = 'none';
                productFormButtons.next.style.display = 'inline-flex';
                productFormButtons.save.style.display = 'none';
            } else if (step === 2) {
                productFormButtons.prev.style.display = 'inline-flex';
                productFormButtons.next.style.display = 'inline-flex';
                productFormButtons.save.style.display = 'none';
            } else if (step === 3) {
                productFormButtons.prev.style.display = 'inline-flex';
                productFormButtons.next.style.display = 'none';
                productFormButtons.save.style.display = 'inline-flex';
                
                // Populate confirmation data
                document.getElementById('confirmName').textContent = productFormFields.name.value;
                document.getElementById('confirmCode').textContent = productFormFields.code.value;
                document.getElementById('confirmCategory').textContent = productFormFields.category.value;
                document.getElementById('confirmPrice').textContent = parseInt(productFormFields.price.value).toLocaleString('fa-IR') + ' تومان';
                document.getElementById('confirmCost').textContent = parseInt(productFormFields.cost.value).toLocaleString('fa-IR') + ' تومان';
                document.getElementById('confirmStock').textContent = productFormFields.stock.value + ' عدد';
                document.getElementById('confirmMinStock').textContent = productFormFields.minStock.value + ' عدد';
            }
            
            // Mark previous steps as completed
            for (let i = 1; i < step; i++) {
                productSteps[`step${i}`].classList.add('completed');
            }
        }
        
        // Product form navigation
        productFormButtons.next.addEventListener('click', () => {
            const currentStep = Object.values(productFormSteps).findIndex(step => step.style.display !== 'none') + 1;
            
            if (validateProductStep(currentStep)) {
                showProductStep(currentStep + 1);
            }
        });
        
        productFormButtons.prev.addEventListener('click', () => {
            const currentStep = Object.values(productFormSteps).findIndex(step => step.style.display !== 'none') + 1;
            showProductStep(currentStep - 1);
        });
        
        productFormButtons.save.addEventListener('click', () => {
            // In a real app, this would save the product to the database
            closeModal(addProductModal);
            showToast('کالای جدید با موفقیت اضافه شد');
        });

        productFormButtons.cancel.addEventListener('click', () => {
            closeModal(addProductModal);
        });
        
        // Customer form functions
        function resetCustomerForm() {
            // Reset form fields
            Object.values(customerFormFields).forEach(field => field.value = '');
            
            // Reset errors
            Object.values(customerFormErrors).forEach(error => error.classList.remove('show'));
            Object.values(customerFormFields).forEach(field => field.classList.remove('error'));
            
            // Reset steps
            Object.values(customerFormSteps).forEach(step => step.style.display = 'none');
            customerFormSteps.step1.style.display = 'block';
            
            // Reset step indicators
            Object.values(customerSteps).forEach(step => {
                step.classList.remove('active', 'completed');
            });
            customerSteps.step1.classList.add('active');
            
            // Reset buttons
            customerFormButtons.prev.style.display = 'none';
            customerFormButtons.next.style.display = 'inline-flex';
            customerFormButtons.save.style.display = 'none';
        }
        
        function validateCustomerStep(step) {
            let isValid = true;
            
            if (step === 1) {
                // Validate step 1 fields
                if (!customerFormFields.name.value.trim()) {
                    customerFormFields.name.classList.add('error');
                    customerFormErrors.name.classList.add('show');
                    isValid = false;
                } else {
                    customerFormFields.name.classList.remove('error');
                    customerFormErrors.name.classList.remove('show');
                }
                
                if (!customerFormFields.phone.value.trim()) {
                    customerFormFields.phone.classList.add('error');
                    customerFormErrors.phone.classList.add('show');
                    isValid = false;
                } else {
                    customerFormFields.phone.classList.remove('error');
                    customerFormErrors.phone.classList.remove('show');
                }
            } else if (step === 2) {
                // Validate step 2 fields
                if (!customerFormFields.credit.value || customerFormFields.credit.value <= 0) {
                    customerFormFields.credit.classList.add('error');
                    customerFormErrors.credit.classList.add('show');
                    isValid = false;
                } else {
                    customerFormFields.credit.classList.remove('error');
                    customerFormErrors.credit.classList.remove('show');
                }
            }
            
            return isValid;
        }
        
        function showCustomerStep(step) {
            // Hide all steps
            Object.values(customerFormSteps).forEach(s => s.style.display = 'none');
            
            // Show current step
            customerFormSteps[`step${step}`].style.display = 'block';
            
            // Update step indicators
            Object.values(customerSteps).forEach(s => {
                s.classList.remove('active');
            });
            customerSteps[`step${step}`].classList.add('active');
            
            // Update buttons
            if (step === 1) {
                customerFormButtons.prev.style.display = 'none';
                customerFormButtons.next.style.display = 'inline-flex';
                customerFormButtons.save.style.display = 'none';
            } else if (step === 2) {
                customerFormButtons.prev.style.display = 'inline-flex';
                customerFormButtons.next.style.display = 'inline-flex';
                customerFormButtons.save.style.display = 'none';
            } else if (step === 3) {
                customerFormButtons.prev.style.display = 'inline-flex';
                customerFormButtons.next.style.display = 'none';
                customerFormButtons.save.style.display = 'inline-flex';
                
                // Populate confirmation data
                document.getElementById('confirmCustomerName').textContent = customerFormFields.name.value;
                document.getElementById('confirmCustomerPhone').textContent = customerFormFields.phone.value;
                document.getElementById('confirmCustomerAddress').textContent = customerFormFields.address.value || '-';
                document.getElementById('confirmCustomerCredit').textContent = parseInt(customerFormFields.credit.value).toLocaleString('fa-IR') + ' تومان';
                document.getElementById('confirmCustomerNotes').textContent = customerFormFields.notes.value || '-';
            }
            
            // Mark previous steps as completed
            for (let i = 1; i < step; i++) {
                customerSteps[`step${i}`].classList.add('completed');
            }
        }
        
        // Customer form navigation
        customerFormButtons.next.addEventListener('click', () => {
            const currentStep = Object.values(customerFormSteps).findIndex(step => step.style.display !== 'none') + 1;
            
            if (validateCustomerStep(currentStep)) {
                showCustomerStep(currentStep + 1);
            }
        });
        
        customerFormButtons.prev.addEventListener('click', () => {
            const currentStep = Object.values(customerFormSteps).findIndex(step => step.style.display !== 'none') + 1;
            showCustomerStep(currentStep - 1);
        });
        
        customerFormButtons.save.addEventListener('click', () => {
            // In a real app, this would save the customer to the database
            closeModal(addCustomerModal);
            showToast('مشتری جدید با موفقیت اضافه شد');
        });

        customerFormButtons.cancel.addEventListener('click', () => {
            closeModal(addCustomerModal);
        });
        
        // Product search
        document.getElementById('inventorySearch').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const productCards = document.querySelectorAll('.product-card');
            
            productCards.forEach(card => {
                const productName = card.querySelector('.product-name').textContent.toLowerCase();
                const productCode = card.querySelector('.product-code').textContent.toLowerCase();
                
                if (productName.includes(searchTerm) || productCode.includes(searchTerm)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        });
        
        // Product search in sale modal
        document.getElementById('productSearchInput').addEventListener('input', (e) => {
            const searchTerm = e.target.value;
            if (searchTerm.length > 2) {
                // Simulate product search
                showToast(`جستجو برای: ${searchTerm}`);
            }
        });
        
        // Empty state buttons
        document.getElementById('emptyStateNewSaleBtn').addEventListener('click', () => {
            openModal(newSaleModal);
        });

        document.getElementById('emptyStateAddProductBtn').addEventListener('click', () => {
            resetProductForm();
            openModal(addProductModal);
        });

        document.getElementById('emptyStateAddCustomerBtn').addEventListener('click', () => {
            resetCustomerForm();
            openModal(addCustomerModal);
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                if (speedDial && speedDial.classList.contains('active')) {
                    closeSpeedDial();
                }

                if (document.querySelector('.modal.active')) {
                    closeAllModals();
                }

                hideToast();
            }
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize sales chart
            setTimeout(() => {
                initSalesChart();
            }, 300);
            
            // Check if app is installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('App is running in standalone mode');
            }
        });
        
        // Handle online/offline status
        window.addEventListener('online', () => {
            showToast('اتصال به اینترنت برقرار شد');
        });
        
        window.addEventListener('offline', () => {
            showToast('بدون اتصال به اینترنت. داده‌ها به صورت آفلاین ذخیره می‌شوند.');
        });
    </script>
</body>
</html>
