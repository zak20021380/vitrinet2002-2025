<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <script src="/seller/api-client.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>پیام‌های مشتریان | ویترینت</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {font-family:'Vazirmatn',sans-serif;}
    .modal-bg {background:rgba(36,48,58,0.27);}
    .msg-customer {background:#e0fdfa; color:#0284c7;}
    .msg-seller   {background:#f1faf7; color:#334155;}
    .msg-admin    {background:#fef3c7; color:#b45309;}
    /* مخفی‌کردن CTA نصب اپلیکیشن در صفحه پیام‌ها */
    #installAppCta {display:none !important;}
    .chat-delete-btn {transition:background .13s;}
    .chat-delete-btn:hover {background:#fee2e2; color:#dc2626;}
    .chat-block-btn {transition:background .13s;}
    .chat-block-btn:hover {background:#fef3c7; color:#b45309;}
    .modal::-webkit-scrollbar {width:6px;background:transparent;}
    .modal::-webkit-scrollbar-thumb {background:#10b98133;border-radius:9px;}
    /* نوتیفیکیشن پیام جدید - استایل حرفه‌ای */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-120%);
      min-width: 320px;
      max-width: 90vw;
      background: linear-gradient(135deg, #ffffff 0%, #f8fffe 100%);
      color: #1e293b;
      padding: 0;
      border-radius: 20px;
      box-shadow: 
        0 25px 80px rgba(15, 23, 42, 0.25),
        0 10px 30px rgba(16, 185, 129, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(16, 185, 129, 0.2);
      display: flex;
      align-items: stretch;
      overflow: hidden;
      opacity: 0;
      pointer-events: none;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 9999;
    }
    .toast.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) translateY(0);
    }
    .toast__accent {
      width: 6px;
      background: linear-gradient(180deg, #10b981 0%, #0ea5e9 100%);
      flex-shrink: 0;
    }
    .toast__body {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 20px;
      flex: 1;
    }
    .toast__icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(14, 165, 233, 0.1) 100%);
      display: grid;
      place-items: center;
      flex-shrink: 0;
      position: relative;
      overflow: hidden;
    }
    .toast__icon::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.4) 100%);
      border-radius: inherit;
    }
    .toast__icon svg {
      width: 26px;
      height: 26px;
      position: relative;
      z-index: 1;
    }
    .toast__content {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
      min-width: 0;
    }
    .toast__title {
      font-weight: 800;
      font-size: 15px;
      color: #0f172a;
      letter-spacing: -0.3px;
    }
    .toast__desc {
      font-size: 13px;
      color: #64748b;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 200px;
    }
    .toast__time {
      font-size: 11px;
      color: #94a3b8;
      margin-top: 2px;
    }
    .toast__close {
      width: 32px;
      height: 32px;
      border-radius: 10px;
      background: rgba(239, 68, 68, 0.08);
      border: none;
      cursor: pointer;
      display: grid;
      place-items: center;
      transition: all 0.2s ease;
      margin-right: 4px;
    }
    .toast__close:hover {
      background: rgba(239, 68, 68, 0.15);
      transform: scale(1.05);
    }
    .toast__close svg {
      width: 16px;
      height: 16px;
      color: #ef4444;
    }
    .toast--admin .toast__accent {
      background: linear-gradient(180deg, #f59e0b 0%, #eab308 100%);
    }
    .toast--admin .toast__icon {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(234, 179, 8, 0.1) 100%);
    }
    .toast__progress {
      position: absolute;
      bottom: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #10b981, #0ea5e9);
      border-radius: 0 0 20px 0;
      animation: toastProgress 4s linear forwards;
    }
    .messages-header {
      justify-content: space-between;
      text-align: center;
      direction: rtl;
      align-items: center;
      width: 100%;
    }
    .messages-header__title-wrap {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .messages-header__title {
      direction: rtl;
      text-align: center;
      justify-content: center;
      width: 100%;
    }
    .toast--admin .toast__progress {
      background: linear-gradient(90deg, #f59e0b, #eab308);
    }
    @keyframes toastProgress {
      from { width: 100%; }
      to { width: 0%; }
    }
    @media (max-width: 480px) {
      .toast {
        min-width: auto;
        width: calc(100% - 32px);
        margin: 0 16px;
        left: 0;
        transform: translateY(-120%);
      }
      .toast.show {
        transform: translateY(0);
      }
      .toast__body {
        padding: 14px 16px;
        gap: 12px;
      }
      .toast__icon {
        width: 42px;
        height: 42px;
      }
      .toast__desc {
        max-width: 140px;
      }
    }
    .badge-pulse {box-shadow:0 0 0 0 rgba(239,68,68,0.32);animation:badgePulse 1.4s ease-out 1;}
    @keyframes badgePulse {
      0% {transform:scale(1); box-shadow:0 0 0 0 rgba(239,68,68,0.38);}
      60% {transform:scale(1.15); box-shadow:0 0 0 14px rgba(239,68,68,0);}
      100% {transform:scale(1); box-shadow:0 0 0 0 rgba(239,68,68,0);}
    }
    /* پنهان کردن دکمه‌های ناوبری روی موبایل هنگام باز بودن مدال چت یا مدال محصول */
    @media (max-width: 768px){
      body.chat-modal-open .home-btn,
      body.chat-modal-open #sidebarHamburger,
      body.chat-modal-open .sidebar-hamburger,
      body.chat-modal-open .hamburger-menu,
      body.product-modal-open .home-btn,
      body.product-modal-open #sidebarHamburger,
      body.product-modal-open .sidebar-hamburger,
      body.product-modal-open .hamburger-menu,
      body.product-modal-open .notification-bell,
      body.product-modal-open [class*="notification"],
      body.product-modal-open [class*="hamburger"] {display:none !important;}
    }
    .product-modal-open .notif-btn,
    .chat-modal-open .notif-btn {display:none !important;}
    .chat-item--new {border-color:#10b98144; background:linear-gradient(90deg,#f0fdfa,#ffffff);}
    
    /* استایل لینک مشاهده محصول - بالا سمت چپ */
    .product-view-link {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 4px 10px;
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.1), rgba(16, 185, 129, 0.08));
      border: 1px solid rgba(14, 165, 233, 0.25);
      border-radius: 8px;
      font-size: 10px;
      font-weight: 700;
      color: #0ea5e9;
      text-decoration: none;
      transition: all 0.2s ease;
      box-shadow: 0 2px 6px rgba(14, 165, 233, 0.1);
    }
    .product-view-link:hover {
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.18), rgba(16, 185, 129, 0.12));
      border-color: rgba(14, 165, 233, 0.4);
      color: #0284c7;
      box-shadow: 0 4px 12px rgba(14, 165, 233, 0.2);
      transform: translateY(-1px);
    }
    .product-view-link svg {
      transition: transform 0.2s ease;
    }
    .product-view-link:hover svg {
      transform: scale(1.15);
    }
    
    /* استایل مدال پیش‌نمایش محصول - ارتقا یافته */
    #productPreviewModalBg {
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .product-preview-modal {
      animation: modalSlideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      background: linear-gradient(165deg, #ffffff 0%, #f8fffe 50%, #f0fdfa 100%);
      border: 1px solid rgba(16, 185, 129, 0.2);
      box-shadow: 
        0 32px 100px rgba(15, 23, 42, 0.35),
        0 16px 40px rgba(16, 185, 129, 0.12),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    @keyframes modalSlideUp {
      from {
        opacity: 0;
        transform: translateY(40px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    .product-preview-image-wrapper {
      position: relative;
      overflow: hidden;
      background: linear-gradient(145deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
      border-radius: 1.5rem 1.5rem 0 0;
      padding: 1.5rem;
    }
    .product-preview-image-wrapper::before {
      content: '';
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 10% 90%, rgba(16, 185, 129, 0.35), transparent 50%),
        radial-gradient(circle at 90% 10%, rgba(14, 165, 233, 0.35), transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.15), transparent 60%);
      pointer-events: none;
    }
    .product-preview-image-wrapper::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: linear-gradient(to top, rgba(15, 23, 42, 0.5), transparent);
      pointer-events: none;
    }
    .product-preview-image-wrapper img {
      filter: drop-shadow(0 12px 32px rgba(0, 0, 0, 0.4));
      transition: transform 0.3s ease;
    }
    .product-preview-modal:hover .product-preview-image-wrapper img {
      transform: scale(1.02);
    }
    .product-preview-content {
      background: linear-gradient(180deg, #ffffff 0%, #fafffe 100%);
      position: relative;
    }
    .product-preview-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 4px;
      background: linear-gradient(90deg, #10b981, #0ea5e9);
      border-radius: 2px;
      opacity: 0.5;
    }
    .product-preview-actions {
      background: linear-gradient(180deg, #f8fffe 0%, #ecfdf5 100%);
      border-top: 1px solid rgba(16, 185, 129, 0.15);
    }
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    /* دکمه بستن مدال */
    .product-preview-modal #closeProductPreviewModal {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      transition: all 0.25s ease;
    }
    .product-preview-modal #closeProductPreviewModal:hover {
      background: #fee2e2;
      transform: rotate(90deg) scale(1.1);
    }
    /* دسته‌بندی badge */
    .product-preview-category-badge {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }
    /* قیمت با استایل بهتر */
    .product-preview-price-wrapper {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(14, 165, 233, 0.05));
      border: 1px solid rgba(16, 185, 129, 0.15);
      border-radius: 12px;
      padding: 10px 16px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    /* دکمه مشاهده در سایت */
    .product-preview-actions a {
      background: linear-gradient(135deg, #10b981 0%, #0ea5e9 100%);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.35);
      transition: all 0.25s ease;
    }
    .product-preview-actions a:hover {
      box-shadow: 0 8px 28px rgba(16, 185, 129, 0.45);
      transform: translateY(-2px);
    }
    @media (max-width: 480px) {
      .product-preview-modal {
        max-height: 90vh;
        border-radius: 1.75rem 1.75rem 0 0;
        margin-top: auto;
      }
      #productPreviewModalBg {
        align-items: flex-end;
        padding: 0;
      }
      .product-preview-image-wrapper {
        padding: 1rem;
      }
      .product-preview-content {
        padding: 1.25rem 1.25rem 1rem;
      }
      .product-preview-actions {
        padding: 1rem 1.25rem;
        padding-bottom: calc(1.25rem + env(safe-area-inset-bottom, 12px));
      }
    }
    
    .cost-box {
      background:linear-gradient(90deg,#f0fdfa 85%,#f8fafc 100%);
      color:#10b981;font-weight:bold;border-radius:1em;font-size:15px;
      display:inline-block;padding:5px 18px;margin-top:2px;
      box-shadow:0 3px 14px #10b98112;
    }
    /* کارت لیست چت */
    .chat-item:hover {background:#f0fdfa;}
    #blockSuccess {
      display:none;position:fixed;top:40px;left:50%;transform:translateX(-50%);
      background:#ecfdf5;border:1px solid #10b981;color:#065f46;
      padding:12px 24px;border-radius:12px;font-weight:bold;z-index:9999;
      box-shadow:0 4px 20px rgba(16,185,129,0.2);transition:opacity .3s;
    }
    #blockSuccess.show {display:block;opacity:1;}
    @media (max-width:700px){
      .msg-bubble{font-size:14px;}
    }
    @media (max-width:450px){
      .modal{padding:14px 6px !important;}
    }
  </style>
  <script src="/nav-active.js" defer></script>

<!-- TODO: فعال‌سازی پست‌هاگ را هنگام انتشار فراموش نکنید | TODO: Enable PostHog analytics when going live -->
<!--
<script>
  (function () {
    var config = window.POSTHOG_CONFIG || { enabled: false, apiKey: 'phc_YOUR_KEY_HERE', apiHost: 'https://analytics.vitreenet.ir' };
    if (!config.enabled) {
      return; // فعال نیست | Not enabled yet
    }
    try {
      (function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")),p.type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js";(r=t.getElementsByTagName("script")[0]),r.parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:u=e,u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==u._i&&(e+="."+u._i),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"};n="capture identify alias people.set people.set_once people.unset people.increment people.append people.union people.remove people.clear_opt_out_outcome register register_once unregister opt_out_capturing opt_in_capturing has_opted_out_capturing reset isFeatureEnabled onFeatureFlags reloadFeatureFlags group".split(" ");for(o=0;o<n.length;o++)g(u,n[o]);e._i.push([i,s,a])},e.__SV=1.1)})(document, window.posthog || []);
      window.posthog.init(config.apiKey, { api_host: config.apiHost, capture_pageview: true, advanced_disable_decide: true });
    } catch (error) {
      console.warn('PostHog init failed (preview mode):', error);
    }
  })();
</script>
-->

</head>
<body class="bg-gradient-to-tr from-[#e0fdfa] via-[#f8fafc] to-[#d4fbe8] min-h-screen pb-8">

  <div id="newMessageToast" class="toast" aria-live="polite" aria-atomic="true">
    <div class="toast__accent"></div>
    <div class="toast__body">
      <div class="toast__icon" id="toastIcon">
        <svg fill="none" viewBox="0 0 24 24" stroke="#10b981" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
        </svg>
      </div>
      <div class="toast__content">
        <div id="toastTitle" class="toast__title"></div>
        <div id="toastDesc" class="toast__desc"></div>
        <div id="toastTime" class="toast__time"></div>
      </div>
      <button type="button" class="toast__close" id="toastClose" aria-label="بستن">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="toast__progress" id="toastProgress"></div>
  </div>

  <div class="max-w-2xl mx-auto bg-white/90 shadow-2xl rounded-3xl px-3 sm:px-7 py-7 mt-4">

    <!-- هدر صفحه -->
    <div class="flex items-center mb-7 flex-wrap gap-3 messages-header">
      <div class="flex items-center gap-3 messages-header__title-wrap">
        <h1 class="text-2xl sm:text-3xl font-extrabold text-[#0ea5e9] flex items-center gap-2 messages-header__title">
          <svg width="28" height="28" fill="none" viewBox="0 0 24 24">
            <rect x="3" y="5" width="18" height="14" rx="3" stroke="#10b981" stroke-width="2"/>
            <path d="M3 7l9 6 9-6" stroke="#0ea5e9" stroke-width="2" stroke-linecap="round"/>
          </svg>
          پیام‌های مشتریان
        </h1>
      </div>
      <button
        id="openContactAdmin"
        class="flex items-center gap-2 bg-yellow-400 hover:bg-yellow-500 text-slate-800 font-bold py-2 px-5 rounded-xl text-base shadow transition-all"
      >
        <svg width="22" height="22" fill="none" viewBox="0 0 24 24">
          <path d="M4 4h16v16H4z" stroke="#b45309" stroke-width="2"/>
        </svg>
        ارتباط با مدیر
      </button>
    </div>

    <div class="text-gray-400 text-center text-base mb-6">
      همه چت‌ها درباره محصولاتت همینجاست. لازم نیست همه رو جواب بدی. اگه خواستی، حذفشون کن یا تبلیغ بفرست!
    </div>

    <!-- لیست چت‌ها -->
    <div id="chats" class="flex flex-col gap-4">
      <!-- آیتم‌های چت به‌صورت داینامیک با JS درج می‌شوند -->
      <!-- ساختار هر آیتم: 
      <div class="chat-item cursor-pointer bg-white border rounded-xl p-4 flex justify-between items-center" data-chat-id="...">
        <div class="flex items-center gap-3">
          <img src="IMAGE" class="w-10 h-10 rounded-lg border hidden sm:block" alt="">
          <div class="flex flex-col">
            <span class="font-bold text-[#10b981] truncate max-w-[160px] sm:max-w-[220px]">عنوان چت یا محصول</span>
            <span class="text-xs text-gray-400 mt-0.5 hidden sm:block">آخرین پیام خلاصه…</span>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <span class="hidden text-xs text-gray-400 sm:inline" id="chat-time-...">۴ دقیقه پیش</span>
          <span class="inline-flex items-center justify-center h-5 min-w-[20px] text-xs font-bold rounded-full bg-red-500 text-white"
                id="badge-...">2</span>
        </div>
      </div>
      -->
    </div>
  </div>

  <!-- --- مدال نمایش کامل یک چت --- -->
  <div id="chatModalBg" class="fixed z-40 inset-0 hidden modal-bg flex items-center justify-center">
    <div class="modal bg-white rounded-2xl shadow-2xl p-5 sm:p-8 w-full max-w-lg max-h-[92vh] overflow-y-auto relative flex flex-col">
      <button id="closeChatModal" class="absolute left-3 top-3 text-gray-400 hover:text-[#ef4444] text-2xl" type="button">&#10006;</button>

      <!-- هدر مدال -->
      <div id="chatModalHeader" class="flex items-center gap-3 mb-4">
        <!-- تصویر محصول/آیکون -->
        <img id="chatModalAvatar" src="" alt="" class="w-10 h-10 rounded-lg border hidden">
        <div class="flex flex-col">
          <h2 id="chatModalTitle" class="text-[#10b981] font-bold text-lg"></h2>
          <span id="chatModalSub" class="text-xs text-gray-400"></span>
        </div>
      </div>

      <!-- بدنه پیام‌ها -->
      <div id="chatModalMessages" class="flex flex-col gap-3 overflow-y-auto flex-1 pr-1">
        <!-- پیام‌ها به‌صورت داینامیک درج می‌شوند
        <div class="msg-bubble msg-admin self-start px-4 py-2 rounded-2xl text-sm leading-relaxed">
          <div class="font-semibold text-xs mb-1">مدیر سایت</div>
          متن پیام
          <div class="text-[10px] text-gray-400 mt-1 text-left">۱۴۰۲/۰۳/۱۷ - ۱۴:۰۹</div>
        </div>
        -->
      </div>

      <!-- فرم ارسال پاسخ -->
      <form id="chatReplyForm" class="flex gap-2 mt-4">
        <input id="chatReplyInput" type="text" placeholder="پاسخ…" class="flex-1 border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#0ea5e9]" required />
        <button class="bg-[#0ea5e9] hover:bg-[#0284c7] text-white px-6 py-2 rounded-lg shadow" type="submit">ارسال</button>
      </form>
    </div>
  </div>
  <!-- --- پایان مدال چت --- -->

  <!-- --- مدال ارسال تبلیغ --- -->
  <div id="adModalBg" class="fixed z-40 inset-0 hidden modal-bg flex items-center justify-center">
    <div class="modal bg-white rounded-2xl shadow-2xl p-5 sm:p-9 w-full max-w-lg max-h-[92vh] overflow-y-auto relative">
      <button id="closeAdModal" class="absolute left-3 top-3 text-gray-400 hover:text-[#ef4444] text-2xl" type="button">&#10006;</button>
      <h2 class="text-lg sm:text-xl font-bold text-[#10b981] mb-3 flex items-center gap-2">
        <svg width="20" height="20" fill="none" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke="#10b981" stroke-width="2" stroke-linecap="round"/></svg>
        ارسال تبلیغ به مشتریان
      </h2>

      <!-- فرم ارسال تبلیغ -->
      <form id="adForm" class="flex flex-col gap-5" autocomplete="off">
        <!-- نوع تبلیغ -->
        <div>
          <label class="font-semibold text-[15px] text-gray-700 mb-1 block">نوع تبلیغ:</label>
          <div class="flex gap-4 mt-2">
            <label class="flex items-center gap-2">
              <input type="radio" name="adType" value="sms" checked class="accent-[#10b981]"/>
              <span>پیامک</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="radio" name="adType" value="dashboard" class="accent-[#10b981]"/>
              <span>درون سایت (داشبورد مشتری)</span>
            </label>
          </div>
        </div>
        <!-- انتخاب محصول -->
        <div>
          <label class="font-semibold text-[15px] text-gray-700 mb-1 block">انتخاب محصول:</label>
          <div class="flex flex-col gap-2 max-h-36 overflow-y-auto pr-1">
            <label class="flex items-center gap-3 cursor-pointer hover:bg-[#f0fdfa] p-2 rounded transition">
              <input type="radio" name="product" value="prod1" class="accent-[#10b981]" checked />
              <img src="https://via.placeholder.com/28x28?text=کشمش" class="w-7 h-7 rounded border" alt="">
              <span class="font-medium text-[#10b981] text-[15px]">کشمش سبز پلویی ممتاز</span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer hover:bg-[#f0fdfa] p-2 rounded transition">
              <input type="radio" name="product" value="prod2" class="accent-[#10b981]" />
              <img src="https://via.placeholder.com/28x28?text=پسته" class="w-7 h-7 rounded border" alt="">
              <span class="font-medium text-[#10b981] text-[15px]">پسته احمد آقایی درجه۱</span>
            </label>
          </div>
        </div>
        <!-- متن تبلیغ -->
        <div>
          <label class="font-semibold text-[15px] text-gray-700 mb-1 block">متن تبلیغ:</label>
          <textarea name="adText" id="adText" rows="2" required maxlength="70"
            class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#10b981] text-base bg-white shadow-sm resize-none"
            placeholder="متن تبلیغ را بنویسید (در پیامک، حداکثر ۷۰ کاراکتر)"></textarea>
          <div id="charCount" class="text-xs text-gray-400 mt-1 text-left">۰/۷۰</div>
        </div>
        <!-- تعداد مشتریان -->
        <div>
          <label class="font-semibold text-[15px] text-gray-700 mb-1 block">تعداد مشتریان:</label>
          <input type="number" name="adCount" min="1" max="10000" value="1000" class="border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#10b981] w-32 text-base shadow-sm" required />
        </div>
        <!-- هزینه تبلیغ -->
        <div>
          <label class="font-semibold text-[15px] text-gray-700 mb-1 block">هزینه کل تبلیغ:</label>
          <span id="adCostBox" class="cost-box">۰ تومان</span>
        </div>
        <button
          type="submit"
          id="adSubmitBtn"
          class="flex items-center justify-center gap-2 bg-[#10b981] hover:bg-[#0ea5e9] text-white font-bold py-2.5 px-6 rounded-xl text-base shadow transition-all mt-1"
        >
          <svg width="20" height="20" fill="none" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>
          ارسال تبلیغ
        </button>
      </form>
      <div id="adSuccess" class="hidden text-green-600 font-bold text-center mt-4"></div>
    </div>
  </div>
  <!-- --- پایان مدال تبلیغ --- -->

  <!-- === مدال «ارتباط با مدیر» === -->
  <div id="contactModalBg" class="fixed z-40 inset-0 hidden modal-bg flex items-center justify-center">
    <div class="modal bg-white rounded-2xl shadow-2xl p-5 sm:p-9 w-full max-w-lg max-h-[92vh] overflow-y-auto relative">
      <button id="closeContactModal" class="absolute left-3 top-3 text-gray-400 hover:text-[#ef4444] text-2xl" type="button">&#10006;</button>
      <h2 class="text-lg sm:text-xl font-bold text-yellow-500 mb-3">ارتباط با مدیر</h2>
      <form id="contactForm" class="flex flex-col gap-5">
        <div>
          <label class="font-semibold text-[15px] text-gray-700 mb-1 block">متن پیام:</label>
          <textarea id="contactText" rows="4" required
            class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-base bg-white shadow-sm resize-none"></textarea>
        </div>
        <button type="submit" class="bg-yellow-400 hover:bg-yellow-500 text-slate-800 font-bold py-2 px-6 rounded-xl shadow transition-all">
          ارسال پیام
        </button>
        <div id="contactSuccess" class="hidden text-green-600 font-bold text-center mt-4">✅ پیام با موفقیت ارسال شد.</div>
      </form>
    </div>
  </div>
  <!-- === پایان مدال «ارتباط با مدیر» === -->

  <!-- === مدال مسدودسازی مشتری === -->
  <div id="blockModalBg" class="fixed z-40 inset-0 hidden modal-bg flex items-center justify-center">
    <div class="modal bg-white rounded-2xl shadow-2xl p-5 sm:p-8 w-full max-w-md relative">
      <button id="closeBlockModal" class="absolute left-3 top-3 text-gray-400 hover:text-[#ef4444] text-2xl" type="button">&#10006;</button>
      <h2 class="text-lg font-bold text-red-500 mb-3">مسدودسازی مشتری</h2>
      <textarea id="blockReason" rows="3" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 text-base bg-white shadow-sm resize-none" placeholder="دلیل مسدودسازی را بنویسید…"></textarea>
      <div class="flex gap-3 mt-4">
        <button id="confirmBlockBtn" class="bg-red-500 hover:bg-red-600 text-white flex-1 py-2 rounded-lg">تایید</button>
        <button id="cancelBlockBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 flex-1 py-2 rounded-lg">انصراف</button>
      </div>
    </div>
  </div>
  <!-- === پایان مدال مسدودسازی مشتری === -->

  <div id="blockSuccess">✔️ کاربر با موفقیت مسدود شد</div>

  <!-- === مدال پیش‌نمایش محصول === -->
  <div id="productPreviewModalBg" class="fixed z-50 inset-0 hidden modal-bg flex items-center justify-center p-4">
    <div class="product-preview-modal bg-white rounded-3xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden relative flex flex-col">
      <!-- دکمه بستن -->
      <button id="closeProductPreviewModal" class="absolute left-4 top-4 w-10 h-10 rounded-full flex items-center justify-center z-20" type="button">
        <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
      
      <!-- تصویر محصول -->
      <div class="product-preview-image-wrapper relative">
        <img id="productPreviewImage" src="" alt="" class="w-full h-52 sm:h-60 object-contain rounded-xl">
        <div class="product-preview-category-badge absolute bottom-4 right-4 px-4 py-2 rounded-full text-xs font-bold text-[#10b981]">
          <span id="productPreviewCategory">دسته‌بندی</span>
        </div>
      </div>
      
      <!-- محتوای محصول -->
      <div class="product-preview-content flex-1 overflow-y-auto p-5 sm:p-6 pt-6">
        <h3 id="productPreviewTitle" class="text-lg sm:text-xl font-extrabold text-[#0f172a] mb-4 leading-relaxed"></h3>
        
        <!-- قیمت -->
        <div class="product-preview-price-wrapper mb-4">
          <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="#10b981" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span class="text-2xl font-black text-[#10b981]" id="productPreviewPrice">-</span>
          <span class="text-sm text-gray-500 font-medium">تومان</span>
        </div>
        
        <!-- توضیحات -->
        <p id="productPreviewDesc" class="text-sm text-gray-600 leading-7 mb-4 line-clamp-3"></p>
        
        <!-- اطلاعات اضافی -->
        <div class="flex flex-wrap gap-2">
          <span class="inline-flex items-center gap-1.5 px-3 py-2 bg-gradient-to-r from-[#f0fdfa] to-[#ecfdf5] text-[#10b981] rounded-xl text-xs font-bold border border-[#10b98120]">
            <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
            </svg>
            <span id="productPreviewTag">برچسب</span>
          </span>
        </div>
      </div>
      
      <!-- دکمه‌های اکشن -->
      <div class="product-preview-actions p-4 sm:p-5 flex gap-3">
        <a id="productPreviewLink" href="#" target="_blank" rel="noopener" class="flex-1 flex items-center justify-center gap-2 text-white font-bold py-3.5 px-4 rounded-xl">
          <svg width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
          </svg>
          مشاهده در سایت
        </a>
        <button id="closeProductPreviewBtn" class="px-5 py-3.5 bg-white border-2 border-gray-200 text-gray-600 font-bold rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all">
          بستن
        </button>
      </div>
    </div>
  </div>
  <!-- === پایان مدال پیش‌نمایش محصول === -->

  <script src="dashboard-messages.js"></script>

<!-- TODO: افزودن رویدادهای PostHog پس از فعال‌سازی | TODO: Enable PostHog events after activation -->
<!--
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const safeCapture = window.safePosthogCapture || function () {};
    // پیام ارسالی بین خریدار و فروشنده | Buyer-to-seller message sent
    // const messageForm = document.querySelector('[data-track="seller-message"]');
    // messageForm?.addEventListener('submit', function () {
    //   safeCapture('message_sent', { channel: 'seller-inbox' });
    // });
  });
</script>
-->

</body>
</html>
