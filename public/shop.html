<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta http-equiv="Strict-Transport-Security" content="max-age=63072000; includeSubDomains; preload">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="Referrer-Policy" content="no-referrer">
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta name="referrer" content="no-referrer">
<meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ONYX MODERN | فروشگاه آنلاین پوشاک شیک و مدرن</title>
  <meta name="description" content="خرید آنلاین پوشاک و اکسسوری مینیمال و مدرن با بهترین قیمت و جدیدترین ترندهای بازار">
  <meta name="keywords" content="خرید لباس, پوشاک زنانه, پوشاک مردانه, اکسسوری, لباس ارزان, ترند, مد, فروشگاه پوشاک, فروشگاه مدرن">
  <meta name="robots" content="index, follow">
  <meta name="author" content="ONYX MODERN">
  <meta property="og:title" content="ONYX MODERN | فروشگاه آنلاین پوشاک مدرن">
  <meta property="og:description" content="فروشگاه اینترنتی پوشاک و اکسسوری مدرن با فیلتر قیمت و جدیدترین محصولات. تجربه خریدی ساده و مطمئن.">
  <meta property="og:image" content="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1200&q=80">
  <meta property="og:url" content="https://onyxmodern.com">
  <meta property="og:type" content="website">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
  --primary: #7C83FD;
  --secondary: #FFB677;
  --background: #F7FAFE;
  --text: #232946;
  --success: #52b788;
  --danger: #ee6c4d;
}
body {
  font-family: 'Vazirmatn', sans-serif;
  background: var(--background);
  color: var(--text);
  min-height: 100vh;
  margin: 0;
  overflow-x: hidden;
  transition: background 0.3s, color 0.3s;
}

/* ===== Modern & Responsive Shop Header ===== */
.shop-header {
  position: sticky;
  top: 0;
  left: 0;
  right: 0;
  z-index: 60;
  background: rgba(255, 255, 255, 0.98);
  border-bottom: 1px solid rgba(124, 131, 253, 0.1);
  backdrop-filter: blur(20px);
  box-shadow: 0 2px 20px rgba(35, 41, 70, 0.06);
  transition: all 0.3s ease;
}

.shop-header .header-shell {
  max-width: 1280px;
  margin: 0 auto;
  padding: 1rem 2rem;
  display: grid;
  grid-template-columns: auto minmax(260px, 1fr) auto auto;
  grid-template-areas: "brand badge actions mobile";
  align-items: center;
  gap: 1.25rem 1rem;
}

/* ===== Brand Section ===== */
.brand-area {
  display: flex;
  align-items: center;
  gap: 1.25rem;
  flex: 0 0 auto;
  grid-area: brand;
}

.menu-toggle {
  display: none;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 10px;
  border: none;
  background: rgba(124, 131, 253, 0.08);
  color: var(--primary);
  cursor: pointer;
  transition: all 0.25s ease;
  flex-shrink: 0;
}

.menu-toggle:hover {
  background: rgba(124, 131, 253, 0.15);
  transform: scale(1.05);
}

.menu-toggle:active {
  transform: scale(0.95);
}

.menu-toggle svg {
  width: 20px;
  height: 20px;
  stroke-width: 2.5;
}

.home-link {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  text-decoration: none;
  background: transparent;
  padding: 0;
  color: inherit;
  transition: transform 0.2s ease;
}

.home-link:hover {
  transform: translateX(4px);
}

.brand-label {
  font-size: clamp(1.1rem, 1vw + 0.8rem, 1.5rem);
  font-weight: 900;
  letter-spacing: -0.02em;
  line-height: 1;
  background: linear-gradient(135deg, var(--primary) 0%, #52b788 100%);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  flex-shrink: 0;
}

.logo-wrap {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.logo-text {
  font-family: 'Vazirmatn', sans-serif;
  font-weight: 700;
  font-size: clamp(1.05rem, 0.9vw + 0.7rem, 1.4rem);
  color: var(--text);
  line-height: 1.2;
  transition: color 0.2s ease;
  margin: 0;
  padding: 0;
}

.home-link:hover .logo-text {
  color: var(--primary);
}

.logo-caption {
  font-size: clamp(0.75rem, 0.7vw + 0.6rem, 0.9rem);
  color: #6b7280;
  font-weight: 500;
  line-height: 1.3;
  margin: 0;
  padding: 0;
}

/* ===== Customer Badge (Compact) ===== */
.badge-cluster {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex: 1 1 auto;
  justify-content: center;
  grid-area: badge;
  min-width: 260px;
}

.customer-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.6rem 1.2rem;
  border-radius: 16px;
  background: linear-gradient(135deg, rgba(124, 131, 253, 0.08) 0%, rgba(82, 183, 136, 0.12) 100%);
  border: 1px solid rgba(124, 131, 253, 0.25);
  color: #0f172a;
  font-weight: 700;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 2px 10px rgba(124, 131, 253, 0.12);
  width: 100%;
  max-width: 420px;
}

.customer-badge:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(124, 131, 253, 0.2);
  border-color: rgba(82, 183, 136, 0.5);
}

.customer-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: 12px;
  background: white;
  color: var(--primary);
  box-shadow: 0 2px 8px rgba(124, 131, 253, 0.2);
}

.customer-icon svg {
  width: 18px;
  height: 18px;
}

.customer-meta {
  display: flex;
  flex-direction: column;
  gap: 0.1rem;
  text-align: right;
}

.customer-count {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  color: #0f172a;
}

.customer-cta {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.8rem;
  color: #2563eb;
}

.customer-cta svg {
  width: 14px;
  height: 14px;
}

/* ===== Mobile Header Actions (فقط در موبایل) ===== */
.mobile-header-actions {
  display: none;
  align-items: center;
  gap: 0.5rem;
  flex: 0 0 auto;
  justify-content: flex-end;
  grid-area: mobile;
  flex-wrap: wrap;
}

.mobile-action-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
  padding: 0.5rem 0.85rem;
  background: linear-gradient(135deg, var(--primary) 0%, #52b788 100%);
  border: none;
  border-radius: 10px;
  color: white;
  font-weight: 700;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.25s ease;
  white-space: nowrap;
  text-decoration: none;
  box-shadow: 0 2px 8px rgba(124, 131, 253, 0.25);
}

.mobile-action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(124, 131, 253, 0.4);
}

.mobile-action-btn:active {
  transform: translateY(0);
}

.mobile-action-btn svg {
  width: 16px;
  height: 16px;
  stroke-width: 2.5;
}

.mobile-action-btn.register-btn {
  background: linear-gradient(135deg, #52b788 0%, var(--primary) 100%);
}

/* ===== Header Actions ===== */
.header-actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex: 0 0 auto;
  justify-content: flex-end;
  grid-area: actions;
}

.action-item {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.6rem 1.1rem;
  background: white;
  border: 1.5px solid rgba(124, 131, 253, 0.2);
  border-radius: 12px;
  color: #374151;
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.25s ease;
  white-space: nowrap;
}

.action-item:hover {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(124, 131, 253, 0.3);
}

.action-item:active {
  transform: translateY(0);
}

.action-item svg {
  width: 18px;
  height: 18px;
}

.rating-count-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.2rem 0.5rem;
  border-radius: 999px;
  background: rgba(124, 131, 253, 0.12);
  font-size: 0.8rem;
  color: #4b5563;
}

/* ===== Responsive Design ===== */

/* Large Desktop */
@media (max-width: 1280px) {
  .shop-header .header-shell {
    padding: 1rem 1.5rem;
  }
}

/* Tablet Landscape */
@media (max-width: 1024px) {
  .shop-header .header-shell {
    grid-template-columns: auto minmax(220px, 1fr) auto;
    grid-template-areas: "brand badge actions";
    gap: 1.5rem 1rem;
  }

  .action-item span {
    display: none;
  }

  .action-item {
    padding: 0.6rem;
    width: 40px;
    height: 40px;
  }
}

/* Tablet Portrait */
@media (max-width: 900px) {
  .shop-header .header-shell {
    grid-template-columns: 1fr auto;
    grid-template-areas:
      "brand actions"
      "badge badge"
      "mobile mobile";
    align-items: start;
  }

  .menu-toggle {
    display: flex;
  }

  .badge-cluster {
    flex: 1 1 100%;
    justify-content: flex-start;
  }

  .customer-badge {
    max-width: none;
    width: 100%;
    padding: 0.75rem 1rem;
  }

  .customer-meta {
    align-items: flex-start;
  }

  /* نمایش دکمه‌های موبایل */
  .mobile-header-actions {
    display: flex;
    width: 100%;
    justify-content: flex-start;
  }

  /* مخفی کردن دکمه آدرس از منوی اصلی */
  .header-actions #addressBtn {
    display: none;
  }

  .header-actions {
    position: fixed;
    top: 70px;
    left: 1rem;
    right: 1rem;
    flex-direction: column;
    background: white;
    border: 1px solid rgba(124, 131, 253, 0.15);
    border-radius: 16px;
    padding: 0;
    gap: 0;
    box-shadow: 0 8px 32px rgba(35, 41, 70, 0.12);
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .shop-header.menu-open .header-actions {
    max-height: 300px;
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    padding: 0.75rem;
    gap: 0.5rem;
  }

  .action-item {
    width: 100%;
    justify-content: flex-start;
    padding: 0.75rem 1rem;
    border-radius: 12px;
    border: none;
    background: rgba(124, 131, 253, 0.05);
  }

  .action-item span {
    display: inline;
  }

  .action-item:hover {
    background: var(--primary);
    transform: translateX(4px);
    box-shadow: 0 2px 8px rgba(124, 131, 253, 0.2);
  }
}

/* Mobile */
@media (max-width: 768px) {
  .shop-header .header-shell {
    padding: 0.875rem 1rem;
    gap: 0.75rem;
  }

  .brand-area {
    gap: 1rem;
  }

  .customer-badge {
    font-size: 0.85rem;
    padding: 0.5rem 0.95rem;
    gap: 0.55rem;
  }

  .customer-icon {
    width: 32px;
    height: 32px;
  }

  .customer-icon svg {
    width: 15px;
    height: 15px;
  }

  /* تنظیم اندازه دکمه‌های موبایل */
  .mobile-action-btn {
    font-size: 0.75rem;
    padding: 0.45rem 0.7rem;
    gap: 0.35rem;
  }

  .mobile-action-btn svg {
    width: 14px;
    height: 14px;
  }
}

/* Small Mobile */
@media (max-width: 640px) {
  .shop-header .header-shell {
    padding: 0.75rem 0.875rem;
    gap: 0.5rem;
  }

  .brand-area {
    gap: 0.75rem;
  }

  .home-link {
    gap: 0.6rem;
  }

  .logo-caption {
    display: none;
  }

  .customer-badge {
    padding: 0.45rem 0.85rem;
    font-size: 0.8rem;
  }

  .customer-meta {
    line-height: 1.1;
  }

  /* اندازه کوچک‌تر برای دکمه‌های موبایل */
  .mobile-action-btn {
    font-size: 0.7rem;
    padding: 0.4rem 0.6rem;
    gap: 0.3rem;
  }

  .mobile-action-btn svg {
    width: 13px;
    height: 13px;
  }

  .mobile-action-btn span {
    display: inline;
  }
}

/* Extra Small Mobile */
@media (max-width: 480px) {
  .shop-header .header-shell {
    padding: 0.75rem;
    gap: 0.5rem;
  }

  .menu-toggle {
    width: 36px;
    height: 36px;
  }

  .customer-badge {
    padding: 0.4rem 0.7rem;
  }

  /* برای صفحات خیلی کوچک، فقط آیکون‌ها نمایش داده می‌شوند */
  .mobile-action-btn {
    font-size: 0.65rem;
    padding: 0.35rem 0.5rem;
    gap: 0.25rem;
  }

  .mobile-action-btn svg {
    width: 12px;
    height: 12px;
  }
}

.hero-slider {
  border-radius: 1rem;
  background: #fff;
  overflow: hidden;
  scroll-behavior: smooth;
  white-space: nowrap;
  box-shadow: 0 4px 24px #7C83FD15;
  position: relative;
  min-height: 440px;
  width: 100%;
  margin: 0 auto;
  cursor: auto;
}

/* هر اسلاید روی هم، فقط یکی فعاله */
.slide {
  position: absolute;
  inset: 0;
  opacity: 0;
  z-index: 0;
  transition: opacity 0.8s cubic-bezier(.45,1,.45,1);
  pointer-events: none;
  height: 100%;
}
.slide.active {
  opacity: 1;
  z-index: 1;
  pointer-events: auto;
}
.slide img { 
  width: 100%; 
  height: 100%; 
  object-fit: cover;
  image-rendering: auto;
  filter: none;
  border-radius: inherit;
}
.slide-caption {
  position: absolute; 
  bottom: 0; 
  right: 0; 
  left: 0;
  padding: 1.1rem 1.5rem;
  background: linear-gradient(to top, #364f6bcc 50%, transparent 100%);
  color: #fff; 
  text-align: right;
  border-radius: 0 0 1rem 1rem;
}
.slide-title { 
  font-size: 1.4rem; 
  font-weight: 900; 
  margin-bottom: .5rem;
}
.slide-desc { 
  font-size: 1rem; 
  font-weight: 500; 
  margin-bottom: 1rem;
}

/* دکمه فلش‌های چپ و راست - کوچک و شیک */
#prevSlide,
#nextSlide {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: #fff;
  border: none;
  outline: none;
  box-shadow: 0 1.5px 4px #7C83FD10;
  padding: 0.15rem 0.18rem;
  border-radius: 50%;
  cursor: pointer;
  z-index: 10;
  transition: background 0.13s, box-shadow 0.14s;
  width: 27px;
  height: 27px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.86;
}
#prevSlide { right: 7px; left: auto; }
#nextSlide { left: 7px; right: auto; }
#prevSlide:hover, #nextSlide:hover {
  background: var(--primary);
  opacity: 1;
  box-shadow: 0 3px 14px #7C83FD2a;
}
#prevSlide svg, #nextSlide svg {
  stroke: var(--primary);
  transition: stroke .18s;
  width: 13px;
  height: 13px;
  display: block;
}
#prevSlide:hover svg, #nextSlide:hover svg {
  stroke: #fff;
}

/* نقاط اسلایدر (dot) */
#sliderDots {
  position: absolute;
  bottom: 15px;
  right: 0;
  left: 0;
  margin: 0 auto;
  display: flex;
  justify-content: center;
  gap: 7px;
  z-index: 5;
}
.slider-dot {
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background: #A3BFFA;
  opacity: .4;
  cursor: pointer;
  transition: background .19s, opacity .19s, transform .17s;
}
.slider-dot.active {
  opacity: 1;
  background: var(--primary);
  transform: scale(1.15);
}

/* رسپانسیو */
@media (max-width: 1024px) {
  .hero-slider { min-height: 320px; }
  .slide-caption { font-size: .97rem; padding: .8rem 1.2rem; }
  #prevSlide, #nextSlide { top: 46%; }
}
@media (max-width: 600px) {
  .hero-slider { min-height: 170px; border-radius: .7rem; }
  .slide-caption { font-size: .87rem; padding: .4rem .5rem; }
  #prevSlide, #nextSlide { 
    width: 19px;
    height: 19px;
    padding: 0;
  }
  #prevSlide { right: 3px; left: auto; }
  #nextSlide { left: 3px; right: auto; }
  #prevSlide svg, #nextSlide svg { width: 9px; height: 9px; }
  #sliderDots { bottom: 6px; gap: 3px; }
  .slider-dot { width: 6px; height: 6px; }
}




.onyx-btn {
  background: linear-gradient(135deg, var(--primary) 0%, #5bc4b8 100%);
  color: #fff;
  font-weight: 800;
  border-radius: 0.9rem;
  padding: 0.65rem 1.2rem;
  font-size: 1rem;
  transition: transform .2s ease, box-shadow .2s ease, filter .2s ease;
  border: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.45rem;
  width: 100%;
  box-shadow: 0 10px 30px rgba(124, 131, 253, 0.24);
}

.onyx-btn:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 12px 36px rgba(124, 131, 253, 0.28);
  filter: brightness(1.02);
}

.onyx-btn:active {
  transform: translateY(0);
}

.product-card .onyx-btn {
  margin-top: auto;
}

.product-card {
  position: relative;
  background: linear-gradient(180deg, #ffffff 0%, #f7f9ff 100%);
  border-radius: 1.1rem;
  box-shadow: 0 12px 35px rgba(28, 44, 90, 0.08);
  border: 1px solid rgba(124, 131, 253, 0.12);
  padding: 1.1rem;
  display: flex;
  flex-direction: column;
  gap: 0.65rem;
  height: 100%;
  transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
}

.product-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 18px 45px rgba(28, 44, 90, 0.12);
  border-color: rgba(124, 131, 253, 0.3);
}

.product-media {
  width: 100%;
  position: relative;
  border-radius: 0.95rem;
  overflow: hidden;
  background: #eef2ff;
}

.product-card img {
  width: 100%;
  aspect-ratio: 4 / 3;
  object-fit: cover;
  display: block;
  transition: transform .25s ease;
}

.product-card:hover img {
  transform: scale(1.04);
}

.product-badges {
  position: absolute;
  top: 0.75rem;
  left: 0.75rem;
  display: flex;
  gap: 0.4rem;
  flex-wrap: wrap;
}

.product-chip {
  padding: 0.35rem 0.6rem;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 800;
  color: #fff;
  background: linear-gradient(135deg, var(--primary), #6dd3c0);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
  backdrop-filter: blur(6px);
}

.product-chip.new { background: linear-gradient(135deg, var(--success), #74c69d); }
.product-chip.sale { background: linear-gradient(135deg, var(--danger), #f19e86); }
.product-chip.best { background: linear-gradient(135deg, var(--secondary), #ffa15f); }

.product-body {
  display: flex;
  flex-direction: column;
  gap: 0.45rem;
  flex: 1 1 auto;
}

.product-title {
  font-size: 1.05rem;
  font-weight: 900;
  color: var(--text);
  margin: 0;
  line-height: 1.4;
}

.product-category {
  font-size: 0.85rem;
  color: #6b7280;
  font-weight: 600;
}

.product-meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.8rem;
}

.product-price {
  font-size: 1.15rem;
  font-weight: 900;
  color: var(--text);
}

.price-note {
  font-size: 0.8rem;
  color: #94a3b8;
  font-weight: 600;
}

.product-grid {
  display: grid;
  grid-template-columns: repeat(1, 1fr);
  gap: 1.18rem;
}

@media (min-width: 540px) {
  .hero-slider { min-height: 360px; }
  .product-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (min-width: 768px) {
  .product-grid { grid-template-columns: repeat(3, 1fr); }
}

@media (min-width: 920px) {
  .hero-slider { min-height: 440px; }
  .product-grid { grid-template-columns: repeat(4, 1fr); }
}

.footer {
  background: #E5ECFB; 
  color: #4661B6; 
  font-size: .99rem; 
  padding: 2rem 0; 
  margin-top: 4rem;
}

.footer-logo { 
  font-weight: 900; 
  color: var(--primary); 
  font-size: 1.12rem;
}

.footer a { 
  color: #4661B6; 
  transition: color .18s;
}

.footer a:hover { 
  color: var(--primary);
}

.slider-dot {
  width: 10px; 
  height: 10px; 
  margin: 0 4px; 
  border-radius: 50%; 
  background: #A3BFFA; 
  opacity: .47; 
  cursor: pointer;
  transition: background .19s, opacity .19s;
}

.slider-dot.active { 
  opacity: 1; 
  background: var(--primary);
}

.product-preview {
  display: none; 
  position: fixed; 
  top: 50%; 
  left: 50%; 
  transform: translate(-50%, -50%);
  background: #fff; 
  padding: 1.5rem; 
  border-radius: .83rem;
  box-shadow: 0 8px 36px #7C83FD40; 
  z-index: 999; 
  max-width: 95%; 
  width: 420px;
}

.product-preview.active { 
  display: block; 
  animation: fadeIn .33s;
}

.scroll-top-btn {
  position: fixed; 
  bottom: 1.2rem; 
  left: 1.2rem; 
  background: var(--primary); 
  color: #fff;
  padding: .6rem; 
  border-radius: 50%; 
  box-shadow: 0 2px 12px #7C83FD34;
  transition: transform .13s;
}

.scroll-top-btn:hover { 
  transform: scale(1.09);
}

@keyframes fadeIn { 
  from {opacity:0; transform: translate(-50%,-62%);} 
  to {opacity:1; transform: translate(-50%,-50%);} 
}

/* بهینه‌سازی برای موبایل */
@media (max-width: 540px) {
  .hero-slider {
    min-height: 300px; /* برای موبایل کوتاه‌تر می‌کنیم */
  }
  .product-card { 
    padding: .8rem; /* کاهش فضا */
  }
  .footer {
    font-size: 0.85rem;
  }
  .product-price { 
    font-size: 1rem; /* اندازه قیمت رو کوچک‌تر کردیم */
  }
}




/* --- استایل مدرن و رسپانسیو سلکت فیلتر/مرتب‌سازی محصولات --- */
.onyx-filter-select {
  appearance: none;
  -webkit-appearance: none;
  background-position: left 0.8em center;
  background-repeat: no-repeat;
  background-size: 1.27em;
  background-image: url('data:image/svg+xml;utf8,<svg fill="gray" height="18" width="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>');
  padding-left: 2.1em !important;
  font-family: inherit;
  font-weight: bold;
  box-shadow: 0 1px 6px #7C83FD11;
  transition: border .17s, box-shadow .18s;
}
.onyx-filter-select:focus {
  outline: none !important;
  box-shadow: 0 2px 14px #7C83FD2b;
  border-color: var(--primary);
  background-color: #f5f8ff;
}
@media (max-width: 700px) {
  .onyx-filter-select {
    font-size: .97rem;
    padding-left: 1.5em !important;
    min-width: 94px;
  }
  #products .flex {gap: 6px !important;}
}
@media (max-width: 480px) {
  .onyx-filter-select {
    font-size: .89rem;
    min-width: 75px;
    padding-left: 1em !important;
  }
  #products .flex {gap: 4px !important;}
}




.onyx-title-simple {
  font-size: 2rem;
  font-weight: 900;
  color: var(--text);
  margin-bottom: .7rem;
  letter-spacing: -.5px;
  line-height: 1.18;
  text-align: right;
  padding: 0;
  border: none;
  border-radius: 0;
  background: none;
  box-shadow: none;
  display: block;
}

@media (min-width: 640px) {
  .onyx-title-simple { font-size: 2.3rem; }
}
@media (min-width: 768px) {
  .onyx-title-simple { font-size: 2.7rem; }
}
@media (max-width: 500px) {
  .onyx-title-simple { font-size: 1.13rem; }
}

/* Favorite button modern style */
.favorite-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .4rem;
  padding: .55rem 1rem;
  font-family: inherit;
  font-weight: 700;
  font-size: .875rem;
  background: linear-gradient(135deg, rgba(82,183,136,0.7), rgba(124,131,253,0.7));
  backdrop-filter: blur(12px);
  border-radius: 1rem;
  border: 1px solid rgba(255,255,255,0.5);
  color: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: transform .2s, box-shadow .2s;
}
.favorite-btn:hover {
  transform: scale(1.06);
  box-shadow: 0 4px 14px rgba(0,0,0,0.2);
}

@media (max-width: 480px) {
  .favorite-btn { padding: .45rem .8rem; font-size: .8rem; }
}















</style>


  <script src="/nav-active.js" defer></script>

<!-- TODO: فعال‌سازی پست‌هاگ را هنگام انتشار فراموش نکنید | TODO: Enable PostHog analytics when going live -->
<!--
<script>
  (function () {
    var config = window.POSTHOG_CONFIG || { enabled: false, apiKey: 'phc_YOUR_KEY_HERE', apiHost: 'https://analytics.vitreenet.ir' };
    if (!config.enabled) {
      return; // فعال نیست | Not enabled yet
    }
    try {
      (function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")),p.type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js";(r=t.getElementsByTagName("script")[0]),r.parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:u=e,u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==u._i&&(e+="."+u._i),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"};n="capture identify alias people.set people.set_once people.unset people.increment people.append people.union people.remove people.clear_opt_out_outcome register register_once unregister opt_out_capturing opt_in_capturing has_opted_out_capturing reset isFeatureEnabled onFeatureFlags reloadFeatureFlags group".split(" ");for(o=0;o<n.length;o++)g(u,n[o]);e._i.push([i,s,a])},e.__SV=1.1)})(document, window.posthog || []);
      window.posthog.init(config.apiKey, { api_host: config.apiHost, capture_pageview: true, advanced_disable_decide: true });
    } catch (error) {
      console.warn('PostHog init failed (preview mode):', error);
    }
  })();
</script>
-->

</head>
<body>
  <!-- Header -->
<header class="shop-header" id="shopHeader" role="banner">
  <div class="header-shell">
    <!-- Brand & Logo Section -->
    <div class="brand-area">
      <button class="menu-toggle" id="headerMenuToggle" aria-label="باز و بسته کردن منو" aria-expanded="false" aria-controls="headerActions" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
      </button>
      <a href="/" class="home-link" title="رفتن به صفحه اصلی" aria-label="بازگشت به صفحه اصلی">
        <span class="brand-label">ویترینت</span>
        <div class="logo-wrap">
          <h1 class="logo-text logo-txt" id="shopLogoText">نئون استایل</h1>
          <p class="logo-caption logo-tagline">پوشاک مدرن و اکسسوری خاص</p>
        </div>
      </a>
    </div>

    <!-- Customer Badge -->
    <div class="badge-cluster">
      <button id="customerBadge" class="customer-badge" type="button" aria-label="مشاهده مشتریان و عضویت سریع">
        <span class="customer-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </span>
        <div class="customer-meta">
          <span class="customer-count"><span id="customerCountBadge" data-customer-count>0</span> مشتری</span>
          <span class="customer-cta">عضویت سریع
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 5v14m7-7H5"/>
            </svg>
          </span>
        </div>
      </button>
    </div>

    <!-- Mobile Visible Actions (فقط در موبایل نمایش داده می‌شود) -->
    <div class="mobile-header-actions">
      <button id="addressBtnMobile" class="mobile-action-btn" aria-label="مشاهده آدرس فروشگاه" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
          <circle cx="12" cy="10" r="3"/>
        </svg>
        <span>آدرس</span>
      </button>
      <a href="https://vitrinet.shop/register" class="mobile-action-btn register-btn" aria-label="ثبت فروشگاه در ویترینت">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 4v16m8-8H4"/>
        </svg>
        <span>ثبت فروشگاه</span>
      </a>
    </div>

    <!-- Navigation / Actions -->
    <nav class="header-actions" id="headerActions" aria-label="منوی اصلی">
      <button id="addressBtn" class="action-item" aria-label="مشاهده آدرس فروشگاه" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
          <circle cx="12" cy="10" r="3"/>
        </svg>
        <span>آدرس</span>
      </button>
      <button id="favShopBtn" class="action-item" aria-label="مشاهده مشتریان" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <span>مشتریان</span>
      </button>
      <button id="reportBtn" class="action-item" aria-label="ثبت گزارش تخلف" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <span>گزارش</span>
      </button>
      <button id="rateShow" class="action-item" aria-label="مشاهده و ثبت امتیاز" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="12 2 15 9 22 9 17 14 19 21 12 17 5 21 7 14 2 9 9 9 12 2"/>
        </svg>
        <span><span id="shop-rating">4.8</span> امتیاز</span>
        <span class="rating-count-pill"><span id="rating-count">0</span> رای</span>
      </button>
    </nav>
  </div>
</header>
<!-- پاپ‌آپ آدرس فروشگاه -->
  <div id="addressModal" class="fixed inset-0 z-[140] hidden flex items-center justify-center bg-black/40">
    <div class="bg-white rounded-2xl p-6 shadow-2xl w-[90vw] max-w-sm flex flex-col gap-4 animate-fade-in-down border border-emerald-100 text-center">
      <div class="flex items-center justify-between mb-2">
        <span class="text-lg font-bold text-emerald-600 flex items-center gap-1">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a2 2 0 01-2.828 0l-4.243-4.243A8 8 0 1120 12a8.001 8.001 0 01-2.343 4.657z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
          آدرس فروشگاه
        </span>
        <button id="closeAddressModal" class="p-1 hover:bg-emerald-100 rounded transition" aria-label="بستن">
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="text-gray-800 text-base font-bold mt-2">
        تهران، بلوار کشاورز، خیابان مهرام، پلاک ۲۱، طبقه ۲  
        <br>
        <span class="text-emerald-700 text-sm font-semibold mt-1 flex items-center justify-center gap-1">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M3 5h12M9 3v2m0 14a4 4 0 100-8 4 4 0 000 8zm7-4h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2z"/></svg>
          شماره تماس: <b dir="ltr" class="font-bold mx-1">09123456789</b>
        </span>
      </div>
    </div>
  </div>

  <!-- پاپ‌آپ مغازه محبوب -->
  <div id="favShopModal" class="fixed inset-0 z-[140] hidden flex items-center justify-center bg-black/40">
    <div class="bg-white/80 backdrop-blur-lg rounded-3xl p-6 shadow-2xl w-[90vw] max-w-sm flex flex-col gap-4 animate-fade-in-down border border-gray-200 text-center">
      <div class="flex items-center justify-between mb-1">
        <span class="text-lg font-bold text-[var(--primary)] flex items-center gap-1">
          <i class="fas fa-star"></i>
          مشتریان
        </span>
        <button id="closeFavShopModal" class="p-1 hover:bg-gray-100 rounded transition" aria-label="بستن">
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="text-gray-800 text-base font-bold mt-3">
        این مغازه توسط <span id="favShopCount" data-customer-count>150</span> مشتری دنبال می‌شود
      </div>
      <button id="toggleFavShopBtn" class="mt-2 favorite-btn w-full justify-center"></button>
    </div>
  </div>

  <!-- پاپ‌آپ گزارش تخلف -->
  <div id="reportModal" class="fixed inset-0 z-[140] hidden flex items-center justify-center bg-black/30">
    <div class="bg-white rounded-2xl p-5 shadow-2xl w-[92vw] max-w-sm flex flex-col gap-3 animate-fade-in-down border border-orange-100">
      <div class="flex items-center justify-between mb-2">
        <span class="text-lg font-bold text-orange-500 flex items-center gap-1">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"/><path d="M12 8v4M12 16h.01"/>
          </svg>
          ثبت گزارش تخلف
        </span>
        <button id="closeReportModal" class="p-1 hover:bg-orange-100 rounded transition" aria-label="بستن">
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>


      <!-- نوع تخلف -->
<label for="reportType" class="text-sm font-bold text-gray-600">نوع تخلف:</label>
<select id="reportType"
        class="w-full border border-orange-200 rounded-xl p-2 text-sm focus:ring-2 focus:ring-orange-400 outline-none">
  <option value="price_mismatch">عدم تطابق قیمت با مغازه</option>
  <option value="no_response">عدم پاسخ‌گویی به مشتری</option>
  <option value="overpricing">عدم تطابق کالا با مغازه</option>
  <option value="other">سایر تخلفات</option>
</select>

      <textarea id="reportText" rows="4" class="w-full border border-orange-200 rounded-xl p-2 text-sm focus:ring-2 focus:ring-orange-400 outline-none" placeholder="توضیحات تخلف را بنویسید..."></textarea>
      <button id="submitReport" class="mt-1 bg-gradient-to-r from-orange-400 to-orange-500 text-white font-bold py-2 rounded-xl hover:shadow-lg transition">ارسال گزارش</button>
      <div id="reportMsg" class="hidden text-green-500 font-bold mt-1"></div>
    </div>
  </div>

  <!-- پاپ‌آپ امتیازدهی -->
  <div id="rateModal" class="fixed inset-0 bg-black/30 z-[99] hidden items-center justify-center">
    <div class="bg-white rounded-2xl p-6 shadow-2xl w-[92vw] max-w-xs flex flex-col gap-4 animate-fade-in-down border border-yellow-100">
      <div class="flex items-center justify-between mb-1">
        <span class="text-lg font-bold text-yellow-500 flex items-center gap-1">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <polygon points="12 2 15 10 23 10 17 15 19 23 12 18 5 23 7 15 1 10 9 10" fill="#fbbf24"/>
          </svg>
          ثبت امتیاز
        </span>
        <button id="closeRateModal" class="p-1 hover:bg-yellow-100 rounded transition" aria-label="بستن">
          <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="flex justify-center gap-1" id="rateStars">
        <!-- ستاره‌ها اینجا رندر میشه -->
      </div>
      <button id="submitRate" class="mt-1 bg-gradient-to-r from-yellow-400 to-yellow-500 text-white font-bold py-2 rounded-xl hover:shadow-lg transition">ثبت امتیاز</button>
      <div id="rateMsg" class="hidden text-green-500 font-bold mt-1"></div>
    </div>
  </div>

</header>












  <!-- Hero Slider -->
<section class="max-w-[95%] mx-auto hero-slider mt-4 relative" aria-label="اسلایدر تبلیغاتی" id="heroSliderSection">
  <!-- اسلایدها اینجا به صورت داینامیک اضافه می‌شوند -->
  <div class="absolute left-4 bottom-3 z-20 flex" id="sliderDots"></div>
  <button id="prevSlide" class="absolute right-3 top-1/2 -translate-y-1/2 bg-white hover:bg-[var(--primary)] p-2 rounded-full shadow-md" aria-label="اسلاید قبلی">
    <svg class="w-4 h-4" fill="none" stroke="var(--text)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
  </button>
  <button id="nextSlide" class="absolute left-3 top-1/2 -translate-y-1/2 bg-white hover:bg-[var(--primary)] p-2 rounded-full shadow-md" aria-label="اسلاید بعدی">
    <svg class="w-4 h-4" fill="none" stroke="var(--text)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
  </button>
</section>

  <!-- محصولات -->
<section id="products" class="max-w-[95%] mx-auto mt-6 px-4">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 md:gap-5 mb-6">
<h1 class="onyx-title-simple">منتخب این ماه</h1>



    <div class="w-full md:w-auto flex flex-wrap gap-2 md:gap-4 items-center justify-start md:justify-end bg-white rounded-2xl p-2.5 sm:p-3 shadow border border-gray-100">
      <!-- دسته‌بندی -->
      <select id="filterCategory"
        class="onyx-filter-select px-3 py-2 rounded-full bg-gray-50 border border-gray-200 text-sm focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition w-full sm:w-auto min-w-[110px] font-semibold"
      >
        <option value="همه">همه دسته‌ها</option>
      </select>
      <!-- مرتب‌سازی -->
      <select id="sortProducts"
        class="onyx-filter-select px-3 py-2 rounded-full bg-gray-50 border border-gray-200 text-sm focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition w-full sm:w-auto min-w-[110px] font-semibold"
      >
        <option value="default">مرتب‌سازی</option>
        <option value="newest">جدیدترین</option>
        <option value="expensive">گران‌ترین</option>
        <option value="cheap">ارزان‌ترین</option>
        <option value="best">پرفروش</option>
      </select>
    </div>
  </div>
  <div class="product-grid" id="productGrid"></div>
  <div id="noProductsMsg" class="text-center text-gray-400 font-bold text-lg mt-6 hidden">محصولی پیدا نشد!</div>
</section>



  <!-- Popup Preview -->
  <div id="productPreview" class="product-preview" aria-modal="true" role="dialog">
    <button id="closePreview" class="absolute top-2 left-2" aria-label="بستن پیش‌نمایش">
      <svg class="w-5 h-5" fill="none" stroke="var(--text)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
    </button>
    <div class="flex flex-col sm:flex-row gap-4">
      <img id="previewImage" src="" alt="تصویر محصول" class="w-full sm:w-1/2 h-56 sm:h-64 object-cover rounded-lg"/>
      <div class="flex flex-col justify-between">
        <div>
          <h3 id="previewTitle" class="text-lg font-bold mb-2"></h3>
          <p id="previewCategory" class="text-sm text-[var(--primary)] mb-2"></p>
          <div class="flex gap-2 mb-3">
            <select class="p-1.5 rounded-lg border border-gray-300 text-sm" aria-label="انتخاب سایز">
              <option>سایز</option>
              <option>S</option>
              <option>M</option>
              <option>L</option>
            </select>
            <select class="p-1.5 rounded-lg border border-gray-300 text-sm" aria-label="انتخاب رنگ">
              <option>رنگ</option>
              <option>مشکی</option>
              <option>سفید</option>
              <option>آبی</option>
            </select>
          </div>
        </div>
        <div class="flex gap-2">
          <button class="onyx-btn">افزودن به سبد</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer -->
<footer class="footer bg-[#F7FAFE] text-[#232946] pt-8 pb-4 mt-10 border-t border-gray-200">
  <div class="max-w-[98%] mx-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-7 px-4">
    <!-- لوگو و معرفی ویترینت -->
    <div>
      <div class="font-extrabold text-[1.3rem] text-[var(--primary)] mb-3 tracking-tight select-none">ویترینت</div>
      <p class="text-xs leading-relaxed mb-2">
        <b>ویترینت</b> پلتفرم ساخت فروشگاه آنلاین و توسعه برند است؛ ساده، سریع و با پشتیبانی واقعی برای کسب‌وکارهای ایرانی.
      </p>
      <div class="mt-3 text-xs text-gray-600">
        <span>فروشگاه جاری:</span>
        <span class="font-extrabold text-[var(--primary)]" id="currentShopName">نئون استایل</span>
      </div>
    </div>
    <!-- دسترسی سریع -->
    <div>
      <div class="font-bold mb-3 text-[var(--primary)]">دسترسی سریع</div>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">درباره ویترینت</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">سوالات متداول</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">قوانین و مقررات</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">پشتیبانی و تماس</a>
    </div>
    <!-- دسته‌بندی‌ها -->
    <div>
      <div class="font-bold mb-3 text-[var(--primary)]">دسته‌بندی‌های برتر</div>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">پوشاک زنانه</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">پوشاک مردانه</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">کودک و نوجوان</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">اکسسوری</a>
    </div>
    <!-- اکشن‌ها -->
    <div class="flex flex-col gap-4 items-stretch">
      <a href="https://vitrinet.shop/register"
         class="footer-action-btn bg-gradient-to-l from-[#52b788] to-[var(--primary)] text-white font-extrabold text-sm flex items-center justify-center gap-2 py-3 px-4 rounded-xl shadow-md hover:scale-[1.04] hover:shadow-lg active:scale-[0.98] transition-all duration-200"
         style="color:#fff !important;">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
        </svg>
        <span>ثبت <span class="hidden xs:inline">رایگان</span> فروشگاه در ویترینت</span>
      </a>
      <a href="https://vitrinet.shop"
         class="footer-home-btn flex items-center justify-center gap-2 border border-[var(--primary)] text-[var(--primary)] font-bold text-sm py-3 px-4 rounded-xl bg-white hover:bg-[var(--primary)] hover:text-white hover:shadow-lg hover:scale-[1.03] active:scale-95 transition-all duration-200">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7m-9 2v6m4-6v6m5 2a2 2 0 01-2 2H7a2 2 0 01-2-2v-7a2 2 0 012-2h3"/>
        </svg>
        <span>بازگشت به صفحه اصلی ویترینت</span>
      </a>
    </div>
  </div>
  <div class="mt-7 border-t border-gray-200 pt-3 text-center text-xs text-gray-500">
    © ۱۴۰۴ ویترینت – تمامی حقوق برای پلتفرم ویترینت محفوظ است.
  </div>
  <style>
    .footer-action-btn svg, .footer-home-btn svg {
      vertical-align: middle;
      margin-left: .13em;
      margin-right: .13em;
      transition: color .18s;
    }
    .footer-action-btn:hover svg, .footer-home-btn:hover svg {
      color: #fff;
      stroke: #fff;
    }
    .footer-action-btn.bg-gradient-to-l,
    .footer-action-btn.bg-gradient-to-l:visited {
      color: #fff !important;
      text-shadow: 0 1px 8px #52b78826;
    }
    /* باگ هاور دکمه بازگشت: رنگ متن */
    .footer-home-btn:hover,
    .footer-home-btn:focus {
      color: #fff !important;
      border-color: var(--primary);
      background: linear-gradient(to left, #52b788, var(--primary));
    }
    .footer-home-btn {
      background: #fff;
      color: var(--primary);
      transition: all .17s cubic-bezier(.4,0,.2,1);
      border: 1.7px solid var(--primary);
      font-weight: 700;
    }
    .footer-home-btn span, .footer-home-btn svg {
      transition: color .16s;
    }
    .footer-home-btn:hover span,
    .footer-home-btn:focus span {
      color: #fff !important;
    }
    /* Responsive grid */
    @media (max-width: 900px) {
      .footer .grid {grid-template-columns:1fr 1fr;}
    }
    @media (max-width: 640px) {
      .footer .grid {grid-template-columns:1fr;}
      .footer .flex-col {gap:1.2rem;}
    }
    .footer .onyx-btn, .footer-action-btn, .footer-home-btn {
      font-family: inherit;
      box-shadow:0 1.5px 8px #7C83FD14;
    }
    @media (max-width: 410px) {
      .footer-action-btn, .footer-home-btn {font-size:.92rem;}
      .footer-action-btn span.hidden.xs\:inline {display:none;}
    }
    @media (max-width: 500px) {
      .footer p {font-size: .97em;}
      .footer .font-extrabold {font-size:1.05rem;}
    }
  </style>
</footer>







  <!-- Scroll to Top -->
  <button id="scrollTopBtn" class="scroll-top-btn hidden" aria-label="بازگشت به بالا">
    <svg class="w-4 h-4" fill="none" stroke="white" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
  </button>
<script>
// ===== گرفتن shopurl (هم از query ?shopurl=... هم از انتهای url) =====
function getShopSlug() {
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has('shopurl')) {
    return urlParams.get('shopurl');
  }
  // shops/mobforoshi یا shop.html/mobforoshi یا حتی shop.html?shopurl=mobforoshi
  let path = window.location.pathname.split('/').filter(Boolean);
  let last = path[path.length - 1] || '';
  if (last.endsWith('.html')) last = last.replace('.html', '');
  // اگر shops یا shop.html بود و آخرش اسلاگ نبود، خالی برگردون
  if (['shops', 'shop', 'shop.html'].includes(last)) return '';
  return last;
}

// ← این متغیر رو در بالای اسکریپت تعریف می‌کنیم
let currentSellerId = null;

const slug = getShopSlug();

// نمایش تعداد مشتریان در همه المان‌های مربوطه
function setCustomerCount(countValue = 0) {
  const safeCount = Number.isFinite(countValue) ? countValue : 0;
  document.querySelectorAll('[data-customer-count]').forEach((el) => {
    el.textContent = safeCount.toLocaleString();
  });
}

// ======== لود داده و داینامیک‌سازی کل اطلاعات فروشگاه ========
async function loadShopData() {
  if (!slug) return;
  try {
    const res = await fetch(`http://localhost:5000/api/shopAppearance/url/${slug}`);
    if (!res.ok) throw new Error('فروشگاه یافت نشد!');
    const data = await res.json();

    // ← وقتی اطلاعات فروشگاه لود شد، شناسه‌ش رو توی currentSellerId ذخیره می‌کنیم
    currentSellerId = data.sellerId;

    // لوگو و نام فروشگاه
    document.querySelectorAll('.logo-txt').forEach(el =>
      el.textContent = data.shopLogoText || data.shopName || 'نام فروشگاه'
    );
    document.getElementById('currentShopName').textContent =
      data.shopLogoText || data.shopName || 'نام فروشگاه';

    // وضعیت فروشگاه (باز/بسته)
    const shopStatusEl = document.getElementById('shop-status');
    if (shopStatusEl) {
      shopStatusEl.innerHTML =
        data.shopStatus === 'closed'
          ? '<span class="w-2 h-2 rounded-full bg-red-400 inline-block"></span> بسته است'
          : '<span class="w-2 h-2 rounded-full bg-green-400 inline-block"></span> باز است';
    }

    // آدرس و شماره تماس
    const addressContent = document.querySelector('#addressModal .text-gray-800');
    if (addressContent) {
      addressContent.innerHTML = `
        ${data.shopAddress || 'آدرس ثبت نشده'}
        <br>
        <span class="text-emerald-700 text-sm font-semibold mt-1 flex items-center justify-center gap-1">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M3 5h12M9 3v2m0 14a4 4 0 100-8 4 4 0 000 8zm7-4h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2z"/>
          </svg>
          شماره تماس: <b dir="ltr" class="font-bold mx-1">${data.shopPhone || '-'}</b>
        </span>
      `;
    }

    // امتیاز میانگین کاربران و تعداد کل امتیازها
    const avg = typeof data.averageRating === 'number'
      ? parseFloat(data.averageRating).toFixed(1)
      : '0.0';
    document.getElementById('shop-rating').textContent = avg;

    const ratingCount = typeof data.ratingCount === 'number'
      ? data.ratingCount
      : 0;
    document.getElementById('rating-count').textContent = ratingCount.toLocaleString();

    try {
      const favRes = await fetch(`${API_BASE}/api/favorite-shops/count/${currentSellerId}`);
      if (favRes.ok) {
        const { count: favCount = 0 } = await favRes.json();
        setCustomerCount(favCount);
      } else {
        setCustomerCount(0);
      }
    } catch {
      setCustomerCount(0);
    }

    // اسلایدر
    renderHeroSlider(data.slides || []);

    // داینامیک سازی متاتگ‌ها و سئو
    setDynamicSEO(data);

    // محصولات را جدا بگیر
    loadShopProducts(slug);

  } catch (e) {
    console.error(e);
    document.querySelectorAll('.logo-txt').forEach(el => el.textContent = 'نام فروشگاه');
    document.getElementById('currentShopName').textContent = 'نام فروشگاه';
    setDynamicSEO({
      shopName: 'نام فروشگاه',
      shopShortDesc: 'فروشگاه آنلاین',
      shopCity: '',
      shopTags: ''
    });
  }
}


// ======== گرفتن و رندر محصولات فروشگاه بر اساس shopurl ========
async function loadShopProducts(shopurl) {
  try {
    const res = await fetch(`http://localhost:5000/api/products/shop/${shopurl}`);
    const products = await res.json();
    renderProducts(products);
  } catch (err) {
    renderProducts([]);
  }
}

// ======== رندر محصولات فروشگاه ========
function renderProducts(products = []) {
  console.log("PRODUCTS:", products); // فقط برای دیباگ
  const grid = document.getElementById('productGrid');
  const noMsg = document.getElementById('noProductsMsg');
  if (!products.length) {
    if (grid) grid.innerHTML = "";
    if (noMsg) noMsg.classList.remove("hidden");
    return;
  }
  if (noMsg) noMsg.classList.add("hidden");
  grid.innerHTML = products.map((p, i) => {
    let badgeClass = 'product-chip';
    if (p.badgeType === "best") badgeClass += ' best';
    else if (p.badgeType === "new") badgeClass += ' new';
    else if (p.badgeType === "sale") badgeClass += ' sale';

    // ساپورت هم img و هم images
    let imageUrl = 'assets/images/shop-placeholder.svg';
    if (p.images && Array.isArray(p.images) && p.images.length > 0) {
      imageUrl = p.images[p.mainImageIndex ?? 0] || p.images[0];
    } else if (p.img) {
      imageUrl = p.img;
    }

    return `
      <article class="product-card" data-cat="${p.category}" data-idx="${i}">
        <div class="product-media">
          <img src="${imageUrl}" alt="${p.title}" loading="lazy" />
          <div class="product-badges">
            ${p.badge ? `<span class="${badgeClass}">${p.badge}</span>` : ''}
          </div>
        </div>
        <div class="product-body">
          <h3 class="product-title" title="${p.title}">${p.title}</h3>
          <div class="product-category">${p.category || 'دسته‌بندی نشده'}</div>
          <div class="product-meta">
            <div class="product-price">${p.price?.toLocaleString?.() || p.priceTxt || ''} <span class="price-note">تومان</span></div>
          </div>
        </div>
        <button class="onyx-btn details-btn" aria-label="مشاهده ${p.title}" data-idx="${i}">
          <span>مشاهده محصول</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14m-7-7l7 7-7 7" />
          </svg>
        </button>
      </article>
    `;
  }).join('');
  document.querySelectorAll('.details-btn').forEach((btn, idx) => {
    btn.onclick = function () {
  window.location.href = `product.html?id=${products[idx]._id}`;
};

  });
}


// ======== رندر اسلایدر داینامیک ========
function renderHeroSlider(slidesArr = []) {
  const heroSlider = document.getElementById('heroSliderSection');
  if (!heroSlider) return;
  heroSlider.querySelectorAll('.slide').forEach(el => el.remove());
  if (!slidesArr.length) {
    heroSlider.insertAdjacentHTML('afterbegin', `
      <div class="slide active">
        <img src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1400&q=80&format=webp" alt="اسلاید پیش‌فرض" loading="lazy"/>
        <div class="slide-caption">
          <h2 class="slide-title">اسلاید نمونه</h2>
        </div>
      </div>
    `);
    return;
  }
  slidesArr.forEach((slide, i) => {
    heroSlider.insertAdjacentHTML('beforeend', `
      <div class="slide${i === 0 ? ' active' : ''}">
        <img src="${slide.img || ''}" alt="${slide.title || 'اسلاید'}" loading="lazy"/>
        <div class="slide-caption">
          <h2 class="slide-title">${slide.title || ''}</h2>
          <p class="slide-desc">${slide.desc || ''}</p>
        </div>
      </div>
    `);
  });
  let slides = Array.from(heroSlider.querySelectorAll('.slide'));
  let current = 0;
  const dots = document.getElementById('sliderDots');
  if (dots) {
    dots.innerHTML = '';
    slides.forEach((_, idx) => {
      const dot = document.createElement('span');
      dot.className = `slider-dot${idx === 0 ? ' active' : ''}`;
      dot.onclick = () => gotoSlide(idx);
      dots.appendChild(dot);
    });
  }
  function gotoSlide(idx) {
    slides.forEach((el, j) => el.classList.toggle('active', j === idx));
    if (dots) {
      dots.querySelectorAll('.slider-dot').forEach((el, j) => el.classList.toggle('active', j === idx));
    }
    current = idx;
  }
  document.getElementById('prevSlide').onclick = () => gotoSlide((current - 1 + slides.length) % slides.length);
  document.getElementById('nextSlide').onclick = () => gotoSlide((current + 1) % slides.length);
  setInterval(() => gotoSlide((current + 1) % slides.length), 6000);
}


// ========== اجرا بعد از لود صفحه ==========
document.addEventListener('DOMContentLoaded', function () {
  loadShopData();
  const shopHeader = document.getElementById('shopHeader');
  const headerMenuToggle = document.getElementById('headerMenuToggle');

  const closeHeaderMenu = () => {
    if (!shopHeader || !headerMenuToggle) return;
    shopHeader.classList.remove('menu-open');
    headerMenuToggle.setAttribute('aria-expanded', 'false');
  };

  if (shopHeader && headerMenuToggle) {
    const headerActions = document.getElementById('headerActions');

    headerMenuToggle.addEventListener('click', () => {
      const isOpen = shopHeader.classList.toggle('menu-open');
      headerMenuToggle.setAttribute('aria-expanded', String(isOpen));
    });

    if (headerActions) {
      headerActions.querySelectorAll('.action-item').forEach((actionButton) => {
        actionButton.addEventListener('click', () => {
          if (window.innerWidth < 768) {
            requestAnimationFrame(() => closeHeaderMenu());
          }
        });
      });
    }

    document.addEventListener('click', (event) => {
      if (!shopHeader.contains(event.target)) {
        closeHeaderMenu();
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        closeHeaderMenu();
      }
    });

    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768) {
        closeHeaderMenu();
      }
    });
  }

  const scrollTopBtn = document.getElementById('scrollTopBtn');
  window.onscroll = () => {
    if (scrollTopBtn) scrollTopBtn.classList.toggle('hidden', window.scrollY < 300);
  }
  if (scrollTopBtn)
    scrollTopBtn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
});





// کنترل باز و بسته شدن مودال آدرس فروشگاه
document.addEventListener('DOMContentLoaded', function () {
  const addressBtn = document.getElementById('addressBtn');
  const addressBtnMobile = document.getElementById('addressBtnMobile');
  const addressModal = document.getElementById('addressModal');
  const closeAddressModal = document.getElementById('closeAddressModal');

  const openAddressModal = function() {
    addressModal.classList.remove('hidden');
  };

  if (addressBtn && addressModal) {
    addressBtn.onclick = openAddressModal;
  }
  if (addressBtnMobile && addressModal) {
    addressBtnMobile.onclick = openAddressModal;
  }
  if (closeAddressModal && addressModal) {
    closeAddressModal.onclick = function() {
      addressModal.classList.add('hidden');
    }
  }
  if (addressModal) {
    addressModal.addEventListener('click', function(e) {
      if (e.target === addressModal) {
        addressModal.classList.add('hidden');
      }
    });
  }
});








document.addEventListener('DOMContentLoaded', () => {

/* ───────────────── ثابت‌ها و ابزار‌ها ──────────────── */
const API_BASE     = 'http://localhost:5000';     // آدرس بک‌اند
const AUTH_CHECK   = `${API_BASE}/api/auth/getCurrentUser`;
const REPORT_URL   = `${API_BASE}/api/reports`;

/* ‌────────── المان‌های صفحه ────────── */
/* 1) مودال آدرس */
const addressBtn        = document.getElementById('addressBtn');
const addressModal      = document.getElementById('addressModal');
const closeAddressModal = document.getElementById('closeAddressModal');

/* 2) گزارش تخلف */
const $btn   = document.getElementById('reportBtn');
const $modal = document.getElementById('reportModal');
const $close = document.getElementById('closeReportModal');

const $type  = document.getElementById('reportType');
const $txt   = document.getElementById('reportText');
const $send  = document.getElementById('submitReport');
const $msg   = document.getElementById('reportMsg');

/* ───────────── کمک‌خرج‌ها ───────────── */

/* ───────────── کمک‌خرج‌ها ───────────── */
const showMsg = (text = '', ok = true) => {
  $msg.textContent = text;
  $msg.className   = ok ? 'text-green-500 font-bold mt-1'
                        : 'text-red-500  font-bold mt-1';
};

const isLoggedIn = async () => {
  try {
    const res = await fetch(AUTH_CHECK, { credentials: 'include' });
    return res.ok;                  // کوکی معتبر → ۲۰۰
  } catch {
    return false;
  }
};


/* ───────────── مودال آدرس ───────────── */
addressBtn?.addEventListener('click', () => addressModal?.classList.remove('hidden'));
closeAddressModal?.addEventListener('click', () => addressModal?.classList.add('hidden'));
addressModal?.addEventListener('click', e => (e.target === addressModal) && addressModal.classList.add('hidden'));

/* ───────────── مودال گزارش ───────────── */
  // ───────────── گزارش تخلف ─────────────
  const resetForm = () => {
    showMsg('');
    $type.value = 'price_mismatch';
    $txt.value  = '';
  };

  const openModal  = () => { resetForm(); $modal.classList.remove('hidden'); };
  const closeModal = () =>   $modal.classList.add('hidden');

  $btn  ?.addEventListener('click', openModal);
  $close?.addEventListener('click', closeModal);
  $modal?.addEventListener('click', e => (e.target === $modal) && closeModal());

  /* ───────────── ارسال گزارش ───────────── */
  $send?.addEventListener('click', async () => {

    const description = $txt.value.trim();
    const type        = $type.value;

    if (description.length < 5)
      return showMsg('توضیح حداقل ۵ کاراکتر باشد.', false);

    if (!(await isLoggedIn()))
      return askForLogin({ type, description });

    $send.disabled    = true;
    $send.textContent = 'در حال ارسال…';

    try {
      const res = await fetch(REPORT_URL, {
        method      : 'POST',
        credentials : 'include',
        headers     : { 'Content-Type': 'application/json' },
        body        : JSON.stringify({ type, description, sellerId: currentSellerId, shopurl: slug })
      });

      if (res.status === 401) return askForLogin({ type, description });
      if (res.status === 429) return showMsg('لطفاً یک دقیقه بعد دوباره تلاش کنید.', false);
      if (!res.ok)            return showMsg('خطا! دوباره امتحان کنید.', false);

      showMsg('✅ گزارش با موفقیت ثبت شد');
      setTimeout(closeModal, 2000);

    } catch (err) {
      console.error(err);
      showMsg('خطای شبکه؛ بعداً تلاش کنید.', false);
    } finally {
      $send.disabled    = false;
      $send.textContent = 'ارسال گزارش';
    }
  });

  /* ───── پرسش برای ورود ───── */
  function askForLogin(draft) {
    $send.disabled    = false;
    $send.textContent = 'ارسال گزارش';

    if (confirm('برای ارسال گزارش باید وارد شوید. مایلید به صفحهٔ ورود بروید؟')) {
      SafeSS.setJSON('afterLoginReturn', location.href); // SafeSS
      SafeSS.setJSON('reportDraft', draft); // SafeSS
      location.href = '/login.html';
    } else {
      showMsg('ابتدا وارد حساب شوید سپس دوباره گزارش دهید.', false);
    }
  }

  /* ───── بازیابی پیش‌نویس پس از ورود ───── */
  (async () => {
    const draft = SafeSS.getJSON('reportDraft'); // SafeSS
    if (!draft) return; // SafeSS
    if (!(await isLoggedIn())) return;  // هنوز وارد نشده

    const { type, description } = draft; // SafeSS
    sessionStorage.removeItem('reportDraft');

    $type.value = type;
    $txt.value  = description;
    $modal.classList.remove('hidden');
  })();

  // ───────────── امتیازدهی ─────────────
  const rateShow       = document.getElementById('rateShow');
  const rateModal      = document.getElementById('rateModal');
  const closeRateModal = document.getElementById('closeRateModal');
  const rateStars      = document.getElementById('rateStars');
  const submitRateBtn  = document.getElementById('submitRate');
  const rateMsg        = document.getElementById('rateMsg');
  let   selectedRating = 0;

  function renderStars(rating = 0) {
    rateStars.innerHTML = '';
    for (let i = 1; i <= 5; i++) {
      const star = document.createElement('span');
      star.className    = `rate-star ${i <= rating ? 'active' : 'inactive'}`;
      star.textContent  = '★';
      star.dataset.value = i;
      star.addEventListener('click', () => {
        selectedRating = i;
        renderStars(i);
      });
      rateStars.appendChild(star);
    }
  }

  rateShow.addEventListener('click', async () => {
    if (!(await isLoggedIn())) {
      if (confirm('برای ثبت امتیاز باید وارد شوید. به صفحهٔ ورود بروید؟')) {
        SafeSS.setJSON('afterLoginReturn', location.href); // SafeSS
        location.href = '/login.html';
      }
      return;
    }
    selectedRating = 0;
    renderStars(0);
    rateMsg.classList.add('hidden');
    rateModal.classList.remove('hidden');
  });

  closeRateModal.addEventListener('click', () => rateModal.classList.add('hidden'));
  rateModal.addEventListener('click', e => {
    if (e.target === rateModal) closeRateModal.click();
  });

  submitRateBtn.addEventListener('click', async () => {
    if (selectedRating < 1) {
      rateMsg.textContent = 'لطفاً یک امتیاز انتخاب کنید.';
      rateMsg.className   = 'text-red-500 font-bold mt-1';
      rateMsg.classList.remove('hidden');
      return;
    }
    submitRateBtn.disabled = true;
    try {
      const res = await fetch(`${API_BASE}/api/shopAppearance/${currentSellerId}/rate`, {
        method      : 'POST',
        credentials : 'include',
        headers     : { 'Content-Type': 'application/json' },
        body        : JSON.stringify({ rating: selectedRating })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'خطا در ثبت امتیاز');

      document.getElementById('shop-rating').textContent = parseFloat(data.averageRating).toFixed(1);
      if (typeof data.ratingCount === 'number') {
        document.getElementById('rating-count').textContent = data.ratingCount.toLocaleString();
      }
      rateMsg.textContent = '✅ امتیاز با موفقیت ثبت شد.';
      rateMsg.className   = 'text-green-500 font-bold mt-1';
      rateModal.classList.add('hidden');
    } catch (err) {
      rateMsg.textContent = err.message;
      rateMsg.className   = 'text-red-500 font-bold mt-1';
      rateMsg.classList.remove('hidden');
    } finally {
      submitRateBtn.disabled = false;
    }
  });

  // ───────────── مغازه محبوب ─────────────
  const favShopBtn       = document.getElementById('favShopBtn');
  const customerBadge    = document.getElementById('customerBadge');
  const favShopModal     = document.getElementById('favShopModal');
  const closeFavShop     = document.getElementById('closeFavShopModal');
  const favShopCountEl   = document.getElementById('favShopCount');
  const toggleFavShopBtn = document.getElementById('toggleFavShopBtn');

  async function refreshFavShopInfo() {
    if (!toggleFavShopBtn) return;

    try {
      const res = await fetch(`${API_BASE}/api/favorite-shops/count/${currentSellerId}`);
      const { count = 0 } = await res.json();
      favShopCountEl.textContent = count;
      setCustomerCount(count);
    } catch {
      favShopCountEl.textContent = 0;
      setCustomerCount(0);
    }

    const loggedIn = await isLoggedIn();
    toggleFavShopBtn.dataset.auth = loggedIn ? 'true' : 'false';

    if (!loggedIn) {
      toggleFavShopBtn.dataset.added = 'false';
      toggleFavShopBtn.textContent = 'ورود برای افزودن به محبوب‌ها';
      return;
    }

    let added = false;
    try {
      const res2 = await fetch(`${API_BASE}/api/favorite-shops`, { credentials: 'include' });
      if (res2.ok) {
        const shops = await res2.json();
        added = shops.some(s => s._id === currentSellerId);
      }
    } catch {}

    toggleFavShopBtn.dataset.added = added ? 'true' : 'false';
    toggleFavShopBtn.textContent = added ? 'افزوده شد' : 'افزودن به محبوب‌ها';
  }

  async function ensureFavoriteLogin({ silent = false } = {}) {
    if (await isLoggedIn()) return true;

    if (silent) return false;

    const goLogin = confirm('برای افزودن مغازه به محبوب‌ها باید وارد شوید. آیا مایل به ورود هستید؟');
    if (goLogin) {
      if (window.SafeSS && typeof window.SafeSS.setJSON === 'function') {
        window.SafeSS.setJSON('afterLoginReturn', location.href);
      }
      location.href = '/login.html';
    } else {
      alert('ابتدا وارد حساب کاربری خود شوید.');
    }
    return false;
  }

  const openCustomerModal = async () => {
    await refreshFavShopInfo();
    favShopModal.classList.remove('hidden');
  };

  favShopBtn?.addEventListener('click', openCustomerModal);
  customerBadge?.addEventListener('click', openCustomerModal);

  closeFavShop?.addEventListener('click', () => favShopModal.classList.add('hidden'));
  favShopModal?.addEventListener('click', e => (e.target === favShopModal) && favShopModal.classList.add('hidden'));

  toggleFavShopBtn?.addEventListener('click', async () => {
    if (!(await ensureFavoriteLogin())) return;

    const added = toggleFavShopBtn.dataset.added === 'true';
    toggleFavShopBtn.disabled = true;
    toggleFavShopBtn.textContent = 'در حال بروزرسانی…';
    try {
      const res = await fetch(`${API_BASE}/api/favorite-shops/${currentSellerId}`, {
        method: added ? 'DELETE' : 'POST',
        credentials: 'include'
      });
      if (res.status === 401) {
        toggleFavShopBtn.dataset.auth = 'false';
        toggleFavShopBtn.textContent = 'ورود برای افزودن به محبوب‌ها';
        await ensureFavoriteLogin();
        return;
      }
      if (!res.ok) throw new Error('خطا در به‌روزرسانی محبوب‌ها');
      await refreshFavShopInfo();
    } catch (err) {
      console.error(err);
      toggleFavShopBtn.textContent = 'خطا! دوباره تلاش کنید';
      setTimeout(() => refreshFavShopInfo(), 1500);
      return;
    } finally {
      toggleFavShopBtn.disabled = false;
    }
  });

}); // پایان DOMContentLoaded












let allProducts = []; // همه محصولات اینجا ذخیره میشه

function populateCategoryOptions(products = []) {
  const catSel = document.getElementById('filterCategory');
  if (!catSel) return;

  const previousValue = catSel.value || 'همه';
  const categories = [];

  products.forEach(item => {
    const category = (item && typeof item.category === 'string') ? item.category.trim() : '';
    if (category && !categories.includes(category)) {
      categories.push(category);
    }
  });

  catSel.innerHTML = '';

  const defaultOption = document.createElement('option');
  defaultOption.value = 'همه';
  defaultOption.textContent = 'همه دسته‌ها';
  catSel.appendChild(defaultOption);

  categories.forEach(category => {
    const option = document.createElement('option');
    option.value = category;
    option.textContent = category;
    catSel.appendChild(option);
  });

  catSel.value = categories.includes(previousValue) ? previousValue : 'همه';
}

// ===== گرفتن و رندر محصولات فروشگاه بر اساس shopurl =====
async function loadShopProducts(shopurl) {
  try {
    const res = await fetch(`http://localhost:5000/api/products/shop/${shopurl}`);
    const products = await res.json();
    allProducts = Array.isArray(products) ? products : [];
    populateCategoryOptions(allProducts);
    applyFiltersAndRender();
  } catch (err) {
    allProducts = [];
    populateCategoryOptions(allProducts);
    applyFiltersAndRender();
  }
}

// ===== فیلتر و مرتب‌سازی =====
function applyFiltersAndRender() {
  let filtered = [...allProducts];
  
  // دسته‌بندی
  const cat = document.getElementById('filterCategory')?.value || "همه";
  if (cat && cat !== "همه") {
    filtered = filtered.filter(p => (p.category && p.category.trim() === cat));
  }
  
  // مرتب‌سازی
  const sort = document.getElementById('sortProducts')?.value || "default";
  if (sort === "newest") {
    filtered.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
  } else if (sort === "expensive") {
    filtered.sort((a, b) => (b.price || 0) - (a.price || 0));
  } else if (sort === "cheap") {
    filtered.sort((a, b) => (a.price || 0) - (b.price || 0));
  } else if (sort === "best") {
    // برای پرفروش اگه فیلد مثلا "sold" یا "orders" داری استفاده کن وگرنه badgeType === 'best'
    filtered.sort((a, b) => ((b.sold || 0) - (a.sold || 0)));
  }
  
  renderProducts(filtered);
}

// ===== ایوند لیسنرهای فیلتر و مرتب‌سازی =====
document.addEventListener('DOMContentLoaded', function () {
  const catSel = document.getElementById('filterCategory');
  const sortSel = document.getElementById('sortProducts');
  if (catSel) catSel.addEventListener('change', applyFiltersAndRender);
  if (sortSel) sortSel.addEventListener('change', applyFiltersAndRender);
});






// ---- داینامیک کردن title و meta تگ‌های سئو ----

function setDynamicSEO(shop) {
  // title
  document.title = `${shop.shopName || 'فروشگاه'} | ${shop.shopShortDesc || ''}`;

  // description
  let desc = document.querySelector('meta[name="description"]');
  if (!desc) {
    desc = document.createElement('meta');
    desc.setAttribute('name', 'description');
    document.head.appendChild(desc);
  }
  desc.setAttribute('content', shop.shopShortDesc || 'خرید آنلاین از فروشگاه');

  // keywords
  let keywords = document.querySelector('meta[name="keywords"]');
  if (!keywords) {
    keywords = document.createElement('meta');
    keywords.setAttribute('name', 'keywords');
    document.head.appendChild(keywords);
  }
  keywords.setAttribute('content', `${shop.shopName || ''}, ${shop.shopCity || ''}, ${shop.shopTags || ''}, فروشگاه`);

  // author
  let author = document.querySelector('meta[name="author"]');
  if (!author) {
    author = document.createElement('meta');
    author.setAttribute('name', 'author');
    document.head.appendChild(author);
  }
  author.setAttribute('content', shop.shopName || '');

  // og:title
  let ogTitle = document.querySelector('meta[property="og:title"]');
  if (!ogTitle) {
    ogTitle = document.createElement('meta');
    ogTitle.setAttribute('property', 'og:title');
    document.head.appendChild(ogTitle);
  }
  ogTitle.setAttribute('content', `${shop.shopName || ''} | ${shop.shopShortDesc || ''}`);

  // og:description
  let ogDesc = document.querySelector('meta[property="og:description"]');
  if (!ogDesc) {
    ogDesc = document.createElement('meta');
    ogDesc.setAttribute('property', 'og:description');
    document.head.appendChild(ogDesc);
  }
  ogDesc.setAttribute('content', shop.shopShortDesc || '');

  // og:url
  let ogUrl = document.querySelector('meta[property="og:url"]');
  if (!ogUrl) {
    ogUrl = document.createElement('meta');
    ogUrl.setAttribute('property', 'og:url');
    document.head.appendChild(ogUrl);
  }
  ogUrl.setAttribute('content', window.location.href);

  // og:image (اگه داری)
  if (shop.shopImage) {
    let ogImg = document.querySelector('meta[property="og:image"]');
    if (!ogImg) {
      ogImg = document.createElement('meta');
      ogImg.setAttribute('property', 'og:image');
      document.head.appendChild(ogImg);
    }
    ogImg.setAttribute('content', shop.shopImage);
  }
}



</script>



<!-- TODO: افزودن رویدادهای PostHog پس از فعال‌سازی | TODO: Enable PostHog events after activation -->
<!--
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const safeCapture = window.safePosthogCapture || function () {};
    // شناسایی فروشگاه بازدید شده | Identify visited shop
    // const shopId = document.body.getAttribute('data-shop-id') || 'SHOP_ID';
    // safeCapture('shop_visited', { shop_id: shopId });
    // می‌توانید افزودن به سبد را نیز در صفحه فروشگاه رهگیری کنید | Track add to cart from shop page if needed
  });
</script>
-->

</body>
</html>
