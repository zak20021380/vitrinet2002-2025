<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ONYX MODERN | فروشگاه آنلاین پوشاک شیک و مدرن</title>
  <meta name="description" content="خرید آنلاین پوشاک و اکسسوری مینیمال و مدرن با بهترین قیمت و جدیدترین ترندهای بازار">
  <meta name="keywords" content="خرید لباس, پوشاک زنانه, پوشاک مردانه, اکسسوری, لباس ارزان, ترند, مد, فروشگاه پوشاک, فروشگاه مدرن">
  <meta name="robots" content="index, follow">
  <meta name="author" content="ONYX MODERN">
  <meta property="og:title" content="ONYX MODERN | فروشگاه آنلاین پوشاک مدرن">
  <meta property="og:description" content="فروشگاه اینترنتی پوشاک و اکسسوری مدرن با فیلتر قیمت و جدیدترین محصولات. تجربه خریدی ساده و مطمئن.">
  <meta property="og:image" content="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1200&q=80">
  <meta property="og:url" content="https://onyxmodern.com">
  <meta property="og:type" content="website">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
  --primary: #7C83FD;
  --secondary: #FFB677;
  --background: #F7FAFE;
  --text: #232946;
  --success: #52b788;
  --danger: #ee6c4d;
}
body {
  font-family: 'Vazirmatn', sans-serif;
  background: var(--background);
  color: var(--text);
  min-height: 100vh;
  margin: 0;
  overflow-x: hidden;
  transition: background 0.3s, color 0.3s;
}

.shop-header {
  position: sticky;
  top: 0;
  z-index: 60;
  padding: clamp(0.65rem, 1.8vw, 1.1rem) clamp(0.9rem, 4vw, 2.4rem);
  background: linear-gradient(120deg, rgba(124,131,253,0.18), rgba(56,189,248,0.14), rgba(255,255,255,0.94));
  backdrop-filter: blur(18px);
  border-bottom: 1px solid rgba(124,131,253,0.08);
  box-shadow: 0 18px 40px rgba(17, 24, 39, 0.08);
}

.shop-header__container {
  width: min(1120px, 100%);
  margin: 0 auto;
  background: rgba(255,255,255,0.95);
  border-radius: 1.75rem;
  border: 1px solid rgba(124,131,253,0.12);
  padding: clamp(1rem, 2vw, 1.7rem) clamp(1.1rem, 2.3vw, 2rem);
  display: flex;
  flex-direction: column;
  gap: 1.1rem;
  position: relative;
  overflow: hidden;
  box-shadow: 0 22px 55px rgba(15, 23, 42, 0.12);
}

.shop-header__container::before {
  content: "";
  position: absolute;
  inset: -90% 35% 55% -25%;
  background: radial-gradient(circle at top, rgba(124,131,253,0.16), transparent 65%);
  pointer-events: none;
}

.shop-header__container > * {
  position: relative;
  z-index: 1;
}

.shop-header__brand {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 1.5rem;
  flex-wrap: wrap;
}

.shop-brand-card {
  display: flex;
  flex-direction: column;
  gap: 0.4rem;
}

.shop-logo {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: clamp(2rem, 5vw, 2.8rem);
  font-weight: 900;
  background: linear-gradient(135deg, #ec4899, #8b5cf6, #3b82f6);
  -webkit-background-clip: text;
  color: transparent;
  letter-spacing: -1.6px;
  text-shadow: 0 12px 32px rgba(124,131,253,0.18);
}

.shop-tagline {
  margin: 0;
  font-weight: 600;
  font-size: clamp(0.9rem, 2vw, 1.05rem);
  color: #4c577a;
}

.shop-badges {
  display: flex;
  align-items: center;
  gap: 0.85rem;
  flex-wrap: wrap;
}

.shop-status {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 0.55rem;
  padding: 0.5rem 1.2rem 0.5rem 0.9rem;
  border-radius: 999px;
  font-weight: 800;
  font-size: 0.88rem;
  background: linear-gradient(135deg, rgba(134,239,172,0.24), rgba(16,185,129,0.2));
  color: #047857;
  border: 1px solid rgba(16,185,129,0.28);
  box-shadow: 0 16px 30px rgba(16,185,129,0.18);
  padding-right: 1.6rem;
}

.shop-status::before {
  content: "";
  position: absolute;
  right: 0.75rem;
  width: 0.55rem;
  height: 0.55rem;
  border-radius: 50%;
  background: #34d399;
  box-shadow: 0 0 0 6px rgba(74,222,128,0.2);
}

.shop-status.is-closed {
  background: linear-gradient(135deg, rgba(248,113,113,0.24), rgba(239,68,68,0.24));
  color: #b91c1c;
  border-color: rgba(239,68,68,0.32);
  box-shadow: 0 16px 30px rgba(248,113,113,0.2);
}

.shop-status.is-closed::before {
  background: #f87171;
  box-shadow: 0 0 0 6px rgba(248,113,113,0.24);
}

.shop-rating {
  display: inline-flex;
  align-items: center;
  gap: 0.85rem;
  padding: 0.55rem 1.2rem;
  border-radius: 999px;
  border: 1px dashed rgba(250,204,21,0.55);
  background: linear-gradient(135deg, #fff7e5, #fff1c1);
  color: #a16207;
  font-weight: 800;
  font-size: 0.9rem;
  box-shadow: 0 18px 32px rgba(250,204,21,0.2);
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
}

.shop-rating:hover {
  transform: translateY(-2px);
  background: linear-gradient(135deg, #fff4d0, #ffe7a6);
  box-shadow: 0 20px 36px rgba(245,158,11,0.28);
}

.shop-rating:focus-visible {
  outline: 3px solid rgba(124,131,253,0.35);
  outline-offset: 3px;
}

.shop-rating svg {
  width: 20px;
  height: 20px;
  fill: #facc15;
}

.shop-rating__score {
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
}

.shop-rating__score strong {
  font-size: 1.2rem;
}

.shop-rating__divider {
  width: 1px;
  height: 24px;
  background: linear-gradient(to bottom, transparent, rgba(250,204,21,0.6), transparent);
}

.shop-rating__visits {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  color: #b45309;
}

.shop-rating__visits i {
  color: #d97706;
}

.shop-header__info {
  display: flex;
  align-items: center;
  gap: 1.2rem;
  flex-wrap: wrap;
  padding: 0.75rem 1rem;
  border-radius: 1.3rem;
  background: linear-gradient(120deg, rgba(124,131,253,0.12), rgba(45,212,191,0.12));
  border: 1px solid rgba(124,131,253,0.12);
}

.shop-info-item {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 600;
  font-size: 0.92rem;
  color: #384161;
  white-space: normal;
}

.shop-info-item i {
  color: var(--primary);
  font-size: 1rem;
}

.shop-header__actions {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  flex-wrap: wrap;
  gap: 0.75rem;
}

.shop-header__pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.65rem 1.25rem;
  border-radius: 999px;
  border: 1px solid rgba(124,131,253,0.15);
  background: #f5f6ff;
  color: #1f2a60;
  font-weight: 800;
  font-size: 0.92rem;
  text-decoration: none;
  box-shadow: 0 16px 32px rgba(124,131,253,0.18);
  transition: transform 0.22s ease, box-shadow 0.22s ease, background 0.22s ease, color 0.22s ease;
  cursor: pointer;
}

.shop-header__pill i {
  font-size: 1rem;
}

.shop-header__pill:hover,
.shop-header__pill:focus-visible {
  transform: translateY(-3px);
  background: #eef2ff;
  color: #1e3a8a;
  box-shadow: 0 22px 42px rgba(59,130,246,0.18);
}

.shop-header__pill--primary {
  background: linear-gradient(135deg, #22d3ee, #3b82f6);
  color: #fff;
  border-color: transparent;
  box-shadow: 0 20px 40px rgba(56,189,248,0.4);
}

.shop-header__pill--primary:hover,
.shop-header__pill--primary:focus-visible {
  background: linear-gradient(135deg, #0ea5e9, #2563eb);
  box-shadow: 0 24px 48px rgba(37,99,235,0.45);
}

.shop-header__pill--alert {
  background: #fff5f2;
  color: #b91c1c;
  border-color: rgba(248,113,113,0.45);
  box-shadow: 0 18px 34px rgba(248,113,113,0.22);
}

.shop-header__pill--alert:hover,
.shop-header__pill--alert:focus-visible {
  background: #fee2e2;
  color: #991b1b;
}

.shop-header__pill--home {
  background: #eef2ff;
  color: #1d4ed8;
  border-color: rgba(59,130,246,0.35);
}

.shop-header__pill--home:hover,
.shop-header__pill--home:focus-visible {
  background: #e0e7ff;
  color: #1e3a8a;
}

@media (max-width: 992px) {
  .shop-header__container {
    border-radius: 1.6rem;
    padding: 1rem 1.4rem;
  }
  .shop-header__actions {
    justify-content: flex-start;
  }
}

@media (max-width: 768px) {
  .shop-header {
    padding: 0.6rem clamp(0.7rem, 6vw, 1.3rem);
  }
  .shop-header__brand {
    flex-direction: column;
    align-items: flex-start;
    gap: 1rem;
  }
  .shop-badges {
    width: 100%;
    justify-content: flex-start;
  }
  .shop-header__info {
    border-radius: 1.1rem;
  }
}

@media (max-width: 640px) {
  .shop-header__container {
    border-radius: 1.4rem;
    padding: 1rem;
    gap: 1.2rem;
  }
  .shop-header__info {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.7rem;
    padding: 0.85rem 1rem;
  }
  .shop-info-item {
    font-size: 0.86rem;
  }
  .shop-header__actions {
    width: 100%;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 0.75rem;
  }
  .shop-header__pill {
    width: 100%;
    padding: 0.7rem 1rem;
    font-size: 0.84rem;
  }
  .shop-header__pill--home {
    grid-column: span 2;
  }
  .shop-rating {
    width: 100%;
    justify-content: space-between;
  }
}

@media (max-width: 460px) {
  .shop-logo {
    font-size: clamp(1.9rem, 8vw, 2.3rem);
  }
  .shop-tagline {
    font-size: 0.88rem;
  }
  .shop-rating {
    font-size: 0.82rem;
    padding: 0.55rem 1rem;
  }
}

@keyframes fade-in-down {
  from { opacity: 0; transform: translateY(-24px); }
  to { opacity: 1; transform: translateY(0); }
}

.animate-fade-in-down {
  animation: fade-in-down 0.32s cubic-bezier(.3, 1, .51, .98);
}

.rate-star {
  cursor: pointer;
  transition: transform 0.1s ease, color 0.1s ease;
}

.rate-star.active {
  color: #fbbf24;
  transform: scale(1.15);
}

.rate-star.inactive {
  color: #d1d5db;
}

.hero-slider {
  border-radius: 1rem;
  background: #fff;
  overflow: hidden;
  scroll-behavior: smooth;
  white-space: nowrap;
  box-shadow: 0 4px 24px #7C83FD15;
  position: relative;
  min-height: 440px;
  width: 100%;
  margin: 0 auto;
  cursor: auto;
}

/* هر اسلاید روی هم، فقط یکی فعاله */
.slide {
  position: absolute;
  inset: 0;
  opacity: 0;
  z-index: 0;
  transition: opacity 0.8s cubic-bezier(.45,1,.45,1);
  pointer-events: none;
  height: 100%;
}
.slide.active {
  opacity: 1;
  z-index: 1;
  pointer-events: auto;
}
.slide img { 
  width: 100%; 
  height: 100%; 
  object-fit: cover;
  image-rendering: auto;
  filter: none;
  border-radius: inherit;
}
.slide-caption {
  position: absolute; 
  bottom: 0; 
  right: 0; 
  left: 0;
  padding: 1.1rem 1.5rem;
  background: linear-gradient(to top, #364f6bcc 50%, transparent 100%);
  color: #fff; 
  text-align: right;
  border-radius: 0 0 1rem 1rem;
}
.slide-title { 
  font-size: 1.4rem; 
  font-weight: 900; 
  margin-bottom: .5rem;
}
.slide-desc { 
  font-size: 1rem; 
  font-weight: 500; 
  margin-bottom: 1rem;
}

/* دکمه فلش‌های چپ و راست - کوچک و شیک */
#prevSlide,
#nextSlide {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: #fff;
  border: none;
  outline: none;
  box-shadow: 0 1.5px 4px #7C83FD10;
  padding: 0.15rem 0.18rem;
  border-radius: 50%;
  cursor: pointer;
  z-index: 10;
  transition: background 0.13s, box-shadow 0.14s;
  width: 27px;
  height: 27px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.86;
}
#prevSlide { right: 7px; left: auto; }
#nextSlide { left: 7px; right: auto; }
#prevSlide:hover, #nextSlide:hover {
  background: var(--primary);
  opacity: 1;
  box-shadow: 0 3px 14px #7C83FD2a;
}
#prevSlide svg, #nextSlide svg {
  stroke: var(--primary);
  transition: stroke .18s;
  width: 13px;
  height: 13px;
  display: block;
}
#prevSlide:hover svg, #nextSlide:hover svg {
  stroke: #fff;
}

/* نقاط اسلایدر (dot) */
#sliderDots {
  position: absolute;
  bottom: 15px;
  right: 0;
  left: 0;
  margin: 0 auto;
  display: flex;
  justify-content: center;
  gap: 7px;
  z-index: 5;
}
.slider-dot {
  width: 9px;
  height: 9px;
  border-radius: 50%;
  background: #A3BFFA;
  opacity: .4;
  cursor: pointer;
  transition: background .19s, opacity .19s, transform .17s;
}
.slider-dot.active {
  opacity: 1;
  background: var(--primary);
  transform: scale(1.15);
}

/* رسپانسیو */
@media (max-width: 1024px) {
  .hero-slider { min-height: 320px; }
  .slide-caption { font-size: .97rem; padding: .8rem 1.2rem; }
  #prevSlide, #nextSlide { top: 46%; }
}
@media (max-width: 600px) {
  .hero-slider { min-height: 170px; border-radius: .7rem; }
  .slide-caption { font-size: .87rem; padding: .4rem .5rem; }
  #prevSlide, #nextSlide { 
    width: 19px;
    height: 19px;
    padding: 0;
  }
  #prevSlide { right: 3px; left: auto; }
  #nextSlide { left: 3px; right: auto; }
  #prevSlide svg, #nextSlide svg { width: 9px; height: 9px; }
  #sliderDots { bottom: 6px; gap: 3px; }
  .slider-dot { width: 6px; height: 6px; }
}




.onyx-btn {
  background: var(--primary); 
  color: #fff; 
  font-weight: bold; 
  border-radius: .5rem;
  padding: .48rem 1.2rem; 
  font-size: 1rem; 
  transition: transform .18s, box-shadow .18s;
}

.onyx-btn:hover { 
  transform: translateY(-2px) scale(1.03); 
  box-shadow: 0 4px 18px #7C83FD36;
}

.product-card {
  background: #fff; 
  border-radius: .78rem;
  box-shadow: 0 2px 14px #7C83FD17;
  transition: transform .17s, box-shadow .17s;
  padding: 1rem; 
  display: flex; 
  flex-direction: column; 
  align-items: center; 
  min-height: 320px;
}

.product-card:hover { 
  transform: translateY(-5px); 
  box-shadow: 0 10px 34px #7C83FD33;
}

.product-card img { 
  border-radius: .5rem; 
  width: 100%; 
  height: 145px; 
  object-fit: cover; 
  margin-bottom: .7rem;
}

.product-price { 
  font-size: 1.08rem; 
  font-weight: bold;
}

.badge {
  display: inline-block; 
  padding: 2px 10px; 
  border-radius: 12px; 
  font-size: .83rem; 
  font-weight: 700; 
  margin-right: .5rem;
  vertical-align: middle;
}

.badge-new { 
  background: var(--success); 
  color: #fff; 
}

.badge-sale { 
  background: var(--danger); 
  color: #fff; 
}

.badge-best { 
  background: var(--secondary); 
  color: #fff;
}

.product-grid { 
  display: grid; 
  grid-template-columns: repeat(1, 1fr); 
  gap: 1.18rem;
}

@media (min-width: 540px) {
  .hero-slider { min-height: 360px; }
  .product-card img { height: 170px; }
  .product-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (min-width: 768px) {
  .product-grid { grid-template-columns: repeat(3, 1fr); }
}

@media (min-width: 920px) {
  .hero-slider { min-height: 440px; }
  .product-grid { grid-template-columns: repeat(4, 1fr); }
}

.footer {
  background: #E5ECFB; 
  color: #4661B6; 
  font-size: .99rem; 
  padding: 2rem 0; 
  margin-top: 4rem;
}

.footer-logo { 
  font-weight: 900; 
  color: var(--primary); 
  font-size: 1.12rem;
}

.footer a { 
  color: #4661B6; 
  transition: color .18s;
}

.footer a:hover { 
  color: var(--primary);
}

.slider-dot {
  width: 10px; 
  height: 10px; 
  margin: 0 4px; 
  border-radius: 50%; 
  background: #A3BFFA; 
  opacity: .47; 
  cursor: pointer;
  transition: background .19s, opacity .19s;
}

.slider-dot.active { 
  opacity: 1; 
  background: var(--primary);
}

.product-preview {
  display: none; 
  position: fixed; 
  top: 50%; 
  left: 50%; 
  transform: translate(-50%, -50%);
  background: #fff; 
  padding: 1.5rem; 
  border-radius: .83rem;
  box-shadow: 0 8px 36px #7C83FD40; 
  z-index: 999; 
  max-width: 95%; 
  width: 420px;
}

.product-preview.active { 
  display: block; 
  animation: fadeIn .33s;
}

.scroll-top-btn {
  position: fixed; 
  bottom: 1.2rem; 
  left: 1.2rem; 
  background: var(--primary); 
  color: #fff;
  padding: .6rem; 
  border-radius: 50%; 
  box-shadow: 0 2px 12px #7C83FD34;
  transition: transform .13s;
}

.scroll-top-btn:hover { 
  transform: scale(1.09);
}

@keyframes fadeIn { 
  from {opacity:0; transform: translate(-50%,-62%);} 
  to {opacity:1; transform: translate(-50%,-50%);} 
}

/* بهینه‌سازی برای موبایل */
@media (max-width: 540px) {
  .hero-slider {
    min-height: 300px; /* برای موبایل کوتاه‌تر می‌کنیم */
  }
  .product-card { 
    padding: .8rem; /* کاهش فضا */
  }
  .footer {
    font-size: 0.85rem;
  }
  .product-price { 
    font-size: 1rem; /* اندازه قیمت رو کوچک‌تر کردیم */
  }
}




/* --- استایل مدرن و رسپانسیو سلکت فیلتر/مرتب‌سازی محصولات --- */
.onyx-filter-select {
  appearance: none;
  -webkit-appearance: none;
  background-position: left 0.8em center;
  background-repeat: no-repeat;
  background-size: 1.27em;
  background-image: url('data:image/svg+xml;utf8,<svg fill="gray" height="18" width="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>');
  padding-left: 2.1em !important;
  font-family: inherit;
  font-weight: bold;
  box-shadow: 0 1px 6px #7C83FD11;
  transition: border .17s, box-shadow .18s;
}
.onyx-filter-select:focus {
  outline: none !important;
  box-shadow: 0 2px 14px #7C83FD2b;
  border-color: var(--primary);
  background-color: #f5f8ff;
}
@media (max-width: 700px) {
  .onyx-filter-select {
    font-size: .97rem;
    padding-left: 1.5em !important;
    min-width: 94px;
  }
  #products .flex {gap: 6px !important;}
}
@media (max-width: 480px) {
  .onyx-filter-select {
    font-size: .89rem;
    min-width: 75px;
    padding-left: 1em !important;
  }
  #products .flex {gap: 4px !important;}
}




.onyx-title-simple {
  font-size: 2rem;
  font-weight: 900;
  color: var(--text);
  margin-bottom: .7rem;
  letter-spacing: -.5px;
  line-height: 1.18;
  text-align: right;
  padding: 0;
  border: none;
  border-radius: 0;
  background: none;
  box-shadow: none;
  display: block;
}

@media (min-width: 640px) {
  .onyx-title-simple { font-size: 2.3rem; }
}
@media (min-width: 768px) {
  .onyx-title-simple { font-size: 2.7rem; }
}
@media (max-width: 500px) {
  .onyx-title-simple { font-size: 1.13rem; }
}

/* Favorite button modern style */
.favorite-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .4rem;
  padding: .55rem 1rem;
  font-family: inherit;
  font-weight: 700;
  font-size: .875rem;
  background: linear-gradient(135deg, rgba(82,183,136,0.7), rgba(124,131,253,0.7));
  backdrop-filter: blur(12px);
  border-radius: 1rem;
  border: 1px solid rgba(255,255,255,0.5);
  color: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: transform .2s, box-shadow .2s;
}
.favorite-btn:hover {
  transform: scale(1.06);
  box-shadow: 0 4px 14px rgba(0,0,0,0.2);
}

@media (max-width: 480px) {
  .favorite-btn { padding: .45rem .8rem; font-size: .8rem; }
}















</style>


</head>
<body>
  <!-- Header -->
<!-- فونت IranYekan از CDN (پیشنهادشده برای جذابیت لوگو) -->
<link href="https://cdn.fontcdn.ir/Font/Persian/IranYekan/IranYekan.css" rel="stylesheet" />

<!-- فونت IranYekan برای لوگوی فروشگاه -->
<link href="https://cdn.fontcdn.ir/Font/Persian/IranYekan/IranYekan.css" rel="stylesheet" />

<header class="shop-header" role="banner">
  <div class="shop-header__container">
    <div class="shop-header__brand">
      <div class="shop-brand-card">
        <span class="shop-logo" style="font-family:'IranYekan','Vazirmatn',sans-serif;">
          نئون استایل
        </span>
        <p class="shop-tagline">لباس‌های مدرن، جسورانه و مناسب هر موقعیت</p>
      </div>
      <div class="shop-badges">
        <span id="shop-status" class="shop-status" aria-live="polite">
          باز است
        </span>
        <button id="rateShow" class="shop-rating" type="button" aria-label="مشاهده امتیاز و تعداد بازدید">
          <span class="shop-rating__score">
            <svg viewBox="0 0 20 20" aria-hidden="true"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.04 3.21a1 1 0 00.95.69h3.367c.969 0 1.371 1.24.588 1.81l-2.726 1.98a1 1 0 00-.364 1.118l1.04 3.21c.3.921-.755 1.688-1.54 1.118l-2.726-1.98a1 1 0 00-1.175 0l-2.726 1.98c-.785.57-1.84-.197-1.54-1.118l1.04-3.21a1 1 0 00-.364-1.118L2.05 8.637c-.783-.57-.38-1.81.588-1.81h3.367a1 1 0 00.95-.69l1.04-3.21z"/></svg>
            <strong id="shop-rating">4.8</strong>
          </span>
          <span class="shop-rating__divider" aria-hidden="true"></span>
          <span class="shop-rating__visits"><i class="fas fa-eye" aria-hidden="true"></i><span id="shop-visits">1,234</span> بازدید</span>
        </button>
      </div>
    </div>
    <div class="shop-header__info" aria-label="اطلاعات سریع فروشگاه">
      <div class="shop-info-item">
        <i class="fas fa-location-dot" aria-hidden="true"></i>
        <span id="shop-header-address">تهران، بلوار کشاورز، خیابان مهرام، پلاک ۲۱</span>
      </div>
      <div class="shop-info-item">
        <i class="fas fa-clock" aria-hidden="true"></i>
        <span id="shop-header-hours">ساعت کاری: ۱۰ تا ۲۲ (هر روز)</span>
      </div>
      <div class="shop-info-item" dir="ltr">
        <i class="fas fa-phone" aria-hidden="true"></i>
        <span id="shop-header-phone">0912 345 6789</span>
      </div>
    </div>
    <div class="shop-header__actions">
      <button id="addressBtn" class="shop-header__pill shop-header__pill--primary" type="button" aria-label="نمایش آدرس فروشگاه">
        <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
        <span>آدرس فروشگاه</span>
      </button>
      <button id="favShopBtn" class="shop-header__pill" type="button" aria-label="مشاهده مشتریان وفادار">
        <i class="fas fa-heart" aria-hidden="true"></i>
        <span>مشتریان</span>
      </button>
      <button id="reportBtn" class="shop-header__pill shop-header__pill--alert" type="button" aria-label="گزارش تخلف">
        <i class="fas fa-exclamation-circle" aria-hidden="true"></i>
        <span>گزارش تخلف</span>
      </button>
      <a href="/" class="shop-header__pill shop-header__pill--home" title="بازگشت به ویترینت" aria-label="بازگشت به خانه">
        <i class="fas fa-home" aria-hidden="true"></i>
        <span>صفحه اصلی ویترینت</span>
      </a>
    </div>
  </div>
</header>












  <!-- Hero Slider -->
<section class="max-w-[95%] mx-auto hero-slider mt-4 relative" aria-label="اسلایدر تبلیغاتی" id="heroSliderSection">
  <!-- اسلایدها اینجا به صورت داینامیک اضافه می‌شوند -->
  <div class="absolute left-4 bottom-3 z-20 flex" id="sliderDots"></div>
  <button id="prevSlide" class="absolute right-3 top-1/2 -translate-y-1/2 bg-white hover:bg-[var(--primary)] p-2 rounded-full shadow-md" aria-label="اسلاید قبلی">
    <svg class="w-4 h-4" fill="none" stroke="var(--text)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
  </button>
  <button id="nextSlide" class="absolute left-3 top-1/2 -translate-y-1/2 bg-white hover:bg-[var(--primary)] p-2 rounded-full shadow-md" aria-label="اسلاید بعدی">
    <svg class="w-4 h-4" fill="none" stroke="var(--text)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
  </button>
</section>

  <!-- محصولات -->
<section id="products" class="max-w-[95%] mx-auto mt-6 px-4">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 md:gap-5 mb-6">
<h1 class="onyx-title-simple">منتخب این ماه</h1>



    <div class="w-full md:w-auto flex flex-wrap gap-2 md:gap-4 items-center justify-start md:justify-end bg-white rounded-2xl p-2.5 sm:p-3 shadow border border-gray-100">
      <!-- دسته‌بندی -->
      <select id="filterCategory"
        class="onyx-filter-select px-3 py-2 rounded-full bg-gray-50 border border-gray-200 text-sm focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition w-full sm:w-auto min-w-[110px] font-semibold"
      >
        <option value="همه">همه دسته‌ها</option>
        <option value="زنانه">زنانه</option>
        <option value="مردانه">مردانه</option>
        <option value="کودک">کودک</option>
        <option value="اکسسوری">اکسسوری</option>
      </select>
      <!-- مرتب‌سازی -->
      <select id="sortProducts"
        class="onyx-filter-select px-3 py-2 rounded-full bg-gray-50 border border-gray-200 text-sm focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] transition w-full sm:w-auto min-w-[110px] font-semibold"
      >
        <option value="default">مرتب‌سازی</option>
        <option value="newest">جدیدترین</option>
        <option value="expensive">گران‌ترین</option>
        <option value="cheap">ارزان‌ترین</option>
        <option value="best">پرفروش</option>
      </select>
    </div>
  </div>
  <div class="product-grid" id="productGrid"></div>
  <div id="noProductsMsg" class="text-center text-gray-400 font-bold text-lg mt-6 hidden">محصولی پیدا نشد!</div>
</section>



  <!-- Popup Preview -->
  <div id="productPreview" class="product-preview" aria-modal="true" role="dialog">
    <button id="closePreview" class="absolute top-2 left-2" aria-label="بستن پیش‌نمایش">
      <svg class="w-5 h-5" fill="none" stroke="var(--text)" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
    </button>
    <div class="flex flex-col sm:flex-row gap-4">
      <img id="previewImage" src="" alt="تصویر محصول" class="w-full sm:w-1/2 h-56 sm:h-64 object-cover rounded-lg"/>
      <div class="flex flex-col justify-between">
        <div>
          <h3 id="previewTitle" class="text-lg font-bold mb-2"></h3>
          <p id="previewCategory" class="text-sm text-[var(--primary)] mb-2"></p>
          <div class="flex gap-2 mb-3">
            <select class="p-1.5 rounded-lg border border-gray-300 text-sm" aria-label="انتخاب سایز">
              <option>سایز</option>
              <option>S</option>
              <option>M</option>
              <option>L</option>
            </select>
            <select class="p-1.5 rounded-lg border border-gray-300 text-sm" aria-label="انتخاب رنگ">
              <option>رنگ</option>
              <option>مشکی</option>
              <option>سفید</option>
              <option>آبی</option>
            </select>
          </div>
        </div>
        <div class="flex gap-2">
          <button class="onyx-btn">افزودن به سبد</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer -->
<footer class="footer bg-[#F7FAFE] text-[#232946] pt-8 pb-4 mt-10 border-t border-gray-200">
  <div class="max-w-[98%] mx-auto grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-7 px-4">
    <!-- لوگو و معرفی ویترینت -->
    <div>
      <div class="font-extrabold text-[1.3rem] text-[var(--primary)] mb-3 tracking-tight select-none">ویترینت</div>
      <p class="text-xs leading-relaxed mb-2">
        <b>ویترینت</b> پلتفرم ساخت فروشگاه آنلاین و توسعه برند است؛ ساده، سریع و با پشتیبانی واقعی برای کسب‌وکارهای ایرانی.
      </p>
      <div class="mt-3 text-xs text-gray-600">
        <span>فروشگاه جاری:</span>
        <span class="font-extrabold text-[var(--primary)]" id="currentShopName">نئون استایل</span>
      </div>
    </div>
    <!-- دسترسی سریع -->
    <div>
      <div class="font-bold mb-3 text-[var(--primary)]">دسترسی سریع</div>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">درباره ویترینت</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">سوالات متداول</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">قوانین و مقررات</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">پشتیبانی و تماس</a>
    </div>
    <!-- دسته‌بندی‌ها -->
    <div>
      <div class="font-bold mb-3 text-[var(--primary)]">دسته‌بندی‌های برتر</div>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">پوشاک زنانه</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">پوشاک مردانه</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">کودک و نوجوان</a>
      <a href="#" class="block mb-2 text-xs hover:text-[var(--primary)] transition">اکسسوری</a>
    </div>
    <!-- اکشن‌ها -->
    <div class="flex flex-col gap-4 items-stretch">
      <a href="https://vitrinet.shop/register"
         class="footer-action-btn bg-gradient-to-l from-[#52b788] to-[var(--primary)] text-white font-extrabold text-sm flex items-center justify-center gap-2 py-3 px-4 rounded-xl shadow-md hover:scale-[1.04] hover:shadow-lg active:scale-[0.98] transition-all duration-200"
         style="color:#fff !important;">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
        </svg>
        <span>ثبت <span class="hidden xs:inline">رایگان</span> فروشگاه در ویترینت</span>
      </a>
      <a href="https://vitrinet.shop"
         class="footer-home-btn flex items-center justify-center gap-2 border border-[var(--primary)] text-[var(--primary)] font-bold text-sm py-3 px-4 rounded-xl bg-white hover:bg-[var(--primary)] hover:text-white hover:shadow-lg hover:scale-[1.03] active:scale-95 transition-all duration-200">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7m-9 2v6m4-6v6m5 2a2 2 0 01-2 2H7a2 2 0 01-2-2v-7a2 2 0 012-2h3"/>
        </svg>
        <span>بازگشت به صفحه اصلی ویترینت</span>
      </a>
    </div>
  </div>
  <div class="mt-7 border-t border-gray-200 pt-3 text-center text-xs text-gray-500">
    © ۱۴۰۴ ویترینت – تمامی حقوق برای پلتفرم ویترینت محفوظ است.
  </div>
  <style>
    .footer-action-btn svg, .footer-home-btn svg {
      vertical-align: middle;
      margin-left: .13em;
      margin-right: .13em;
      transition: color .18s;
    }
    .footer-action-btn:hover svg, .footer-home-btn:hover svg {
      color: #fff;
      stroke: #fff;
    }
    .footer-action-btn.bg-gradient-to-l,
    .footer-action-btn.bg-gradient-to-l:visited {
      color: #fff !important;
      text-shadow: 0 1px 8px #52b78826;
    }
    /* باگ هاور دکمه بازگشت: رنگ متن */
    .footer-home-btn:hover,
    .footer-home-btn:focus {
      color: #fff !important;
      border-color: var(--primary);
      background: linear-gradient(to left, #52b788, var(--primary));
    }
    .footer-home-btn {
      background: #fff;
      color: var(--primary);
      transition: all .17s cubic-bezier(.4,0,.2,1);
      border: 1.7px solid var(--primary);
      font-weight: 700;
    }
    .footer-home-btn span, .footer-home-btn svg {
      transition: color .16s;
    }
    .footer-home-btn:hover span,
    .footer-home-btn:focus span {
      color: #fff !important;
    }
    /* Responsive grid */
    @media (max-width: 900px) {
      .footer .grid {grid-template-columns:1fr 1fr;}
    }
    @media (max-width: 640px) {
      .footer .grid {grid-template-columns:1fr;}
      .footer .flex-col {gap:1.2rem;}
    }
    .footer .onyx-btn, .footer-action-btn, .footer-home-btn {
      font-family: inherit;
      box-shadow:0 1.5px 8px #7C83FD14;
    }
    @media (max-width: 410px) {
      .footer-action-btn, .footer-home-btn {font-size:.92rem;}
      .footer-action-btn span.hidden.xs\:inline {display:none;}
    }
    @media (max-width: 500px) {
      .footer p {font-size: .97em;}
      .footer .font-extrabold {font-size:1.05rem;}
    }
  </style>
</footer>







  <!-- Scroll to Top -->
  <button id="scrollTopBtn" class="scroll-top-btn hidden" aria-label="بازگشت به بالا">
    <svg class="w-4 h-4" fill="none" stroke="white" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/></svg>
  </button>
<script>
// ===== گرفتن shopurl (هم از query ?shopurl=... هم از انتهای url) =====
function getShopSlug() {
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.has('shopurl')) {
    return urlParams.get('shopurl');
  }
  // shops/mobforoshi یا shop.html/mobforoshi یا حتی shop.html?shopurl=mobforoshi
  let path = window.location.pathname.split('/').filter(Boolean);
  let last = path[path.length - 1] || '';
  if (last.endsWith('.html')) last = last.replace('.html', '');
  // اگر shops یا shop.html بود و آخرش اسلاگ نبود، خالی برگردون
  if (['shops', 'shop', 'shop.html'].includes(last)) return '';
  return last;
}

// ← این متغیر رو در بالای اسکریپت تعریف می‌کنیم
let currentSellerId = null;

const slug = getShopSlug();

// ======== لود داده و داینامیک‌سازی کل اطلاعات فروشگاه ========
async function loadShopData() {
  if (!slug) return;
  try {
    const res = await fetch(`http://localhost:5000/api/shopAppearance/url/${slug}`);
    if (!res.ok) throw new Error('فروشگاه یافت نشد!');
    const data = await res.json();

    // ← وقتی اطلاعات فروشگاه لود شد، شناسه‌ش رو توی currentSellerId ذخیره می‌کنیم
    currentSellerId = data.sellerId;

    // لوگو و نام فروشگاه
    document.querySelectorAll('.shop-logo').forEach(el =>
      el.textContent = data.shopLogoText || data.shopName || 'نام فروشگاه'
    );
    document.getElementById('currentShopName').textContent =
      data.shopLogoText || data.shopName || 'نام فروشگاه';

    // وضعیت فروشگاه (باز/بسته)
    const statusEl = document.getElementById('shop-status');
    if (statusEl) {
      const isClosed = data.shopStatus === 'closed';
      statusEl.textContent = isClosed ? 'بسته است' : 'باز است';
      statusEl.classList.toggle('is-closed', isClosed);
    }

    // آدرس و شماره تماس
    const addressContent = document.querySelector('#addressModal .text-gray-800');
    if (addressContent) {
      addressContent.innerHTML = `
        ${data.shopAddress || 'آدرس ثبت نشده'}
        <br>
        <span class="text-emerald-700 text-sm font-semibold mt-1 flex items-center justify-center gap-1">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M3 5h12M9 3v2m0 14a4 4 0 100-8 4 4 0 000 8zm7-4h2a2 2 0 002-2v-2a2 2 0 00-2-2h-2a2 2 0 00-2 2v2a2 2 0 002 2z"/>
          </svg>
          شماره تماس: <b dir="ltr" class="font-bold mx-1">${data.shopPhone || '-'}</b>
        </span>
      `;
    }

    const headerAddress = document.getElementById('shop-header-address');
    if (headerAddress) headerAddress.textContent = data.shopAddress || 'آدرس ثبت نشده';
    const headerPhone = document.getElementById('shop-header-phone');
    if (headerPhone) headerPhone.textContent = data.shopPhone || data.phoneNumber || '-';
    const headerHours = document.getElementById('shop-header-hours');
    if (headerHours) {
      const hours = data.shopWorkingHours || data.workingHours || data.shopWorkTime || data.shopWorkHours || data.workHours;
      headerHours.textContent = hours ? `ساعت کاری: ${hours}` : 'ساعت کاری: —';
    }

    // امتیاز میانگین کاربران و تعداد کل امتیازها
    const avg = typeof data.averageRating === 'number'
      ? parseFloat(data.averageRating).toFixed(1)
      : '0.0';
    document.getElementById('shop-rating').textContent = avg;

    const count = typeof data.ratingCount === 'number'
      ? data.ratingCount.toLocaleString()
      : '0';
    document.getElementById('shop-visits').textContent = count;

    // اسلایدر
    renderHeroSlider(data.slides || []);

    // داینامیک سازی متاتگ‌ها و سئو
    setDynamicSEO(data);

    // محصولات را جدا بگیر
    loadShopProducts(slug);

  } catch (e) {
    console.error(e);
    document.querySelectorAll('.shop-logo').forEach(el => el.textContent = 'نام فروشگاه');
    document.getElementById('currentShopName').textContent = 'نام فروشگاه';
    const statusEl = document.getElementById('shop-status');
    if (statusEl) {
      statusEl.textContent = 'وضعیت نامشخص';
      statusEl.classList.remove('is-closed');
    }
    const headerAddress = document.getElementById('shop-header-address');
    if (headerAddress) headerAddress.textContent = 'آدرس ثبت نشده';
    const headerPhone = document.getElementById('shop-header-phone');
    if (headerPhone) headerPhone.textContent = '-';
    const headerHours = document.getElementById('shop-header-hours');
    if (headerHours) headerHours.textContent = 'ساعت کاری: —';
    setDynamicSEO({
      shopName: 'نام فروشگاه',
      shopShortDesc: 'فروشگاه آنلاین',
      shopCity: '',
      shopTags: ''
    });
  }
}


// ======== گرفتن و رندر محصولات فروشگاه بر اساس shopurl ========
async function loadShopProducts(shopurl) {
  try {
    const res = await fetch(`http://localhost:5000/api/products/shop/${shopurl}`);
    const products = await res.json();
    renderProducts(products);
  } catch (err) {
    renderProducts([]);
  }
}

// ======== رندر محصولات فروشگاه ========
function renderProducts(products = []) {
  console.log("PRODUCTS:", products); // فقط برای دیباگ
  const grid = document.getElementById('productGrid');
  const noMsg = document.getElementById('noProductsMsg');
  if (!products.length) {
    if (grid) grid.innerHTML = "";
    if (noMsg) noMsg.classList.remove("hidden");
    return;
  }
  if (noMsg) noMsg.classList.add("hidden");
  grid.innerHTML = products.map((p, i) => {
    let badgeClass = '';
    if (p.badgeType === "best") badgeClass = 'bg-orange-400 text-white px-3 py-1 rounded-full text-xs font-bold ml-2';
    else if (p.badgeType === "new") badgeClass = 'bg-green-400 text-white px-3 py-1 rounded-full text-xs font-bold ml-2';
    else if (p.badgeType === "sale") badgeClass = 'bg-pink-500 text-white px-3 py-1 rounded-full text-xs font-bold ml-2';

    // ساپورت هم img و هم images
    let imageUrl = 'images/no-image.png';
    if (p.images && Array.isArray(p.images) && p.images.length > 0) {
      imageUrl = p.images[p.mainImageIndex ?? 0] || p.images[0];
    } else if (p.img) {
      imageUrl = p.img;
    }

    return `
      <article class="product-card flex flex-col items-center bg-white rounded-xl shadow p-4" data-cat="${p.category}" data-idx="${i}">
        <img src="${imageUrl}" alt="${p.title}" loading="lazy" class="w-full object-cover rounded-lg mb-2" style="max-height:170px"/>
        <h3 class="font-bold text-base mb-1 text-center" title="${p.title}">${p.title}</h3>
        <div class="flex items-center justify-center mb-2">
          <span class="product-price font-bold text-lg ml-2">${p.price?.toLocaleString?.() || p.priceTxt || ''} <span style="font-size:11px;color:#aaa;">تومان</span></span>
          ${p.badge ? `<span class="${badgeClass}">${p.badge}</span>` : ''}
        </div>
        <div class="text-xs text-gray-500 mb-3 text-center">${p.category || ''}</div>
        <div class="flex gap-2 w-full mt-auto">
          <button class="onyx-btn details-btn w-full justify-center" aria-label="مشاهده ${p.title}" data-idx="${i}">
            مشاهده محصول
          </button>
        </div>
      </article>
    `;
  }).join('');
  document.querySelectorAll('.details-btn').forEach((btn, idx) => {
    btn.onclick = function () {
  window.location.href = `product.html?id=${products[idx]._id}`;
};

  });
}


// ======== رندر اسلایدر داینامیک ========
function renderHeroSlider(slidesArr = []) {
  const heroSlider = document.getElementById('heroSliderSection');
  if (!heroSlider) return;
  heroSlider.querySelectorAll('.slide').forEach(el => el.remove());
  if (!slidesArr.length) {
    heroSlider.insertAdjacentHTML('afterbegin', `
      <div class="slide active">
        <img src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1400&q=80&format=webp" alt="اسلاید پیش‌فرض" loading="lazy"/>
        <div class="slide-caption">
          <h2 class="slide-title">اسلاید نمونه</h2>
        </div>
      </div>
    `);
    return;
  }
  slidesArr.forEach((slide, i) => {
    heroSlider.insertAdjacentHTML('beforeend', `
      <div class="slide${i === 0 ? ' active' : ''}">
        <img src="${slide.img || ''}" alt="${slide.title || 'اسلاید'}" loading="lazy"/>
        <div class="slide-caption">
          <h2 class="slide-title">${slide.title || ''}</h2>
          <p class="slide-desc">${slide.desc || ''}</p>
        </div>
      </div>
    `);
  });
  let slides = Array.from(heroSlider.querySelectorAll('.slide'));
  let current = 0;
  const dots = document.getElementById('sliderDots');
  if (dots) {
    dots.innerHTML = '';
    slides.forEach((_, idx) => {
      const dot = document.createElement('span');
      dot.className = `slider-dot${idx === 0 ? ' active' : ''}`;
      dot.onclick = () => gotoSlide(idx);
      dots.appendChild(dot);
    });
  }
  function gotoSlide(idx) {
    slides.forEach((el, j) => el.classList.toggle('active', j === idx));
    if (dots) {
      dots.querySelectorAll('.slider-dot').forEach((el, j) => el.classList.toggle('active', j === idx));
    }
    current = idx;
  }
  document.getElementById('prevSlide').onclick = () => gotoSlide((current - 1 + slides.length) % slides.length);
  document.getElementById('nextSlide').onclick = () => gotoSlide((current + 1) % slides.length);
  setInterval(() => gotoSlide((current + 1) % slides.length), 6000);
}


// ========== اجرا بعد از لود صفحه ==========
document.addEventListener('DOMContentLoaded', function () {
  loadShopData();
  const scrollTopBtn = document.getElementById('scrollTopBtn');
  window.onscroll = () => {
    if (scrollTopBtn) scrollTopBtn.classList.toggle('hidden', window.scrollY < 300);
  }
  if (scrollTopBtn)
    scrollTopBtn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
});





// کنترل باز و بسته شدن مودال آدرس فروشگاه
document.addEventListener('DOMContentLoaded', function () {
  const addressBtn = document.getElementById('addressBtn');
  const addressModal = document.getElementById('addressModal');
  const closeAddressModal = document.getElementById('closeAddressModal');
  
  if (addressBtn && addressModal) {
    addressBtn.onclick = function() {
      addressModal.classList.remove('hidden');
    }
  }
  if (closeAddressModal && addressModal) {
    closeAddressModal.onclick = function() {
      addressModal.classList.add('hidden');
    }
  }
  if (addressModal) {
    addressModal.addEventListener('click', function(e) {
      if (e.target === addressModal) {
        addressModal.classList.add('hidden');
      }
    });
  }
});








document.addEventListener('DOMContentLoaded', () => {

/* ───────────────── ثابت‌ها و ابزار‌ها ──────────────── */
const API_BASE     = 'http://localhost:5000';     // آدرس بک‌اند
const AUTH_CHECK   = `${API_BASE}/api/auth/getCurrentUser`;
const REPORT_URL   = `${API_BASE}/api/reports`;

/* ‌────────── المان‌های صفحه ────────── */
/* 1) مودال آدرس */
const addressBtn        = document.getElementById('addressBtn');
const addressModal      = document.getElementById('addressModal');
const closeAddressModal = document.getElementById('closeAddressModal');

/* 2) گزارش تخلف */
const $btn   = document.getElementById('reportBtn');
const $modal = document.getElementById('reportModal');
const $close = document.getElementById('closeReportModal');

const $type  = document.getElementById('reportType');
const $txt   = document.getElementById('reportText');
const $send  = document.getElementById('submitReport');
const $msg   = document.getElementById('reportMsg');

/* ───────────── کمک‌خرج‌ها ───────────── */

/* ───────────── کمک‌خرج‌ها ───────────── */
const showMsg = (text = '', ok = true) => {
  $msg.textContent = text;
  $msg.className   = ok ? 'text-green-500 font-bold mt-1'
                        : 'text-red-500  font-bold mt-1';
};

const isLoggedIn = async () => {
  try {
    const res = await fetch(AUTH_CHECK, { credentials: 'include' });
    return res.ok;                  // کوکی معتبر → ۲۰۰
  } catch {
    return false;
  }
};


/* ───────────── مودال آدرس ───────────── */
addressBtn?.addEventListener('click', () => addressModal?.classList.remove('hidden'));
closeAddressModal?.addEventListener('click', () => addressModal?.classList.add('hidden'));
addressModal?.addEventListener('click', e => (e.target === addressModal) && addressModal.classList.add('hidden'));

/* ───────────── مودال گزارش ───────────── */
  // ───────────── گزارش تخلف ─────────────
  const resetForm = () => {
    showMsg('');
    $type.value = 'price_mismatch';
    $txt.value  = '';
  };

  const openModal  = () => { resetForm(); $modal.classList.remove('hidden'); };
  const closeModal = () =>   $modal.classList.add('hidden');

  $btn  ?.addEventListener('click', openModal);
  $close?.addEventListener('click', closeModal);
  $modal?.addEventListener('click', e => (e.target === $modal) && closeModal());

  /* ───────────── ارسال گزارش ───────────── */
  $send?.addEventListener('click', async () => {

    const description = $txt.value.trim();
    const type        = $type.value;

    if (description.length < 5)
      return showMsg('توضیح حداقل ۵ کاراکتر باشد.', false);

    if (!(await isLoggedIn()))
      return askForLogin({ type, description });

    $send.disabled    = true;
    $send.textContent = 'در حال ارسال…';

    try {
      const res = await fetch(REPORT_URL, {
        method      : 'POST',
        credentials : 'include',
        headers     : { 'Content-Type': 'application/json' },
        body        : JSON.stringify({ type, description, sellerId: currentSellerId, shopurl: slug })
      });

      if (res.status === 401) return askForLogin({ type, description });
      if (res.status === 429) return showMsg('لطفاً یک دقیقه بعد دوباره تلاش کنید.', false);
      if (!res.ok)            return showMsg('خطا! دوباره امتحان کنید.', false);

      showMsg('✅ گزارش با موفقیت ثبت شد');
      setTimeout(closeModal, 2000);

    } catch (err) {
      console.error(err);
      showMsg('خطای شبکه؛ بعداً تلاش کنید.', false);
    } finally {
      $send.disabled    = false;
      $send.textContent = 'ارسال گزارش';
    }
  });

  /* ───── پرسش برای ورود ───── */
  function askForLogin(draft) {
    $send.disabled    = false;
    $send.textContent = 'ارسال گزارش';

    if (confirm('برای ارسال گزارش باید وارد شوید. مایلید به صفحهٔ ورود بروید؟')) {
      SafeSS.setJSON('afterLoginReturn', location.href); // SafeSS
      SafeSS.setJSON('reportDraft', draft); // SafeSS
      location.href = '/login.html';
    } else {
      showMsg('ابتدا وارد حساب شوید سپس دوباره گزارش دهید.', false);
    }
  }

  /* ───── بازیابی پیش‌نویس پس از ورود ───── */
  (async () => {
    const draft = SafeSS.getJSON('reportDraft'); // SafeSS
    if (!draft) return; // SafeSS
    if (!(await isLoggedIn())) return;  // هنوز وارد نشده

    const { type, description } = draft; // SafeSS
    sessionStorage.removeItem('reportDraft');

    $type.value = type;
    $txt.value  = description;
    $modal.classList.remove('hidden');
  })();

  // ───────────── امتیازدهی ─────────────
  const rateShow       = document.getElementById('rateShow');
  const rateModal      = document.getElementById('rateModal');
  const closeRateModal = document.getElementById('closeRateModal');
  const rateStars      = document.getElementById('rateStars');
  const submitRateBtn  = document.getElementById('submitRate');
  const rateMsg        = document.getElementById('rateMsg');
  let   selectedRating = 0;

  function renderStars(rating = 0) {
    rateStars.innerHTML = '';
    for (let i = 1; i <= 5; i++) {
      const star = document.createElement('span');
      star.className    = `rate-star ${i <= rating ? 'active' : 'inactive'}`;
      star.textContent  = '★';
      star.dataset.value = i;
      star.addEventListener('click', () => {
        selectedRating = i;
        renderStars(i);
      });
      rateStars.appendChild(star);
    }
  }

  rateShow.addEventListener('click', async () => {
    if (!(await isLoggedIn())) {
      if (confirm('برای ثبت امتیاز باید وارد شوید. به صفحهٔ ورود بروید؟')) {
        SafeSS.setJSON('afterLoginReturn', location.href); // SafeSS
        location.href = '/login.html';
      }
      return;
    }
    selectedRating = 0;
    renderStars(0);
    rateMsg.classList.add('hidden');
    rateModal.classList.remove('hidden');
  });

  closeRateModal.addEventListener('click', () => rateModal.classList.add('hidden'));
  rateModal.addEventListener('click', e => {
    if (e.target === rateModal) closeRateModal.click();
  });

  submitRateBtn.addEventListener('click', async () => {
    if (selectedRating < 1) {
      rateMsg.textContent = 'لطفاً یک امتیاز انتخاب کنید.';
      rateMsg.className   = 'text-red-500 font-bold mt-1';
      rateMsg.classList.remove('hidden');
      return;
    }
    submitRateBtn.disabled = true;
    try {
      const res = await fetch(`${API_BASE}/api/shopAppearance/${currentSellerId}/rate`, {
        method      : 'POST',
        credentials : 'include',
        headers     : { 'Content-Type': 'application/json' },
        body        : JSON.stringify({ rating: selectedRating })
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.message || 'خطا در ثبت امتیاز');

      document.getElementById('shop-rating').textContent = parseFloat(data.averageRating).toFixed(1);
      rateMsg.textContent = '✅ امتیاز با موفقیت ثبت شد.';
      rateMsg.className   = 'text-green-500 font-bold mt-1';
      rateModal.classList.add('hidden');
    } catch (err) {
      rateMsg.textContent = err.message;
      rateMsg.className   = 'text-red-500 font-bold mt-1';
      rateMsg.classList.remove('hidden');
    } finally {
      submitRateBtn.disabled = false;
    }
  });

  // ───────────── مغازه محبوب ─────────────
  const favShopBtn       = document.getElementById('favShopBtn');
  const favShopModal     = document.getElementById('favShopModal');
  const closeFavShop     = document.getElementById('closeFavShopModal');
  const favShopCountEl   = document.getElementById('favShopCount');
  const toggleFavShopBtn = document.getElementById('toggleFavShopBtn');

  async function refreshFavShopInfo() {
    try {
      const res = await fetch(`${API_BASE}/api/favorite-shops/count/${currentSellerId}`);
      const { count = 0 } = await res.json();
      favShopCountEl.textContent = count;
    } catch { favShopCountEl.textContent = 0; }

    let added = false;
    try {
      const res2 = await fetch(`${API_BASE}/api/favorite-shops`, { credentials: 'include' });
      if (res2.ok) {
        const shops = await res2.json();
        added = shops.some(s => s._id === currentSellerId);
      }
    } catch {}

    toggleFavShopBtn.dataset.added = added ? 'true' : 'false';
    toggleFavShopBtn.textContent = added ? 'افزوده شد' : 'افزودن به محبوب‌ها';
  }

  favShopBtn?.addEventListener('click', async () => {
    await refreshFavShopInfo();
    favShopModal.classList.remove('hidden');
  });

  closeFavShop?.addEventListener('click', () => favShopModal.classList.add('hidden'));
  favShopModal?.addEventListener('click', e => (e.target === favShopModal) && favShopModal.classList.add('hidden'));

  toggleFavShopBtn?.addEventListener('click', async () => {
    const added = toggleFavShopBtn.dataset.added === 'true';
    toggleFavShopBtn.disabled = true;
    try {
      await fetch(`${API_BASE}/api/favorite-shops/${currentSellerId}`, {
        method: added ? 'DELETE' : 'POST',
        credentials: 'include'
      });
      await refreshFavShopInfo();
    } catch {}
    toggleFavShopBtn.disabled = false;
  });

}); // پایان DOMContentLoaded












let allProducts = []; // همه محصولات اینجا ذخیره میشه

// ===== گرفتن و رندر محصولات فروشگاه بر اساس shopurl =====
async function loadShopProducts(shopurl) {
  try {
    const res = await fetch(`http://localhost:5000/api/products/shop/${shopurl}`);
    const products = await res.json();
    allProducts = products || [];
    applyFiltersAndRender();
  } catch (err) {
    allProducts = [];
    applyFiltersAndRender();
  }
}

// ===== فیلتر و مرتب‌سازی =====
function applyFiltersAndRender() {
  let filtered = [...allProducts];
  
  // دسته‌بندی
  const cat = document.getElementById('filterCategory')?.value || "همه";
  if (cat && cat !== "همه") {
    filtered = filtered.filter(p => (p.category && p.category.trim() === cat));
  }
  
  // مرتب‌سازی
  const sort = document.getElementById('sortProducts')?.value || "default";
  if (sort === "newest") {
    filtered.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
  } else if (sort === "expensive") {
    filtered.sort((a, b) => (b.price || 0) - (a.price || 0));
  } else if (sort === "cheap") {
    filtered.sort((a, b) => (a.price || 0) - (b.price || 0));
  } else if (sort === "best") {
    // برای پرفروش اگه فیلد مثلا "sold" یا "orders" داری استفاده کن وگرنه badgeType === 'best'
    filtered.sort((a, b) => ((b.sold || 0) - (a.sold || 0)));
  }
  
  renderProducts(filtered);
}

// ===== ایوند لیسنرهای فیلتر و مرتب‌سازی =====
document.addEventListener('DOMContentLoaded', function () {
  const catSel = document.getElementById('filterCategory');
  const sortSel = document.getElementById('sortProducts');
  if (catSel) catSel.addEventListener('change', applyFiltersAndRender);
  if (sortSel) sortSel.addEventListener('change', applyFiltersAndRender);
});






// ---- داینامیک کردن title و meta تگ‌های سئو ----

function setDynamicSEO(shop) {
  // title
  document.title = `${shop.shopName || 'فروشگاه'} | ${shop.shopShortDesc || ''}`;

  // description
  let desc = document.querySelector('meta[name="description"]');
  if (!desc) {
    desc = document.createElement('meta');
    desc.setAttribute('name', 'description');
    document.head.appendChild(desc);
  }
  desc.setAttribute('content', shop.shopShortDesc || 'خرید آنلاین از فروشگاه');

  // keywords
  let keywords = document.querySelector('meta[name="keywords"]');
  if (!keywords) {
    keywords = document.createElement('meta');
    keywords.setAttribute('name', 'keywords');
    document.head.appendChild(keywords);
  }
  keywords.setAttribute('content', `${shop.shopName || ''}, ${shop.shopCity || ''}, ${shop.shopTags || ''}, فروشگاه`);

  // author
  let author = document.querySelector('meta[name="author"]');
  if (!author) {
    author = document.createElement('meta');
    author.setAttribute('name', 'author');
    document.head.appendChild(author);
  }
  author.setAttribute('content', shop.shopName || '');

  // og:title
  let ogTitle = document.querySelector('meta[property="og:title"]');
  if (!ogTitle) {
    ogTitle = document.createElement('meta');
    ogTitle.setAttribute('property', 'og:title');
    document.head.appendChild(ogTitle);
  }
  ogTitle.setAttribute('content', `${shop.shopName || ''} | ${shop.shopShortDesc || ''}`);

  // og:description
  let ogDesc = document.querySelector('meta[property="og:description"]');
  if (!ogDesc) {
    ogDesc = document.createElement('meta');
    ogDesc.setAttribute('property', 'og:description');
    document.head.appendChild(ogDesc);
  }
  ogDesc.setAttribute('content', shop.shopShortDesc || '');

  // og:url
  let ogUrl = document.querySelector('meta[property="og:url"]');
  if (!ogUrl) {
    ogUrl = document.createElement('meta');
    ogUrl.setAttribute('property', 'og:url');
    document.head.appendChild(ogUrl);
  }
  ogUrl.setAttribute('content', window.location.href);

  // og:image (اگه داری)
  if (shop.shopImage) {
    let ogImg = document.querySelector('meta[property="og:image"]');
    if (!ogImg) {
      ogImg = document.createElement('meta');
      ogImg.setAttribute('property', 'og:image');
      document.head.appendChild(ogImg);
    }
    ogImg.setAttribute('content', shop.shopImage);
  }
}



</script>


</body>
</html>